/* core_oauth 8.7.2 2017-08-02T09:54:58+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.parts.oauth",[]).config(["c8yViewsProvider",function(t){t.when("/oauth",{templateUrl:"core_oauth/views/index.html"})}]),angular.module("c8y.parts.oauth").controller("OAuthCtrl",["$scope","$location","$window","$http","c8ySettings","c8yAuth","c8yUser","c8yTitle","c8yAlert","gettext","gettextCatalog",function(t,e,n,o,r,a,i,c,u,l,s){"use strict";function d(t){j=t.tenant,f()}function h(e){var n=e.data;t.token=n.value}function p(t){var e=t.data;u.danger(e.error+": "+e.error_description)}function f(){x.code?k(x.code):w(),t.getLoginUrl=v}function g(t){return _.keys(t).map(function(e){return e+"="+t[e]}).join("&")}function y(t){var e={},n=[],o="redirect"===t?$:T,r=80!==parseInt(C,10)&&443!==parseInt(C,10)?":"+C:"",a=[A,"://",o,r].join("");return e.tenant_id=j,"login"===t&&(_.assign(e,{redirect_uri:y("redirect"),response_type:"code"}),n=[a,"/tenant/oauth?",g(e)]),"token"===t&&(n=[a,"/tenant/oauth?"]),"redirect"===t&&(n=[a,U,"%23/oauth"]),n.join("")}function v(){return y("login")}function m(e){var n="paypal",o="refreshToken";r.list().then(function(a){var i="createOption";(a||[]).forEach(function(t){if(t.category===n)return i="updateOption",!1}),r[i]({category:n,key:o,value:e}).then(function(){t.token=e,t.$emit("message",{type:"success",text:l("Token successfully saved")})})})}function k(t){var e=y("token"),n={redirect_uri:y("redirect"),grant_type:"authorization_code",code:t};n.tenant_id=j,o({method:"POST",url:e,data:g(n),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){var e=t.data;e.refresh_token&&m(e.refresh_token)},p)}function w(){var t={category:"paypal",key:"refreshToken"};r.detail(t).then(h)}function b(){c.changeTitle({title:l("oAuth")})}var x=e.search(),T=e.host(),$="developer.cumulocity.com",A=e.protocol(),C=e.port(),O=i.current(),U=n.location.pathname,j=null;O.then(d),b()}]),function(){"use strict";function t(t){var e;e='<div data-ng-controller="OAuthCtrl">\n  <div class="form-group">\n    <label class="control-label" translate>Refresh token</label>\n    <div class="controls">\n      <input type="text" data-ng-model="token" class="form-control" disabled="disabled">\n    </div>\n  </div>\n  <a ng-href="{{getLoginUrl()}}" target="_blank" class="btn btn-primary" translate>Login</a>\n</div>\n',t.put("core_oauth/views/index.html",e),t.put("/apps/core/oauth/views/index.html",e)}angular.module("c8y.parts.oauth").run(["$templateCache",t])}();