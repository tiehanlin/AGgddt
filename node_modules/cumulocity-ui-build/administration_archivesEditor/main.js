/* administration_archivesEditor 8.7.2 2017-08-02T09:53:14+00:00 79d3e7d78638 (hotfix/8.7.2) tip */
!function(){"use strict";function e(e,i){e.when("/applications/:applicationId",{templateUrl:"administration_archivesEditor/views/index.html",controller:"ArchivesListCtrl as ctrl",icon:"archive",name:i("Archives"),showIf:["$routeParams","c8yApplication",n],priority:-4e3})}function n(e,n){return!(!e.applicationId||"new"===e.applicationId)&&n.detail(e.applicationId).then(function(e){var i=n.convertType(e.data);return"HOSTED"===i.type})}angular.module("c8y.parts.appArchives",[]).config(["c8yViewsProvider","gettext",e])}(),function(){function e(e,n,i,a,t,s,r,l){function o(){e.paging={refresh:!0},i.detail(p).then(function(e){c=e.data,d.refresh()})}var c,d=this,p=a.applicationId,u={inProgress:!1,progress:0};this.refresh=e.refresh=function(){return e.refreshLoading=!0,i.listArchives(c).then(function(e){d.archives=e.attachments}).finally(function(){e.refreshLoading=!1})},this.isActiveArchive=function(e){return c.activeVersionId===e.id},this.setActive=function(e){var n=_.cloneDeep(c);n.activeVersionId=e.id,d.requestInProgress=!0,i.save(n).then(function(e){c=e.data}).finally(function(){d.requestInProgress=!1})},this.delete=function(e){return t({title:r("Are you sure?"),body:l.getString("Do you really want to remove archive \"{{name}}{{description ? (' (' + description + ')') : ''}}\"?",e),status:"danger"}).then(function(){return d.requestInProgress=!0,i.deleteArchive(c,e).then(d.refresh).finally(function(){d.requestInProgress=!1})})},this.uploadArchive=function(){var e=n.when();return 6===d.archives.length&&(e=t({title:r("Are you sure?"),body:r("Upto 6 archives can be stored in the platform. If you upload a new archive, the oldest archive that is not active will be deleted. Do you want to proceed?")})),e.then(function(){d.requestInProgress=!0,u.inProgress=!0,u.progress=0;var e=_(d.appArchives).map("file").map(_.partial(i.uploadArchive,c)).value();return _.forEach(e,function(n){n.progress(function(i){n.uploadProgress=i.loaded/i.total,u.progress=_(e).map("uploadProgress").reduce(function(e,n){return e+n})/e.length*100})}),n.all(e).finally(function(){d.requestInProgress=!1,u.inProgress=!1,u.progress=0})}).then(function(e){1===e.length&&n.when(d.setActive(e[0].data)).then(d.refresh).then(function(){s.success(r("Application archive has been uploaded and activated!"))})})},this.uploadStatus=u,o()}angular.module("c8y.parts.appArchives").controller("ArchivesListCtrl",["$scope","$q","c8yApplication","$routeParams","c8yModal","c8yAlert","gettext","gettextCatalog",e])}(),function(){"use strict";function e(e,n,i,a,t){function s(){if(e.uploading)return n.reject();e.uploading=!0;var s=_(e.files).map("file").map(_.partial(a.uploadArchive,t)).value();return _.forEach(s,function(n){n.progress(function(i){n.uploadProgress=i.loaded/i.total,e.uploadProgress=_(s).map("uploadProgress").reduce(function(e,n){return e+n})/s.length})}),n.all(s).then(i.close).finally(function(){e.uploadProgress=100,e.uploading=!1})}e.uploading=!1,e.uploadProgress=0,e.allowMultipleFiles=!1,e.filesRequired=!0,e.files=[],e.upload=s,e.dismiss=i.dismiss}angular.module("c8y.parts.appArchives").controller("ArchivesUploadCtrl",["$scope","$q","$uibModalInstance","c8yApplication","app",e])}(),function(){"use strict";function e(e){var n;n='<div class="c8y-toolbar-spacer">\n  <div class="c8y-toolbar navbar navbar-default" c8y-affix>\n\n    <div class="navbar-header">\n      <button type="button" class="navbar-toggle collapsed" ng-click="isPageToolbarExpanded = !isPageToolbarExpanded">\n        <span class="sr-only">Toggle Toolbar</span>\n        <span class="icon-bar"></span>\n        <span class="icon-bar"></span>\n        <span class="icon-bar"></span>\n      </button>\n    </div>\n\n    <div id="page-toolbar" class="navbar-collapse collapse" uib-collapse="!isPageToolbarExpanded" aria-expanded="false" style="height: 0px">\n      <ul class="nav navbar-nav navbar-right">\n        <li>\n            <c8y-refresh-btn></c8y-refresh-btn>\n        </li>\n      </ul>\n    </div>\n\n  </div>\n</div>\n\n\n\n<div class="row">\n  <div class="col-sm-8">\n    <ul class="timeline-list">\n      <li class="timeline-list-item flex-row" ng-repeat="archive in ctrl.archives | orderBy:\'-created\'" ng-class="{\'active\': ctrl.isActiveArchive(archive)}">\n        <small class="timeline-item-date text-right">\n          <strong ng-bind="archive.created |  absoluteDateTimeFormat:\'D MMM YYYY\'"></strong><br/>\n          <span class="text-muted" ng-bind="archive.created | absoluteTime"></span>\n        </small>\n        <div class="timeline-item-content flex-row">\n          <div class="list-item-icon">\n            <i c8y-icon="{{$last ? \'flag-checkered\' : \'file-zip-o\'}}"></i>\n          </div>\n          <div class="list-item-body">\n            <span class="text-truncate"><span ng-bind="archive.name"></span> <small class="text-muted" ng-bind="archive.length | bytes"></small></span>\n            <small class="text-muted" ng-bind="archive.description"></small>\n          </div>\n          <div class="list-item-actions">\n            <div class="dropdown clearfix" ng-if="!ctrl.isActiveArchive(archive)" uib-dropdown>\n              <button type="button" class="dropdown-toggle c8y-dropdown" aria-haspopup="true" aria-expanded="false" uib-dropdown-toggle>\n                <i c8y-icon="ellipsis-v"></i>\n              </button>\n              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" uib-dropdown-menu>\n                <li>\n                  <a href="" ng-click="ctrl.setActive(archive)" ng-disabled="ctrl.requestInProgress || refreshLoading">\n                    <i c8y-icon="check-square-o"></i> {{\'Set as active\' | translate}}\n                   </a>\n                </li>\n                <li ng-if="!$last">\n                  <a href="" ng-click="ctrl.delete(archive)" ng-disabled="ctrl.requestInProgress || refreshLoading">\n                    <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <div class="col-sm-4">\n    <c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\', \'ROLE_INVENTORY_CREATE\']">\n      <file-picker files="ctrl.appArchives" multiple="false" required="true" ng-disabled="ctrl.requestInProgress || refreshLoading" display-drop-zone="true" drop-zone-label="\'Upload archive\' | translate" processing-status="ctrl.uploadStatus" on-file-selected="ctrl.uploadArchive()">\n      </file-picker>\n    </c8y-if-allowed>\n  </div>\n</div>\n',e.put("administration_archivesEditor/views/index.html",n),e.put("/apps/administration/archivesEditor/views/index.html",n),n='<div class="modal-header" ng-show="title">\n  <h3>{{title | translate}}</h3>\n</div>\n<div class="modal-body">\n  <form role="form" name="filesUploadForm" class="panel-body" novalidate>\n    <div class="form-group">\n      <label translate>Archives to upload</label>\n      <i c8y-icon="question-circle" uib-tooltip="{{\'Compressed files must have an index.html at root. URLs in the web application can be relative.\' | translate}}"></i>\n      <file-picker files="files" multiple="allowMultipleFiles" required="filesRequired" disabled="uploading"></file-picker>\n    </div>\n  </form>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="upload()" ng-disabled="filesUploadForm.$invalid || uploading">\n      <span ng-show="uploading"><i c8y-icon="spinner" class="fa-spin"></i> <translate>Uploading</translate>&hellip; ({{uploadProgress|number:0}}%)</span>\n    <span ng-show="!uploading" translate>Upload</span>\n  </button>\n  <button class="btn btn-default" ng-click="dismiss()" ng-disabled="uploading" translate>Cancel</button>\n</div>\n',e.put("administration_archivesEditor/views/upload.html",n),e.put("/apps/administration/archivesEditor/views/upload.html",n)}angular.module("c8y.parts.appArchives").run(["$templateCache",e])}();