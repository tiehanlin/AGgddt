/* cockpit_kumpan 8.7.2 2017-08-02T09:53:16+00:00 820f9e1be195 (hotfix/8.7.2) tip */
!function(){"use strict";function t(t,a){var e={template:'<c8y-dashboard-gridstack name="{{board}}" default-children="children"></c8y-dashboard-gridstack>',controller:"KumpanCtrl"};t.when("/",_.cloneDeep(e)),t.when("/kumpan/:scooterId",_.cloneDeep(e)),a.add({name:"Kumpan Alarms",templateUrl:"cockpit_kumpan/views/alarms.html",options:{noDeviceTarget:!0}}),a.add({name:"Kumpan Relay",templateUrl:"cockpit_kumpan/views/relay.html"})}function a(t,a){function e(){return t.list({text:"Cinterion EHS5-E"})}function n(t,e,n){var i={deviceId:t,c8y_Relay:{id:e,state:n?"CLOSED":"OPEN"},description:(n?"Close":"Open")+" Relay"};return a.create(i)}return{list:e,relay:n}}function e(t,a,e){function n(a){var e=_.map(_.filter(a,i),r);v?(s(e),t.board="kumpan_board_scooter_"+v):(l([_.map(e,u),g(e),p(e)]),t.board="kumpan_board")}function i(t){return a.scooterId?t.id===a.scooterId&&t.childDevices.references.length:t.childDevices.references.length}function r(t){return{name:t.name,id:t.id,childId:t.childDevices.references[0].managedObject.id}}function l(a){t.children=_.flattenDeep([o(),d(),a])}function s(a){t.children=[{name:"KPI Graph",title:"Battery",config:_.assign({device:{id:a[0].childId},aggregationType:"",aggregationTypeChangedManually:!0,timeInterval:"days"},y({})),_x:0,_y:0,_height:4,_width:5,_isFrozen:!0},{name:"KPI Graph",title:"Temperature",config:_.assign({device:{id:a[0].childId},aggregationType:"",aggregationTypeChangedManually:!0,timeInterval:"days"},h({})),_x:5,_y:0,_height:4,_width:5,_isFrozen:!0},_.assign(u(a[0],""),{_x:10,_y:0,_height:4,_width:2}),c({id:a[0].id,relay_id:1,title:"High beam",_x:0,_y:4}),c({id:a[0].id,relay_id:2,title:"Break light",_x:2,_y:4})]}function c(t){return{name:"Kumpan Relay",title:t.title,config:{device:{id:t.id},relay_id:t.relay_id},_x:t._x,_y:t._y,_height:2,_width:2}}function o(){return{name:"Map",title:"Scooter fleet map",_x:0,_y:7,_height:5,_width:6}}function d(){return{name:"Kumpan Alarms",title:"Alarms",_x:6,_y:7,_height:5,_width:6}}function u(t,a){return m({id:t.childId,title:'<i class="fa fa-circle kumpancolor'+a+'"></i> Scooter '+(a+1)+" RPM",fragment:"c8y_MotorSpeed",label:"RPM",series:"MotorSpeed",unit:"RPM",min:0,max:700,yellowRangeMin:500,yellowRangeMax:650,redRangeMin:650,redRangeMax:700,_y:4,_x:2*a})}function m(t){return{name:"KPI Radial Gauge",title:t.title,config:{device:{id:t.id},kpi:{fragment:t.fragment,label:t.label,series:t.series,min:t.min,max:t.max,yellowRangeMin:t.yellowRangeMin,yellowRangeMax:t.yellowRangeMax,redRangeMin:t.redRangeMin,redRangeMax:t.redRangeMax}},_x:t._x,_y:t._y,_height:3,_width:2,_isFrozen:!0}}function g(t,a){a=a||{};var e=_.map(t,h),n={title:"Scooter fleet temperature",datapoints:e,_x:0,_y:0};return f(n)}function p(t,a){a=a||{};var e=_.map(t,y),n={title:"Scooter fleet battery",datapoints:e,_x:a._x||6,_y:a._y||0};return f(n)}function h(t,a){return{fragment:"c8y_MotorTemperature",series:"MotorTemperature",label:"Temperature "+(a+1),unit:"iae",color:b[a],__target:{id:t.childId}}}function y(t,a){return{fragment:"c8y_BatteryVoltage",series:"BatteryVoltage",label:"Battery "+(a+1),color:b[a],__target:{id:t.childId}}}function f(t){return{name:"KPI Graph",title:t.title,config:{aggregationType:"",aggregationTypeChangedManually:!0,timeInterval:"days",datapoints:t.datapoints},_x:t._x,_y:t._y,_height:4,_width:6,_isFrozen:!0}}var v=a.scooterId,b=["#E20074","#BF1A2F","#454E9E","#018E42","#F7D002"];e.list().then(n)}angular.module("c8y.kumpan.plugin",[]).config(["$routeProvider","c8yComponentsProvider",t]).factory("kumpan",["c8yInventory","c8yDeviceControl",a]).controller("KumpanCtrl",["$scope","$routeParams","kumpan",e])}(),function(){"use strict";function t(t,a,e,n,i,r,l,s){function c(){var t={status:"ACTIVE",pageSize:1e3};i.list(t).then(o)}function o(t){x.alarms=_.filter(t,function(t){return _.find(w,{id:t.source.id})}),p()}function d(t,a){x.alarms.push(a)}function u(t,a){if("RESOLVED"===a.status)return m(t,a);var e=_.find(x.alarms,{id:a.id});_.assign(e,a)}function m(t,a){var e=_.findIndex(x.alarms,{id:a.id});e>-1&&x.alarms.splice(e,1)}function g(t){w=_.filter(t,function(t){return!!_.isUndefined(a.scooterId)||t.id===a.scooterId}),c()}function p(){var a=t.id;_.forEach(w,function(t){var e="/alarms/"+t.id;n.addListener(a,e,"CREATE",d),n.addListener(a,e,"UPDATE",u),n.addListener(a,e,"DELETE",m),n.switchRealtime(a,e)}),k=!0}function h(t){return f(t)>-1}function y(t){h(t)?E.splice(f(t),1):E.push(t.id)}function f(t){return E.indexOf(t.id)}function v(t){return t.status===i.status.ACTIVE}function b(t,a){t.status=a,i.update(t).then(angular.bind(this,onUpdate,t,a)).then(_.partial(reloadSingleAlarm,t)).then(_.partial(c8yAlert.success,s.getString("Alarm status changed to {{status}}",{status:a})))}var x=this;x.icon=i.icon,x.isActive=v,x.isOpen=h,x.toggle=y,x.changeStatus=b,x.list=c;var k,w,E=[];r.list().then(g)}angular.module("c8y.kumpan.plugin").controller("KumpanAlarmsCtrl",["$scope","$routeParams","c8yInventory","c8yRealtime","c8yAlarms","kumpan","gettext","gettextCatalog",t])}(),function(){"use strict";function t(t,a,e,n,i,r){function l(t){i.relay(s(),c(),t).then(_.partial(n.success,r("Operation created")))}function s(){return t.child&&t.child.config&&t.child.config.device&&t.child.config.device.id}function c(){return t.child&&t.child.config&&t.child.config.relay_id}var o=this;o.on=_.partial(l,!0),o.off=_.partial(l,!1)}angular.module("c8y.kumpan.plugin").controller("KumpanRelayCtrl",["$scope","$routeParams","c8yInventory","c8yAlert","kumpan","gettext",t])}(),function(){"use strict";function t(t){var a;a='<table class="table" ng-controller="KumpanAlarmsCtrl as vm">\n  <tbody>\n\n    <tr data-ng-class="{\'realtime-animation-list\' : realtimeAnimation}" ng-repeat-start="alarm in vm.alarms" class="alarmlist">\n      <td style="width:55px" class="text-center">\n        <i c8y-icon="{{vm.icon(alarm.severity)}}" class="status" data-ng-class="alarm.severity|lowercase" uib-tooltip="{{alarm.severity}}"></i>\n        <i c8y-icon="{{vm.icon(alarm.status)}}" data-ng-class="{\'text-muted\': !vm.isActive(alarm)}" uib-tooltip="{{statusText(alarm)}}"></i>\n      </td>\n      <td style="width:40%">\n        <span class="badge badge-info" data-ng-show="alarm.count>1" uib-tooltip="{{\'First occurrance\' | translate}} {{alarm.firstOccurrenceTime|relativeDateShort}}">{{alarm.count}}</span>\n        <span class="interact" data-ng-click="vm.toggle(alarm)">{{alarm.text}}</span>\n        <a class="text-muted" ng-href="#/device/{{alarm.source.id}}" data-ng-hide="hideDevice">\n          <small><i c8y-icon="cog"></i>{{alarm.source.name || alarm.source.id}}</small>\n        </a>\n\n        <div class="visible-sm visible-xs showOnHover" style="margin-top:10px">\n          <a class="btn btn-xs btn-warning showOnHover" data-ng-click="changeStatus(alarm, \'ACKNOWLEDGED\')" data-ng-show="alarm.status==\'ACTIVE\'">\n            <i c8y-icon="eye"></i> {{\'ack\' | translate}}\n          </a>\n          <a class="btn btn-xs btn-success showOnHover" data-ng-click="changeStatus(alarm, \'CLEARED\')" data-ng-hide="alarm.status==\'CLEARED\'">\n            <i c8y-icon="check-circle"></i> {{\'clear\' | translate}}\n          </a>\n        </div>\n      </td>\n      <td>\n       <!--  <div class="hidden-sm hidden-xs pull-right" stype="display:inline-block">\n          <a class="btn btn-xs btn-warning showOnHover" data-ng-click="changeStatus(alarm, \'ACKNOWLEDGED\')" data-ng-show="alarm.status==\'ACTIVE\'">\n            <i c8y-icon="eye"></i> ack\n          </a>\n          <a class="btn btn-xs btn-success showOnHover" data-ng-click="changeStatus(alarm, \'CLEARED\')" data-ng-hide="alarm.status==\'CLEARED\'">\n            <i c8y-icon="check-circle"></i> clear\n          </a>\n        </div> -->\n        <small class="text-muted"><i c8y-icon="clock-o"></i>{{alarm.time|relativeDateShort}}</small>\n        <small class="text-muted" ng-show="alarm.status==\'CLEARED\'">{{\'was active for\' | translate}} {{alarmDuration(alarm)}}</small>\n\n      </td>\n    </tr>\n    <tr ng-repeat-end ng-if="vm.isOpen(alarm)" style="font-size:0.9em">\n      <td colspan="3" class="row">\n\n        <div class="col-lg-12">\n          <h5><i c8y-icon="bars"></i> {{\'Details\' | translate}}</h5>\n          <table class="table table-condensed table-borderless">\n            <tr>\n              <th style="width:100px" translate>Date</th>\n              <td>{{alarm.time|date:\'medium\'}}</td>\n            </tr>\n            <tr data-ng-repeat="key in getKeys(alarm)">\n              <th style="width:100px">{{key}}</th>\n              <td>{{alarm[key]|json}}</td>\n            </tr>\n          </table>\n        </div>\n\n        <div class="col-lg-12 hidden-xs">\n          <h5><i c8y-icon="code-fork"></i> {{\'History\' | translate}}</h5>\n          <table class="table table-condensed table-responsive table-borderless">\n            <thead>\n              <tr>\n                <th translate>Activity</th>\n                <th translate>Changes</th>\n                <th translate>User</th>\n                <th translate>Application</th>\n                <th translate>Time</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr data-ng-repeat="step in alarm.history.auditRecords">\n                <td>{{step.activity}}</td>\n                <td style="font-size:11px; color: #999; vertical-align:bottom">{{parseChanges(step.changes)}}</td>\n                <td>{{step.user}}</td>\n                <td>{{step.application}}</td>\n                <td>{{step.creationTime|date:"MMM d, y h:mm:ss a"}}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </td>\n    </tr>\n  </tbody>\n</table>\n',t.put("cockpit_kumpan/views/alarms.html",a),t.put("/apps/cockpit/kumpan/views/alarms.html",a),a='<div class="text-center">\n<div class="btn-group" ng-controller="KumpanRelayCtrl as vm">\n  <button type="button" class="btn btn-lg btn-success" ng-click="vm.on()" translate>ON</button>\n  <button type="button" class="btn btn-lg btn-danger" ng-click="vm.off()" translate>OFF</button>\n</div>\n</div>\n',t.put("cockpit_kumpan/views/relay.html",a),t.put("/apps/cockpit/kumpan/views/relay.html",a)}angular.module("c8y.kumpan.plugin").run(["$templateCache",t])}();