/* core_tenants 8.7.2 2017-08-02T09:55:45+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function n(n,t,e,a){n.addNavigation({parent:a("Tenants"),name:a("Subtenants"),path:"tenants",icon:"c8y-sub-tenants",priority:4e3,showIf:["c8yUserUtil",function(n){return n.showTenantManagement()}]}),t.when("/tenants",{templateUrl:"core_tenants/views/list.html",controller:"tenantListCtrl"}),t.when("/tenants/:tenantId",{templateUrl:"core_tenants/views/detail.html",controller:"tenantDetailCtrl",icon:"tasks",name:a("Properties"),priority:4e3}),t.when("/tenants/:tenantId",{templateUrl:"core_tenants/views/customProperties.html",controller:"tenantCustomPropertiesCtrl as vm",icon:"cog",name:a("Custom properties"),priority:3e3,showIf:["$routeParams",function(n){return"new"!==_.get(n,"tenantId")}]}),e.addTitle("/tenants/:tenantId",{data:["$routeParams","c8yTenant",function(n,t){var e=n.tenantId;return e?"new"===e?{title:a("New tenant")}:t.detail(e).then(function(n){return{title:n.data.id}}):{}}]})}n.$inject=["c8yNavigatorProvider","c8yViewsProvider","c8yTitleProvider","gettext"],angular.module("c8y.tenants",[]).config(n)}(),function(){"use strict";function n(n,t,e,a,i,s,r,o,l,c){function d(t){delete n.tenants,r.list().then(m)}function m(t){n.tenants||(n.tenants=[]),t.forEach(function(t){n.tenants.push(t)}),n.paging=t.paging,f(n.tenants.length)}function p(n){t.path("/tenants/"+n.id)}function g(){t.path("/tenants/new")}function u(t){e({title:l("Confirm delete?"),body:c.getString('Do you really want to remove tenant "{{tenantId}}"?',{tenantId:t.id}),status:"danger"}).then(angular.bind(r,r.remove,t)).then(angular.bind(a,a.removeFromList,n.tenants,t))}function h(){n.paging.loading=!0,n.paging.next().then(m).finally(function(){n.paging.loading=!1})}function v(){n.tenants=null,n.refreshLoading=!0,n.paging.refresh().then(m).finally(function(){n.refreshLoading=!1}),n.paging=null}function f(n){var t=c.getPlural(n,"1 tenant","{{$count}} tenants",{});i.changeTitle({title:l("Tenants"),subtitle:_.isUndefined(n)?"":t})}function b(n,t){n.status=t,r.save(n).then(_.partial(s.success,l("Tenant updated"))).then(d)}function w(){r.isCurrentUserTopTenant().then(function(t){n.isTopTenant=t})}function y(n,t){return e({title:l("Confirm suspend?"),body:c.getString('Do you really want to suspend tenant "{{id}}"?',t),status:"danger"}).then(o.askForPassword).then(function(e){e?n(t):s.danger(l("Current password invalid!"))})}var P={ACTIVE:l("ACTIVE"),SUSPENDED:l("SUSPENDED")};n.detail=p,n.add=g,n.onClickDelete=u,n.loadNext=h,n.refresh=v,n.suspendTenant=_.wrap(_.partialRight(b,P.SUSPENDED),y),n.activateTenant=_.partialRight(b,P.ACTIVE),w(),d()}angular.module("c8y.tenants").controller("tenantListCtrl",["$scope","$location","c8yModal","c8yBase","c8yTitle","c8yAlert","c8yTenant","c8yUserUtil","gettext","gettextCatalog",n])}(),function(){"use strict";function n(n,t,e,a,i,s,r,o,l,c,d,m,p){function g(){L&&"new"!==L?i.detail(L).then(function(n){return n.data}).then(u):(n.isNew=!0,u({sendPasswordResetEmail:!0}),o.changeTitle({title:d("New tenant")}),T())}function u(t){var e=t||{};n.storageLimitation.storageLimitPerDeviceEnabled=n.storageLimitation.storageLimitFeatureEnabled&&!!e.storageLimitPerDevice,e.storageLimitPerDevice=(e.storageLimitPerDevice||0)/1024/1024,n.tenant=e}function h(t){n.isNew&&(t.domain=t.id+n.host);var e=_.cloneDeep(t);n.storageLimitation.storageLimitPerDeviceEnabled?e.storageLimitPerDevice=1024*e.storageLimitPerDevice*1024:e.storageLimitPerDevice=0,i.save(e).then(_.partial(v,t))}function v(e){n.isNew&&t.path("/tenants/"+e.id),_.assign(n.tenant,e),l.success(d("Tenant has been saved!"))}function f(t){n[C].confirmPassword.$setValidity("password-mismatch",t===n.tenant.adminPass)}function b(t){var e=[];return n[C][t]&&n[C][t].$error&&_.forEach(n[C][t].$error,function(n,a){n&&(_.isUndefined(k[a])||("object"==typeof k[a]?k[a][t]&&e.push(m.getString(k[a][t])):e.push(m.getString(k[a]))))}),e.join(" ")}function w(){c.checkIfStrongPasswordRequired().then(y)}function y(t){var e=!1;try{e=JSON.parse(t.value)}finally{n.passwordStrengthEnforced=e,e&&n.$watch("passwordStrengthUser.passwordStrength",function(t){t&&n.tenant.adminPass&&n.tenantForm.adminPass.$setValidity("password-strength","GREEN"===n.passwordStrengthUser.passwordStrength)})}}function P(){return D&&(n.tenant&&i.isParentTopTenant(n.tenant)||n.isNew)}function x(){i.isCurrentUserTopTenant().then(function(n){D=n})}function E(){s.current().then(function(t){n.host="."+t.self.split("/")[2].split(".").splice(1).join(".")})}function N(){var n=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1;return Math.round(n/1024/1024)}function T(){var t,e="c8yTenantPolicies",i=!1;a.has(e)&&(i=!0,t=a.get(e),t.list().then(S)),n.selectTenantPolicy=i}function S(t){n.tenantPolicies=_.union([{name:m.getString("None")}],t)}var D,L=e.tenantId,C="tenantForm",k={required:d("This field is required!"),pattern:{id:p.validation.tennantId.message,adminPass:p.validation.password.message,domain:p.validation.domain.message,adminName:p.validation.user.message},url:d("Valid URL required!"),maxlength:{id:d("Up to 32 characters allowed!"),company:d("Up to 256 characters allowed!"),domain:d("Up to 256 characters allowed!"),adminEmail:d("Up to 256 characters allowed!"),adminName:d("Up to 256 characters allowed!")},"password-mismatch":d("Passwords do not match!"),"password-strength":{adminPass:d("Password not good enough, password must be stronger (green).")},email:d("Invalid email address."),min:d("Storage limit must be a positive number."),max:d("Storage limit is too high."),international_number_required:p.validation.internationalPhoneNumber.message};n.passwordPattern=p.validation.password.pattern,n.tennantIdPattern=p.validation.tennantId.pattern,n.domainPattern=p.validation.domain.pattern,n.userPattern=p.validation.user.pattern,n.maxStorageLimitPerDevice=N(),n.passwordStrengthUser={},n.invalid=angular.bind(r,r.invalid,n,C),n.validationHints=b,n.save=h,n.changePasswordConfirm=f,n.shouldShowSubtenantCheckbox=P,n.storageLimitation={storageLimitPerDeviceEnabled:!1,storageLimitFeatureEnabled:r.appOption("storageLimitationFeatureEnabled")},n.humanize=r.humanizeFragment,E(),x(),g(),w()}n.$inject=["$scope","$location","$routeParams","$injector","c8yTenant","c8yUser","c8yBase","c8yTitle","c8yAlert","c8yTenantOptions","gettext","gettextCatalog","c8yConfig"],angular.module("c8y.tenants").controller("tenantDetailCtrl",n)}(),function(){"use strict";function n(n,t,e,a,i,s,r){function o(){return l().then(c).then(function(n){p.schema=n.schema,p.form=n.form,p.tenant=n.tenant})}function l(){return g.list().then(function(n){return _.filter(n,{id:h})})}function c(t){return n.all({schema:g.getSchema(t),form:g.getForm(t,v),tenant:d()})}function d(){return a.detail(u).then(e.getResData)}function m(){return a.save(_.pick(p.tenant,["id","applications","customProperties"])).then(function(){s.success(r("Custom properties saved!"))})}var p=this,g=i.another(i.paths.Tenants),u=t.tenantId,h="c8ySchema!!customProperties",v={notitle:!0};_.assign(p,{schema:{},form:[],save:m}),o()}n.$inject=["$q","$routeParams","c8yBase","c8yTenant","c8yPropertiesLibrary","c8yAlert","gettext"],angular.module("c8y.tenants").controller("tenantCustomPropertiesCtrl",n)}(),function(){"use strict";function n(n){var t;t='<div class="row">\r\n  <form name="tenantCustomPropertiesForm" novalidate>\r\n    <c8y-schema-form schema="vm.schema" form="vm.form" model="vm.tenant">\r\n    </c8y-schema-form>\r\n\r\n    <button class="btn btn-primary" ng-disabled="tenantCustomPropertiesForm.$invalid" ng-click="vm.save()" translate>\r\n      Save\r\n    </button>\r\n  </form>\r\n</div>\r\n',n.put("core_tenants/views/customProperties.html",t),n.put("/apps/core/tenants/views/customProperties.html",t),t='<div class="row">\n  <form name="tenantForm" novalidate class="col-lg-6">\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'id\')}" ng-if="!isNew">\n      <label>{{\'ID\' | translate}} *</label>\n      <input type="text" class="form-control" ng-model="tenant.id" name="id" required ng-pattern="tennantIdPattern" ng-maxlength="32" ng-disabled="!isNew" uib-tooltip="{{validationHints(\'id\')}}">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'id\')}" ng-if="isNew">\n      <label>{{\'Domain / URL\' | translate}} *</label>\n      <div class="input-group">\n        <input type="text" class="form-control" ng-model="tenant.id" name="id" required ng-pattern="tennantIdPattern" ng-maxlength="32" uib-tooltip="{{validationHints(\'id\')}}">\n        <span class="input-group-addon">{{host}}</span>\n      </div>\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'domain\')}" ng-if="!isNew">\n      <label>{{\'Domain / URL\' | translate}} *</label>\n      <input type="text" class="form-control" ng-model="tenant.domain" name="domain" required ng-pattern="domainPattern" ng-maxlength="256" uib-tooltip="{{validationHints(\'domain\')}}">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'company\')}">\n      <label>{{\'Name\' | translate}} *</label>\n      <input type="text" class="form-control" ng-model="tenant.company" name="company" required ng-maxlength="256" uib-tooltip="{{validationHints(\'company\')}}">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'adminEmail\')}">\n      <label><span translate>Administrator\'s email</span> <span ng-show="tenant.sendPasswordResetEmail || tenant.adminName || tenant.adminPass">*</span></label>\n      <input type="email" class="form-control" name="adminEmail" ng-model="tenant.adminEmail" ng-maxlength="256" uib-tooltip="{{validationHints(\'adminEmail\')}}" c8y-autocomplete="off" ng-required="tenant.sendPasswordResetEmail || tenant.adminName || tenant.adminPass" ng-disabled="!isNew && !tenant.adminName">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'adminName\')}">\n      <label><span translate>Administrator\'s username</span> <span ng-show="tenant.adminPass || tenant.adminEmail">*</span></label>\n      <input type="text" class="form-control" name="adminName" ng-model="tenant.adminName" ng-maxlength="256" ng-required="tenant.adminPass || tenant.adminEmail" ng-disabled="!isNew" ng-pattern="userPattern" uib-tooltip="{{validationHints(\'adminName\')}}" c8y-autocomplete="off">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'contactName\')}">\n      <label>{{\'Contact name\' | translate}}</label>\n      <input type="text" class="form-control" ng-model="tenant.contactName" name="contactName" ng-maxlength="30">\n    </div>\n\n    <div class="form-group" ng-class="{\'has-error\': invalid(\'contactPhone\')}">\n      <label>{{\'Contact phone\' | translate}}</label>\n      <input type="text" class="form-control" c8y-autocomplete="off" c8y-phone-number ng-model="tenant.contactPhone" uib-tooltip="{{validationHints(\'contactPhone\')}}" name="contactPhone" ng-maxlength="20">\n    </div>\n\n    <div class="form-group" ng-if="isNew">\n      <div class="checkbox">\n        <label style="margin-right: 10px">\n          <input type="checkbox" ng-model="tenant.sendPasswordResetEmail" name="sendPasswordResetEmail">\n          <span translate>Send password reset link as e-mail</span>\n        </label>\n      </div>\n    </div>\n\n    <div class="row" ng-if="!tenant.sendPasswordResetEmail">\n      <div class="col-xs-6">\n        <div class="form-group" ng-class="{\'has-error\': invalid(\'adminPass\')}">\n          <label><span translate>Administrator\'s password</span> <span ng-show="isNew && (tenant.adminName || tenant.adminEmail)">*</span></label>\n          <input type="password" class="form-control" ng-model="tenant.adminPass" name="adminPass" ng-pattern="passwordPattern" ng-required="isNew && (tenant.adminName || tenant.adminEmail)" uib-tooltip="{{validationHints(\'adminPass\')}}" ng-disabled="!isNew && !tenant.adminName" c8y-autocomplete="off">\n        </div>\n\n        <div class="form-group" ng-if="tenant.adminPass" ng-class="{\'has-error\': invalid(\'confirmPassword\')}">\n          <label>{{\'Confirm password\' | translate}} *</label>\n          <input type="password" name="confirmPassword" class="form-control" ng-model="$parent.confirmPassword" required ng-change="changePasswordConfirm($parent.confirmPassword)" uib-tooltip="{{validationHints(\'confirmPassword\')}}" c8y-autocomplete="off">\n        </div>\n      </div>\n      <div ng-if="tenant.adminPass.length >= 8">\n        <div class="col-xs-6" ng-if="passwordStrengthEnforced" style="padding-left: 0">\n          <c8y-password-strength-checklist password="tenant.adminPass">\n          </c8y-password-strength-checklist>\n        </div>\n        <div class="col-xs-12">\n          <div c8y-password-strength user="passwordStrengthUser" password="tenant.adminPass"></div>\n        </div>\n      </div>\n    </div>\n\n    <div class="form-group" ng-if="storageLimitation.storageLimitFeatureEnabled">\n      <div class="checkbox">\n        <label>\n          <input type="checkbox" ng-model="storageLimitation.storageLimitPerDeviceEnabled" name="storageLimitPerDeviceEnabled">\n          <span translate>Limit storage per device</span>\n        </label>\n      </div>\n    </div>\n\n    <div ng-if="storageLimitation.storageLimitFeatureEnabled && storageLimitation.storageLimitPerDeviceEnabled" ng-class="{\'has-error\': invalid(\'storageLimitPerDevice\')}">\n      <label style="margin-right: 10px">{{\'Storage limit per device (MB)\' | translate}} *</label>\n        <input style="max-width: 300px" type="number" class="form-control" ng-model="tenant.storageLimitPerDevice" name="storageLimitPerDevice" min="1" max="{{maxStorageLimitPerDevice}}" uib-tooltip="{{validationHints(\'storageLimitPerDevice\')}}" required>\n    </div>\n\n    <div class="form-group" ng-if="selectTenantPolicy">\n      <label>{{\'Tenant policy\' | translate}}</label>\n      <select class="form-control" name="tenantPolicyId" ng-model="tenant.tenantPolicyId" ng-options="policy.id as policy.name for policy in tenantPolicies">\n      </select>\n    </div>\n\n    <div class="form-group" ng-if="shouldShowSubtenantCheckbox()">\n      <div class="checkbox">\n        <label style="margin-right: 10px">\n          <input type="checkbox" ng-model="tenant.allowCreateTenants" name="allowCreateTenants">\n          <span translate>Allow creation of subtenants</span>\n        </label>\n      </div>\n    </div>\n\n    <button class="btn btn-primary" ng-click="save(tenant)" ng-show="tenant" ng-disabled="tenantForm.$invalid" translate>\n      Save\n    </button>\n  </form>\n</div>\n',n.put("core_tenants/views/detail.html",t),n.put("/apps/core/tenants/views/detail.html",t),t='<div>\n  <div>\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n    <a href="" class="btn btn-link pull-right" ng-click="add()">\n      <i c8y-icon="plus"></i> {{\'Create tenant\' | translate}}\n    </a>\n    <c8y-download-emails-list></c8y-download-emails-list>\n  </div>\n\n  <div class="alert alert-warning" ng-show="tenants.length == 0" style="clear:both" translate>\n    No tenants found.\n  </div>\n\n  <table class="table table-hover">\n    <tr>\n      <th style="width:20px"></th>\n      <th translate>Id</th>\n      <th translate>Name</th>\n      <th translate>Domain</th>\n      <th translate>Contact name</th>\n      <th translate>Phone</th>\n      <th translate>External reference</th>\n      <th translate>Creation time</th>\n      <th translate ng-if="isTopTenant">Parent tenant</th>\n      <th>&nbsp;</th>\n    </tr>\n    <tr ng-repeat="tenant in tenants|orderBy:\'id\'">\n      <td class="text-center">\n        <i c8y-icon="check-circle text-success" uib-tooltip="{{tenant.status | translate}}" ng-show="tenant.status == \'ACTIVE\'"></i>\n        <i c8y-icon="times-circle text-danger" uib-tooltip="{{tenant.status | translate}}" ng-show="tenant.status == \'SUSPENDED\'"></i>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.id}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.company}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.domain}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.contactName}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.contactPhone}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.customProperties && tenant.customProperties.externalReference}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)">\n        <span class="interact">{{tenant.creationTime | absoluteDate}}</span>\n      </td>\n      <td class="interact" ng-click="detail(tenant)" ng-if="isTopTenant">\n        <span class="interact">{{tenant.parent}}</span>\n      </td>\n      <td class="text-right">\n        <a href="" class="btn btn-xs btn-danger showOnHover" title="{{\'Suspend tenant\' | translate}}" data-ng-click="suspendTenant(tenant)" ng-show="tenant.status==\'ACTIVE\'">\n          {{\'Suspend\' | translate}}\n        </a>\n        <a href="" class="btn btn-xs btn-success showOnHover" title="{{\'Activate tenant\' | translate}}" data-ng-click="activateTenant(tenant)" ng-show="tenant.status==\'SUSPENDED\'">\n          {{\'Activate\' | translate}}\n        </a>\n        <a href="" class="btn btn-xs btn-danger showOnHover" title="{{\'Remove tenant\' | translate}}" data-ng-click="onClickDelete(tenant)" ng-if="isTopTenant">\n          <i c8y-icon="times"></i>\n        </a>\n      </td>\n    </tr>\n  </table>\n\n  <c8y-load-more></c8y-load-more>\n</div>\n',n.put("core_tenants/views/list.html",t),n.put("/apps/core/tenants/views/list.html",t)}angular.module("c8y.tenants").run(["$templateCache",n])}();