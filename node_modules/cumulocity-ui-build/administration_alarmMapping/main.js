/* administration_alarmMapping 8.7.2 2017-08-02T09:53:13+00:00 79d3e7d78638 (hotfix/8.7.2) tip */
angular.module("c8y.parts.alarmMapping",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(n,t,a){"use strict";n.addNavigation({parent:a("Business rules"),name:a("Alarm mapping"),path:"alarmmapping",icon:"bell",priority:2900}),t.when("/alarmmapping",{templateUrl:"administration_alarmMapping/views/index.html"})}]),function(){"use strict";function n(n,t,a,e,i,o,l){function r(t){n.options=t,x(t.length)}function s(n){var t=n.value.split("|");return n.severity=t.shift(),n.description=t.join("|"),delete n.value,n}function c(n){return{key:n.key,category:n.category,value:n.severity+"|"+(n.description||"")}}function p(n){return _.map(n,s)}function d(){var a={category:C};n.loading=!0,t.detail(a).then(u).then(p).then(r).finally(function(){n.loading=!1})}function u(n){return _.map(n.data,function(n,t){return{category:C,value:n,key:t}})}function b(n){return _.cloneDeep(n)}function g(n){return a.icon(n)||"circle"}function m(n){return"NONE"===n?"text-muted":n}function y(n){return A.indexOf(n)}function v(n){return y(n)>-1}function f(n){v(n)?A.splice(y(n),1):A.push(n)}function h(){n.newOption={category:C,severity:"WARNING"}}function w(){delete n.newOption}function O(n){return!n.self}function k(a){var e=(O(a)?"create":"update")+"Option",i=c(a);t[e](i).finally(function(){delete n.newOption}).then(d)}function N(n){var a=c(n);e({title:o("Confirm delete?"),body:l.getString('Do you really want to alarm mapping for alarm type "{{optionKey}}"?',{optionKey:n.key}),status:"danger"}).then(angular.bind(t,t.deleteOption,a)).then(d)}function x(n){i.changeTitle({title:o("Alarm mapping"),subtitle:_.isUndefined(n)?"":l.getString("{{qty}} mappings",{qty:n})})}var C="alarm.type.mapping",A=[],M=o("Alarm mappings automatically transform the description and severity based on alarm type matching. Alarm types are a defined property of each alarm created on the platform.");n.severities=_.keys(a.severity),n.severities.push("NONE"),n.icon=g,n.iconClass=m,n.isOpen=v,n.toggle=f,n.getOptionCopy=b,n.refresh=d,n.add=h,n.cancelAdd=w,n.save=k,n.onClickDelete=N,n.helpText=M,d(),x()}n.$inject=["$scope","c8ySettings","c8yAlarms","c8yModal","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.alarmMapping").controller("alarmMappingCtrl",n)}(),function(){"use strict";function n(n){var t;t='<div data-ng-controller="alarmMappingCtrl">\n\n  <div class="clearfix">\n    <button type="button" class="btn btn-link pull-right" ng-disabled="loading" ng-click="refresh()">\n      <i c8y-icon="refresh" ng-class="{\'fa-spin\': loading}"></i> {{\'Reload\' | translate}}\n    </button>\n\n    <a href="" class="btn btn-link pull-right" data-ng-click="add()">\n        <i c8y-icon="plus"></i> {{\'Add alarm mapping\' | translate }}\n    </a>\n    <a href="" uib-popover="{{helpText | translate}}" popover-placement="bottom" popover-trigger="mouseenter" class="btn btn-link pull-right">\n      <i c8y-icon="question-circle"></i>\n    </a>\n  </div>\n\n  <div class="alert alert-warning" ng-show="options.length === 0" translate>\n    There are no alarm mappings defined\n  </div>\n\n  <form role="form" name="newOptionForm" class="panel-body" ng-if="newOption" novalidate>\n    <div class="row">\n      <div class="form-group col-lg-4">\n        <label translate>Alarm type to match</label>\n        <input type="text" class="form-control" ng-model="newOption.key" required>\n      </div>\n      <div class="form-group col-lg-4">\n        <label translate>New severity</label>\n        <div class="form-control-static">\n        <div class="btn-group">\n          <button type="button" class="btn btn-default" ng-model="newOption.severity" uib-btn-radio="\'NONE\'">\n            <i c8y-icon="circle" class="text-muted"></i>\n            <translate>Drop</translate>\n          </button>\n          <button type="button" class="btn btn-default" ng-model="newOption.severity" uib-btn-radio="\'CRITICAL\'">\n            <i c8y-icon="{{icon(\'critical\')}}" class="status critical"></i>\n            <translate>Critical</translate>\n          </button>\n          <button type="button" class="btn btn-default" ng-model="newOption.severity" uib-btn-radio="\'MAJOR\'">\n            <i c8y-icon="{{icon(\'major\')}}" class="status major"></i>\n            <translate>Major</translate>\n          </button>\n          <button type="button" class="btn btn-default" ng-model="newOption.severity" uib-btn-radio="\'MINOR\'">\n            <i c8y-icon="{{icon(\'minor\')}}" class="status minor"></i>\n            <translate>Minor</translate>\n          </button>\n          <button type="button" class="btn btn-default" ng-model="newOption.severity" uib-btn-radio="\'WARNING\'">\n            <i c8y-icon="{{icon(\'warning\')}}" class="status warning"></i>\n            <translate>Warning</translate>\n          </button>\n        </div>\n      </div>\n      </div>\n      <div class="form-group col-lg-4">\n        <label translate>New description</label>\n        <input type="text" class="form-control" ng-model="newOption.description">\n      </div>\n    </div>\n\n    <button class="btn btn-primary" ng-click="save(newOption)" ng-disabled="newOptionForm.$invalid" translate>Save</button>\n    <button class="btn btn-default" ng-click="cancelAdd()" translate>Cancel</button>\n  </form>\n\n  <table class="table">\n    <tr ng-repeat-start="option in options" ng-class="{active: isOpen(option)}">\n      <td style="width:30px">\n        <i c8y-icon="{{icon(option.severity)}}" class="status" ng-class="iconClass(option.severity)|lowercase" uib-tooltip="{{option.severity | translate}}"></i>\n      </td>\n      <td class="interact" ng-click="toggle(option)">\n        <span>{{option.key}}</span>\n        <small class="text-muted" ng-bind="option.description || \'<kept as is>\'"></small>\n      </td>\n      <td class="text-right">\n          <button class="btn btn-danger btn-xs showOnHover" title="{{\'Delete firmware\' | translate}}" data-ng-click="onClickDelete(option)">\n            <i c8y-icon="times"></i>\n          </button>\n        </td>\n    </tr>\n    <tr ng-repeat-end data-ng-if="isOpen(option)">\n        <td colspan="3" data-ng-init="optionToEdit = getOptionCopy(option)">\n          <form role="form" name="optionForm" novalidate>\n            <div class="row">\n              <div class="form-group col-lg-4">\n                <label translate>Alarm type to match</label>\n                <input type="text" class="form-control" ng-model="optionToEdit.key" disabled="disabled">\n              </div>\n              <div class="form-group col-lg-4">\n                <label translate>New severity</label>\n                <div class="form-control-static">\n                <div class="btn-group">\n                  <button type="button" class="btn btn-default" ng-model="optionToEdit.severity" uib-btn-radio="\'NONE\'">\n                    <i c8y-icon="circle" class="text-muted"></i>\n                    <translate>Drop</translate>\n                  </button>\n                  <button type="button" class="btn btn-default" ng-model="optionToEdit.severity" uib-btn-radio="\'CRITICAL\'">\n                    <i c8y-icon="{{icon(\'critical\')}}" class="status critical"></i>\n                    <translate>Critical</translate>\n                  </button>\n                  <button type="button" class="btn btn-default" ng-model="optionToEdit.severity" uib-btn-radio="\'MAJOR\'">\n                    <i c8y-icon="{{icon(\'major\')}}" class="status major"></i>\n                    <translate>Major</translate>\n                  </button>\n                  <button type="button" class="btn btn-default" ng-model="optionToEdit.severity" uib-btn-radio="\'MINOR\'">\n                    <i c8y-icon="{{icon(\'minor\')}}" class="status minor"></i>\n                    <translate>Minor</translate>\n                  </button>\n                  <button type="button" class="btn btn-default" ng-model="optionToEdit.severity" uib-btn-radio="\'WARNING\'">\n                    <i c8y-icon="{{icon(\'warning\')}}" class="status warning"></i>\n                    <translate>Warning</translate>\n                  </button>\n                </div>\n              </div>\n              </div>\n              <div class="form-group col-lg-4">\n                <label translate>New description</label>\n                <input type="text" class="form-control" ng-model="optionToEdit.description">\n              </div>\n            </div>\n\n            <button class="btn btn-primary" ng-click="save(optionToEdit)" ng-disabled="optionForm.$invalid" translate>Save</button>\n            <button class="btn btn-default" ng-click="toggle(option)" translate>Cancel</button>\n          </form>\n        </td>\n      </tr>\n  </table>\n\n</div>\n',n.put("administration_alarmMapping/views/index.html",t),n.put("/apps/administration/alarmMapping/views/index.html",t)}angular.module("c8y.parts.alarmMapping").run(["$templateCache",n])}();