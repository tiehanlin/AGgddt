/* core_platformConfiguration 8.7.2 2017-08-02T09:55:08+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function t(t){t.init()}t.$inject=["c8yPlatformConfigurationUiProvider"],angular.module("c8y.platformConfiguration",[]).config(t)}(),function(){"use strict";function t(t,e,n){function i(){r(),a()}function r(){t.when("/"+s.path,s.view)}function a(){e.addNavigation({name:n("Configuration"),parent:n("Settings"),path:s.path,icon:s.icon,showIfPermissions:{anyRole:s.requiresAnyRole},showIf:s.showIf})}function o(t,e,n,i,r){function a(){return t.when({type:"object",properties:{"system.password.enforce.strength":{title:r.getString('Enforce "green" passwords for all users'),type:"boolean"},"system.password.limit.validity":{title:r.getString("Password validity limit (days)"),description:r.getString("Leave empty to use value from tenant options"),type:"number",minimum:0,maximum:999999},"system.password.history.size":{title:r.getString("Password history size"),type:"number",minimum:0,"x-schema-form":{placeholder:r.getString("e.g.: 10")}},"system.password.green.min-length":{title:r.getString('Minimal length of "green" password'),description:r.getString("Leave empty to skip this constraint"),type:"number",minimum:0},"default.tenant.applications":{title:r.getString("Default applications for new tenants"),description:r.getString("Comma-separated list of application names"),type:"string","x-schema-form":{placeholder:r.getString("e.g.: administration,devicemanagement,cockpit")}},"email.protocol":{title:r.getString("Protocol"),type:"string",enum:["smtp"],"x-schema-form":{titleMap:[{value:"smtp",name:"SMTP"}]}},"email.host":{title:r.getString("Host"),type:"string","x-schema-form":{placeholder:r.getString("e.g.: localhost")}},"email.port":{title:r.getString("Port"),type:"number",minimum:1,maximum:65535,"x-schema-form":{placeholder:r.getString("e.g.: 25")}},"email.username":{title:r.getString("Username"),type:"string"},"email.password":{title:r.getString("Password"),type:"string","x-schema-form":{type:"password"}},"email.from":{title:r.getString("Sender address"),type:"string","x-schema-form":{type:"email"}},"passwordReset.sendNotificationToUnknownEmails":{title:r.getString("Send notifications to unknown e-mail addresses"),type:"boolean"},"passwordReset.email.subject":{title:r.getString("E-mail subject"),description:r.getString("Subject used for all password reset related e-mails"),type:"string"},"passwordReset.token.email.template":{title:r.getString("Password reset e-mail template (when address is known)"),description:r.getString("Placeholders: {host}, {token}. Whole link to reset password can be e.g.: {host}/apps/devicemanagement/index.html?token={token}"),type:"string","x-schema-form":{type:"textarea"}},"passwordReset.user.not.found.email.template":{title:r.getString("Password reset e-mail template (when address is not known)"),type:"string","x-schema-form":{type:"textarea"}},"passwordReset.success.email.template":{title:r.getString("Password change confirmation e-mail template"),description:r.getString("Placeholder: {host}"),type:"string","x-schema-form":{type:"textarea"}},"passwordReset.invite.template":{title:r.getString("Invitation e-mail template"),description:r.getString("Placeholders: {host}, {token}. Whole link to setup password can be e.g.: {host}/apps/devicemanagement/index.html?token={token}"),type:"string","x-schema-form":{type:"textarea"}},"export.data.mail.subject":{title:r.getString("E-mail subject"),description:r.getString("Placeholders: {host}, {binaryId}. Whole link to result file is: {host}/inventory/binaries/{binaryId}"),type:"string"},"export.data.mail.text":{title:r.getString("E-mail template"),description:r.getString("Placeholders: {host}, {binaryId}. Whole link to result file is: {host}/inventory/binaries/{binaryId}"),type:"string","x-schema-form":{type:"textarea"}},"export.data.mail.text.userunauthorized":{title:r.getString("User unauthorized error message"),description:r.getString("Placeholders: {user}, {exportApi}"),type:"string"},"two-factor-authentication.token.sms.template":{title:r.getString("Verification token SMS template"),description:r.getString("Placeholder: {token} - generated token"),type:"string","x-schema-form":{placeholder:r.getString("e.g.: Verification code: {token}")}},"storageLimit.warning.email.subject":{title:r.getString("Warning e-mail subject"),description:r.getString("E-mail sent one day before data removal is performed"),type:"string"},"storageLimit.warning.email.template":{title:r.getString("Warning e-mail template"),description:r.getString("E-mail sent one day before data removal is performed. Placeholders: {tenant}, {size} - storage usage in %"),type:"string","x-schema-form":{type:"textarea"}},"storageLimit.process.email.subject":{title:r.getString("Limit exceeded e-mail subject"),description:r.getString("E-mail sent after over-limit data has been removed"),type:"string"},"storageLimit.process.email.template":{title:r.getString("Limit exceeded e-mail template"),description:r.getString("E-mail sent after over-limit data has been removed. Placeholders: {tenant}, {size} - storage usage in %"),type:"string","x-schema-form":{type:"textarea"}},"tenantSuspend.mail.sendtosuspended":{title:r.getString("Send e-mail to suspended tenant's administrator"),type:"boolean"},"tenantSuspend.mail.additional.address":{title:r.getString("Tenant suspended e-mail additional receiver"),type:"string","x-schema-form":{type:"email"}},"tenantSuspend.mail.subject":{title:r.getString("Tenant suspended e-mail subject"),description:r.getString("Placeholder: {tenant} - suspended tenant's id"),type:"string"},"tenantSuspend.mail.text":{title:r.getString("Tenant suspended e-mail template"),description:r.getString("Placeholder: {tenant} - suspended tenant's id"),type:"string","x-schema-form":{type:"textarea"}},"system.support-user.enabled":{title:r.getString("Enable support user"),description:r.getString("Possible values: true, false, date until user should remain enabled"),type:"string","x-schema-form":{placeholder:r.getString("e.g.: {{expireDate}}",{expireDate:moment().add(1,"day").format(e.dateFullFormat)})}}}})}function o(){return t.when([_.map(v,s),_.map(S,s)])}function s(t){var e={type:"fieldset"};return _.assign(e,t),e.items=_.map(e.items,function(t){return{key:[t]}}),e}function m(){return i.hasAnyRole(["ROLE_OPTION_MANAGEMENT_ADMIN"]).then(function(t){return{formDefaults:{readonly:!t}}})}function c(){var e=a(),i=n.list({category:l});return t.all({schema:e,options:i}).then(function(t){return _.transform(t.options,function(e,i){var r=i.key;e[r]=n.parseOptionRawValue(i.value);var a=_.get(t.schema,["properties",r,"type"]);"string"===a&&(e[r]=e[r].toString())},{})})}function p(t,e){var n=g(t,e);return d(n)}function g(t,e){return _(t).map(function(t,n){var i,r=_.get(e,[n]),a=t;return _.isEqual(r,a)||(i={key:n,oldValue:r,newValue:a}),i}).filter().value()}function d(e){return _.reduce(e,function(e,i){var r=_.constant(t.when()),a=_.isNull(i.newValue),o=""===i.newValue;return a||o?_.isUndefined(i.oldValue)||(r=n.deleteOption):r=n.updateOption,e.then(_.partial(r,{category:l,key:i.key,value:i.newValue}))},t.when())}return{getSchema:a,getForm:o,getSchemaFormOptions:m,getConfiguration:c,saveConfiguration:p}}o.$inject=["$q","c8yBase","c8ySettings","c8yPermissions","gettextCatalog"];var s={path:"configuration",icon:"sliders",view:{template:"<c8y-platform-configuration-form></c8y-platform-configuration-form>"},requiresAnyRole:["ROLE_OPTION_MANAGEMENT_READ"],showIf:["c8yTenant",function(t){return t.isCurrentUserTopTenant()}]},l="configuration",m={title:n("Applications"),items:["default.tenant.applications"]},c={title:n("Passwords"),items:["system.password.enforce.strength","system.password.limit.validity","system.password.history.size","system.password.green.min-length"]},p={title:n("Two-factor authentication"),items:["two-factor-authentication.token.sms.template"]},g={title:n("Password reset"),items:["passwordReset.sendNotificationToUnknownEmails","passwordReset.token.email.template","passwordReset.user.not.found.email.template","passwordReset.email.subject","passwordReset.success.email.template","passwordReset.invite.template"]},d={title:n("Support user"),items:["system.support-user.enabled"]},u={title:n("E-mail server"),items:["email.protocol","email.host","email.port","email.username","email.password","email.from"]},f={title:n("Data export"),items:["export.data.mail.subject","export.data.mail.text","export.data.mail.text.userunauthorized"]},h={title:n("Storage limit"),items:["storageLimit.warning.email.subject","storageLimit.warning.email.template","storageLimit.process.email.subject","storageLimit.process.email.template"]},y={title:n("Suspending tenants"),items:["tenantSuspend.mail.sendtosuspended","tenantSuspend.mail.additional.address","tenantSuspend.mail.subject","tenantSuspend.mail.text"]},v=[m,c,p,g,d],S=[u,f,h,y];return{$get:o,init:i,hookViews:r}}t.$inject=["c8yViewsProvider","c8yNavigatorProvider","gettext"],angular.module("c8y.platformConfiguration").provider("c8yPlatformConfigurationUi",t)}(),function(){"use strict";function t(t,e,n,i,r){function a(){return o()}function o(){return e.all({schema:n.getSchema(),form:n.getForm(),options:n.getSchemaFormOptions(),configuration:n.getConfiguration()}).then(function(t){c=_.cloneDeep(t.configuration),_.assign(p,t)})}function s(){var e=_.get(p,"options.formDefaults.readonly"),n=_.get(t,"platformConfigurationForm1.$invalid")||_.get(t,"platformConfigurationForm2.$invalid");return!e&&!n}function l(){return n.saveConfiguration(p.configuration,c).then(o).then(_.partial(i.success,r("Configuration saved successfully!")))}function m(){return o().then(_.partial(i.success,r("Configuration reloaded!")))}var c,p=this;_.assign(p,{$onInit:a,canSave:s,save:l,cancel:m})}t.$inject=["$scope","$q","c8yPlatformConfigurationUi","c8yAlert","gettext"],angular.module("c8y.platformConfiguration").component("c8yPlatformConfigurationForm",{templateUrl:"core_platformConfiguration/platformConfigurationForm.html",controller:t,controllerAs:"vm"})}(),function(){"use strict";function t(t){var e;e='<c8y-ui-title-set title="\'Configuration\' | translate"></c8y-ui-title-set>\r\n\r\n<div>\r\n  <div class="row">\r\n    <div class="col-lg-5 col-md-6 col-sm-12">\r\n      <div class="card">\r\n        <div class="card-block">\r\n          <form name="platformConfigurationForm1" novalidate>\r\n            <c8y-schema-form schema="vm.schema" form="vm.form[0]" model="vm.configuration" options="vm.options">\r\n            </c8y-schema-form>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="col-lg-5 col-md-6 col-sm-12">\r\n      <div class="card">\r\n        <div class="card-block">\r\n          <form name="platformConfigurationForm2" novalidate>\r\n            <c8y-schema-form schema="vm.schema" form="vm.form[1]" model="vm.configuration" options="vm.options">\r\n            </c8y-schema-form>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <hr>\r\n\r\n  <div class="text-center">\r\n    <button class="btn btn-primary" type="button" ng-click="vm.save()" ng-disabled="!vm.canSave()" translate>\r\n      Save\r\n    </button>\r\n    <button type="button" ng-click="vm.cancel()" class="btn btn-default" translate>\r\n      Cancel\r\n    </button>\r\n  </div>\r\n</div>\r\n',t.put("core_platformConfiguration/platformConfigurationForm.html",e),t.put("/apps/core/platformConfiguration/platformConfigurationForm.html",e)}angular.module("c8y.platformConfiguration").run(["$templateCache",t])}();