/* core_eConnectBike 8.7.2 2017-08-02T09:54:16+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function e(e,t,n){e.addComponentGroup({name:"routesExportServices",label:n("Routes export services"),priority:1e3}),e.addComponent({path:"/komoot",priority:1e3,template:'<export-routes-connect external-service-name="komoot" on-routes-visibility-updated="updateRoutesVisibilitySettings(args)"on-routes-exporting-disconnected="disconnectRoutesExportingService(\'komoot\')"></export-routes-connect>',ngStyle:{float:"left",marginRight:"1.6em"},controller:t.createUiRouteController("komoot")},"routesExportServices"),e.addComponent({path:"/strava",priority:1e3,template:'<export-routes-connect external-service-name="strava" on-routes-visibility-updated="updateRoutesVisibilitySettings(args)"on-routes-exporting-disconnected="disconnectRoutesExportingService(\'strava\')"></export-routes-connect>',ngStyle:{float:"left"},controller:t.createUiRouteController("strava")},"routesExportServices")}e.$inject=["c8yUserSettingsBlocksProvider","exportRoutesRedirectProvider","gettext"],angular.module("econnect",["leaflet-directive"]).config(e)}(),function(){"use strict";function e(){"ngInject"}angular.module("econnect").component("eStatus",{template:"<div><span>{{$ctrl.status | translate}}</span> <i c8y-icon='{{$ctrl.icon}}'></i> </div>",bindings:{icon:"<",status:"<"},controller:e})}(),function(){"use strict";angular.module("econnect").component("eEntry",{templateUrl:"core_eConnectBike/components/entry/entry.html",transclude:{iconSlot:"?icon",nameSlot:"?name",valueSlot:"?value"},bindings:{name:"@",tooltip:"<",icon:"@"}})}(),function(){"use strict";function e(e,t,n,i,o,a,r,c,s){function l(){return d({withTotalPages:!0}).then(function(e){m.$totalRoutes=e.statistics.totalPages*e.statistics.pageSize}).then(function(){m.$totalRoutes=m.$totalRoutes||m.bike.c8y_NumberOfRoutes+m.bike.c8y_NumberOfThefts||0})}function u(e){return d(e).then(function(e){return e[0]}).then(function(e){return e&&e.time}).catch(function(){return null})}function d(e){return r.list(_.assign({source:m.bike.id,fragmentType:"c8y_Route",pageSize:1},e||{}))}function p(e){if(!(e&&e.Charge_Active&&e.Charge_Active.Switch))return{status:n("Unknown"),class:"statusAlert"};var t=e.Charge_Active.Switch;return t.value?{status:n("Charging"),class:"statusOk"}:{status:n("Discharging"),class:"statusNok"}}function v(e){return a.isDeviceAvailable(e)?{status:n("Connected"),class:"statusOk",icon:"check"}:a.isDeviceMaintenance(e)?{status:n("Maintenance"),class:"statusAlert",icon:"wrench"}:{status:n("Disconnected"),class:"statusNok",icon:"warning"}}function g(e){return e&&1===e.c8y_BikeLocked?{status:n("Locked"),class:"statusNok",icon:"lock"}:{status:n("Unlocked"),class:"statusOk",icon:"unlock-alt"}}var m=this;m.durationInterpolationFormat=i.getString("{{d}} days {{HHmm}} hours");var f=[{min:99,max:99,icon:"signal-strength-0",class:"statusNok"},{min:0,max:0,icon:"signal-strength-0",class:"statusNok"},{min:0,max:4,icon:"signal-strength-1",class:"statusAlert"},{min:5,max:7,icon:"signal-strength-2",class:"statusOk"},{min:8,max:11,icon:"signal-strength-3",class:"statusOk"},{min:12,max:31,icon:"signal-strength-4",class:"statusOk"}];m.$initialized=!1,m.$signal={level:0},m.$battery={level:0},m.$collapse=!1,m.$telemetryDeviceTooltip=n("This information refers to the telemetry device attached to the bicycle."),m.$onInit=function(){m.list&&m.list.register(m),m.isSingle()?m.expand():m.close(),m.watchBike()},m.expand=function(){m.initialize().then(function(){m.$collapse=!1})},m.watchBike=function(){return s.detailRealtime(m.bike,e).then(function(t){e.$bike=t})},m.initialize=function(){function e(){return c.latest({device:m.bike.id,fragment:"Charge_Active",series:"Switch"},!0).then(function(e){e&&(m.$battery.status=e)})}function o(){return c.latest({device:m.bike.id,fragment:"Akkuzustand",series:"Akkustand"},!0).then(function(e){m.$battery.level=e})}function a(){return c.latest({device:m.bike.id,fragment:"OBUB",series:"Signal"},!0).then(function(e){m.$signal.level=e})}function r(){return t.all([s(),d()]).then(function(e){e[0]&&e[1]?m.$totalRoutesTooltip=i.getString("Includes routes, time and distance<br /> from {{from | absoluteDate}}<br /> to {{till | absoluteDate}}",{from:e[0],till:e[1]}):m.$totalRoutesTooltip=n("Unable to load period for total calculations")})}function s(){return u()}function d(){return u({reverse:!0})}return m.$initialized?t.resolve():t.all([e(),o(),a(),r(),l()]).then(function(){m.$initialized=!0})},m.$signalRanges=f,m.toggle=function(){var e=m.$collapse;m.onToggle&&m.onToggle(),e?m.expand():m.close()},m.$availability=function(){return v(e.$bike)},m.$lock=function(){return g(e.$bike)},m.close=function(){m.$collapse=!0},m.isSingle=function(){return m.list&&1==m.list.$list.length},m.charging=function(){return p(m.$battery.status)}}e.$inject=["$scope","$q","gettext","gettextCatalog","c8yBase","c8yDeviceStatus","c8yEvents","c8yMeasurements","c8yInventory"],angular.module("econnect").component("eBike",{require:{list:"?^eBikes"},templateUrl:"core_eConnectBike/components/bike/bike.html",bindings:{bike:"<",onToggle:"&"},controller:e})}(),function(){"use strict";function e(e,t,n){"ngInject";this.$scope=e,this.$bikes=[],this.$list=[],this.$c8yBase=t,this.$c8yDevices=n,this.$initialized=!1,e.refresh=this.refresh.bind(this),e.loadNext=this.loadNext.bind(this),e.paging={},e.pageSize=Math.max(t.PAGESIZE,2e3)}e.$inject=["$scope","c8yBase","c8yDevices"],angular.module("econnect").component("eBikes",{templateUrl:"core_eConnectBike/components/bikes/bikes.html",bindings:{filter:"<"},controller:e}),e.prototype.assignFilter=function(){this.filter=this.filter||{}},e.prototype.$onInit=function(){var e=this;this.assignFilter(),this.refresh().then(function(){e.$initialized=!0})},e.prototype.$onChanges=function(){this.assignFilter(),this.refresh()},e.prototype.register=function(e){this.$bikes.push(e)},e.prototype.loadNext=function(){var e=this;e.$scope.paging.next().then(function(t){_(t).forEach(function(t){e.$bikes.push(t)}),e.$scope.paging=t.paging})},e.prototype.refresh=function(){var e=this;return e.$scope.paging.loading=!0,e.$c8yDevices.list(e.$c8yBase.pageSizeFilter(_.assign(e.filter||{},{pageSize:e.$scope.pageSize}))).then(function(t){e.$list=t,e.$scope.paging=t.paging})},e.prototype.closeAll=function(){this.$bikes.forEach(function(e){e.close()})}}(),function(){"use strict";function e(e,t,n,i,o){function a(){var e=_(r.$sources).sortBy("name").head();r.filter.source=r.filter.source||e&&e.id}var r=this;r.filter=r.filter||{},r.$initialized=!1,e.paging={},this.$onInit=function(){return r.loadSources().then(a).then(r.loadSource).then(r.refresh).then(function(){r.$initialized=!0})},this.updateSource=function(){_.assign(this.filter,{source:r.$sourceId?r.$sourceId:void 0}),this.refresh()},this.setDate=function(e){_.assign(this.filter,{dateFrom:moment(e).startOf("day").format(n.dateFullFormat),dateTo:moment(e).endOf("day").format(n.dateFullFormat)}),this.refresh()},this.loadSource=function(){return r.filter.source&&(r.$sourceId=r.filter.source),t.resolve({})},this.loadSources=function(){return o.list({pageSize:2e3}).then(function(e){r.$sources=e})},this.filterRoutesBySearchText=function(e){e=e||{};var t=e.c8y_Route||{},n=_.lowerCase(t.name||""),i=e.source||{},o=_.lowerCase(i.name||""),a=_.lowerCase(r.search||""),c=_.includes(n,a),s=_.includes(o,a);return c||s},this.clear=function(){r.filter={},r.date=void 0,r.search=void 0,a(),r.$sourceId=r.filter.source,r.refresh()},this.refresh=function(){return e.paging.loading=!0,i.list(_.assign({pageSize:e.pageSize||10,dateFrom:moment().subtract(3,"months").startOf("day").format(n.dateFullFormat),dateTo:moment().endOf("day").format(n.dateFullFormat)},r.filter||{},{type:"c8y_Route"})).then(function(t){r.$routes=t,e.paging=t.paging,e.paging.more=t.length>=t.paging.statistics.pageSize})},e.refresh=this.refresh,e.loadNext=function(){e.paging.loading=!0,e.paging.next().then(function(t){_.forEach(t,function(e){r.$routes.push(e)}),e.paging=t.paging,e.paging.more=t.length>=t.paging.statistics.pageSize})}}e.$inject=["$scope","$q","c8yBase","c8yEvents","c8yDevices"],angular.module("econnect").component("eRoutes",{templateUrl:"core_eConnectBike/components/routes/routes.html",bindings:{filter:"<"},controller:e})}(),function(){"use strict";function e(e,t,n,i,o,a,r,c){"ngInject";function s(){if(Event.prototype.initEvent){var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}else window.dispatchEvent(new Event("resize"))}var l=this;l.$collapsed=!0,l.$initialized=!1,l.$durationFormat="{{time}}";var u="core_eConnectBike/img/obugt_device_v1.png";l.$onInit=function(){l.$image=u},l.expand=function(){l.initialize().then(function(){l.$collapsed=!1,s()})},l.initialize=function(){return l.$initialized?t.resolve():t.all([l.loadBike().then(l.loadBikeOwner).then(l.loadBikeImage),l.map&&l.map.initialize()||t.resolve()]).finally(function(){l.$initialized=!0})},l.close=function(){l.$collapsed=!0},l.save=function(e){l.route.c8y_Route.name=e,a.update(l.route).then(n.getResData).then(function(e){l.route=e})},l.loadBikeImage=function(){return l.$bike&&l.$bike.c8y_Image?i.downloadAsDataUri(l.$bike.c8y_Image).then(function(e){l.$image=e}):t.resolve()},l.loadBike=function(){return o.detail(l.route.source).then(function(e){return l.$bike=e.data,l.$bike})},l.loadBikeOwner=function(){if(!l.$owner){var e=l.$bike.c8y_AssetUser||{},n=e.username;if(e.username=_.isString(n)?atob(n):n,l.$owner=e.id,l.$owner)return r.detail(l.$owner).then(function(e){e&&e.data&&(e.data.firstName||e.data.lastName)&&(l.$owner=e.data.firstName+" "+e.data.lastName)})}return t.resolve()}}e.$inject=["$scope","$q","c8yBase","c8yBinary","c8yInventory","c8yEvents","c8yUser","gettext"],angular.module("econnect").component("eRoute",{templateUrl:"core_eConnectBike/components/route/route.html",bindings:{route:"="},controller:e})}(),function(){"use strict";function e(e,t,n){"ngInject";var i=this;i.$onInit=function(){i.$initialized=!1,i.mapDefaults={scrollWheelZoom:!1},i.parent.map=i},i.initialize=function(){return i.$initialized?$q.resolve():i.loadRoute().then(function(e){i.center={},i.paths={route:{opacity:.8,weight:4,latlngs:_.map(e,function(e){return L.latLng(e.lat,e.lng)})}},i.bounds=_(e).reduce(function(e,t){return e.add(t)},new n.Bounds).get()}).finally(function(){i.$initialized=!0})},i.loadRoute=function(){return t.list({fragmentType:"c8y_Position",source:i.route.source.id,dateFrom:moment(i.route.c8y_Route.startDate).format(e.dateFullFormat),dateTo:moment(i.route.c8y_Route.endDate).format(e.dateFullFormat),pageSize:1e4}).then(_.clone).then(function(e){return _(e).map("c8y_Position").value()})}}e.$inject=["c8yBase","c8yEvents","c8yGeo"],angular.module("econnect").component("eRouteMap",{template:'<leaflet ng-if="$ctrl.$initialized" width="100%" height="100%"paths="$ctrl.paths"markers="$ctrl.markers"center="$ctrl.center"bounds="$ctrl.bounds"defaults="$ctrl.mapDefaults"></leaflet>',bindings:{route:"<"},require:{parent:"^eRoute"},controller:e})}(),function(){"use strict";function e(e){function t(){e.isDownloadAvailable.then(function(e){n.isDownloadAvailable=!!e})}var n=this;_.assign(n,{$onInit:t,download:function(){e.downloadAs(n.route.id)}})}e.$inject=["downloadGpxService"],angular.module("econnect").component("downloadGpx",{templateUrl:"core_eConnectBike/components/downloadGPX/downloadGPX.html",bindings:{route:"<"},controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e,t,n,i,o,a,r){function c(e){return s(e).then(function(e){var n=e.getResponseHeader("Content-Type"),i=e.getResponseHeader("Content-Disposition"),o=new Blob([e.response],{type:n});t.saveAs(o,l(i))}).then(function(){i.add({text:r("The operation has been completed successfully!"),type:"success"})}).catch(function(e){var t=String.fromCharCode.apply(null,new g(e.response)),n={};try{n=JSON.parse(t)}catch(e){n.message=r("Failed to connect to service")}i.add({text:o.getTranslatedServerMessage(n.message),type:"danger",detailedData:n})})}function s(e){var t=u(e);return d(t)}function l(e){return/filename="(.*)"/.exec(e)[1]}function u(e){var t="/service/export-route/gpx/",n=[t,e].join("");return n}function d(t){var i=e.defer(),o=new XMLHttpRequest;return o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){200===o.status?i.resolve(o):i.reject(o)},_.forEach(n.headers(),function(e,t){e&&o.setRequestHeader(t,e)}),o.send(),i.promise}function p(){var e={category:"export-route",key:"microservice.url"};return a.detailValue(e)}var v={},g=window.Uint8Array;return _.assign(v,{downloadAs:c,isDownloadAvailable:p()}),v}e.$inject=["$q","$window","c8yAuth","c8yAlert","c8yLocales","c8ySettings","gettext"],angular.module("econnect").factory("downloadGpxService",e)}(),function(){"use strict";function e(e,t,n,i){function o(){return n.list(t.pageSizeFilter({pageSize:2e3})).then(function(t){return e.all(_.map(t,function(e){return a(e).then(function(t){return e.c8y_Position=t.c8y_Position,e})})).then(_.curry(_.filter)(_,"c8y_Position"))})}function a(e){return i.list({fragmentType:"c8y_Position",source:e.id,pageSize:1,dateFrom:"1970-01-01"}).then(function(e){return e[0]||{}})}var r={getPositionedDevicesByEvents:o};return r}e.$inject=["$q","c8yBase","c8yDevices","c8yEvents"],angular.module("econnect").factory("ecbPositionSelector",e)}(),function(){"use strict";angular.module("econnect").constant("routesVisibilities",{PUBLIC:"public",PRIVATE:"private"})}(),function(){"use strict";function e(e,t,n,i,o){function a(e){if(e){var n=e.baseUrl,i=t(e.parameters);return n+"?"+i}}function r(t,n){var o=i.url("service/export-route/authorization"),a={},r=_.find(d,{name:t});return a[t]={authorization_code:n,redirect_uri:r.parameters.redirect_uri},e.post(o,a)}function c(e){return s(e).then(function(t){var n=_.find(d,{name:e});return n.parameters.client_id=t,n})}function s(e){var t=$.when();return l(e)&&(t=o.detailValue({category:"external.gps",key:e+".clientId"})),t}function l(e){return Boolean(_.find(d,{name:e}))}var u=n.absUrl().split("#")[0]+"#/",d=[{name:"komoot",baseUrl:"https://auth.komoot.de/oauth/authorize",parameters:{response_type:"code",redirect_uri:u+"komoot/"}},{name:"strava",baseUrl:"https://www.strava.com/oauth/authorize",parameters:{response_type:"code",redirect_uri:u+"strava/",approval_prompt:"force",scope:"write"}}],p={buildExternalServiceUrl:a,postAuthorizationCode:r,getExternalService:c};return p}e.$inject=["$http","$httpParamSerializer","$location","c8yBase","c8ySettings"],angular.module("econnect").factory("exportRoutesService",e)}(),function(){"use strict";function e(){function e(){var e={createUiRouteController:t};return e}function t(e){function t(t,n,i,o,a){function r(){return c(),i.postAuthorizationCode(e,n.code).then(function(){t.url("/"),o.success(a.getString("You are successfully connected to {{name}}.",{name:_.capitalize(e)}))})}function c(){var e=t.absUrl();if(e.match(/\?.*#/)){var n=window.location.search,i=e.replace(n,"")+n;window.location.href=i}}r()}return t.$inject=["$location","$routeParams","exportRoutesService","c8yAlert","gettextCatalog"],t}var n=this;_.assign(n,{createUiRouteController:t,$get:e})}angular.module("econnect").provider("exportRoutesRedirect",e)}(),function(){"use strict";function e(e,t,n,i,o,a,r,c){function s(){var e=g.externalServiceName;return t.all({serviceConfig:c.getExternalService(e),user:o.current(!0)}).then(function(t){p=t.serviceConfig,v=t.user,g.connected=!(!v.customProperties||!v.customProperties[e]),g.routesVisibility=g.connected&&v.customProperties[e].visibility===r.PUBLIC})}function l(){m!==g.routesVisibility&&(m=g.routesVisibility,g.onRoutesVisibilityUpdated({args:{externalServiceName:g.externalServiceName,visibility:g.routesVisibility?r.PUBLIC:r.PRIVATE}}))}function u(){e.location.href=c.buildExternalServiceUrl(p)}function d(){return a({title:n("Confirm disconnect?"),body:i.getString("Do you really want to disconnect from {{externalServiceName | capitalizeString}} service?",g),status:"warning"}).then(function(){g.onRoutesExportingDisconnected(),g.connected=!1})}var p,v,g=this,m=!1;_.assign(g,{$onInit:s,$doCheck:l,routesVisibility:m,connected:!1,connect:u,disconnect:d})}e.$inject=["$window","$q","gettext","gettextCatalog","c8yUser","c8yModal","routesVisibilities","exportRoutesService"],angular.module("econnect").component("exportRoutesConnect",{templateUrl:"core_eConnectBike/components/export/export-connect.html",bindings:{externalServiceName:"@",onRoutesVisibilityUpdated:"&",onRoutesExportingDisconnected:"&"},controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e){var t;t='<div class="bike-basic" ng-click="$ctrl.toggle()">\n  <div class="bike-name">\n    <h4 class="text-truncate">\n      {{$ctrl.bike.name}}\n    </h4>\n  </div>\n\n  <div class="text-right">\n    <e-status class="connection-status text-right" ng-class="$ctrl.$availability().class" status="$ctrl.$availability().status" icon="$ctrl.$availability().icon"></e-status>\n    <e-status class="lock-status text-right" ng-class="$ctrl.$lock().class" status="$ctrl.$lock().status" icon="$ctrl.$lock().icon"></e-status>\n  </div>\n</div>\n<div uib-collapse="$ctrl.$collapse" class="bike-details">\n  <div ng-if="!$ctrl.$collapse">\n    <div class="telemetry-device">\n      <e-entry name="{{\'Telemetry device\' | translate}}" tooltip="$ctrl.$telemetryDeviceTooltip"></e-entry>\n      <e-entry>\n        <name>{{\'Battery\' | translate }}\n          <span ng-class="$ctrl.charging().class">{{$ctrl.charging().status | translate | lowercase}}</span>\n        </name>\n        <value>\n          <c8y-battery-level value="$ctrl.$battery.level.Akkuzustand.Akkustand.value"></c8y-battery-level>\n        </value>\n      </e-entry>\n      <e-entry name="{{\'Connection status\' | translate }}">\n        <value>\n          <c8y-signal-strength value="$ctrl.$signal.level.OBUB.Signal.value" ranges="$ctrl.$signalRanges"></c8y-signal-strength>\n        </value>\n      </e-entry>\n    </div>\n    <e-entry icon="flag" name="{{\'Number of routes\' | translate}}" class="bike-total-routes">\n      <value>\n        {{$ctrl.$totalRoutes}}\n      </value>\n    </e-entry>\n    <e-entry icon="clock-o" name="{{\'Total time\' | translate }}" class="bike-total-time">\n      <value>\n        {{$bike.c8y_TotalTrip.duration.value | duration:$ctrl.durationInterpolationFormat}}\n      </value>\n    </e-entry>\n\n    <e-entry icon="road" name="{{\'Total distance\' | translate }}" class="bike-total-distance">\n      <value>\n        {{$bike.c8y_TotalTrip.distance.value | distance: $bike.c8y_TotalTrip.distance.unit}}\n      </value>\n    </e-entry>\n\n    <e-entry icon="calendar" name="{{\'Last update\' | translate }}" class="bike-last-update">\n      <value>\n        {{$bike.c8y_Availability.lastMessage | absoluteDateTimeFormat:\'LL LTS\' }}\n      </value>\n    </e-entry>\n  </div>\n</div>\n<div class="routes">\n  <a class="btn btn-link" ng-href="#/routes?source={{$bike.id}}">\n    {{\'Last routes\' | translate }}\n    <i c8y-icon="caret-right"></i>\n  </a>\n</div>\n',e.put("core_eConnectBike/components/bike/bike.html",t),e.put("/apps/core/eConnectBike/components/bike/bike.html",t),t='<div class="text-muted bikes" ng-show="$ctrl.$list.length === 0 && $ctrl.$initialized">\n  <div class="text-muted" translate>\n    No devices found.\n  </div>\n</div>\n<div ng-show="$ctrl.$list.length > 0 && $ctrl.$initialized">\n  <div ng-repeat="bike in $ctrl.$list track by bike.id" class="bike-slot">\n    <e-bike bike="bike" on-toggle="$ctrl.closeAll()"></e-bike>\n  </div>\n</div>\n<div class="panel-footer bikes-load-more" ng-show="paging.more">\n  <c8y-load-more change-page-size></c8y-load-more>\n</div>\n',e.put("core_eConnectBike/components/bikes/bikes.html",t),e.put("/apps/core/eConnectBike/components/bikes/bikes.html",t),t='<div class="load-more btn-block">\n  <button type="button" class="btn btn-link btn-block" ng-click="vm.download()" ng-if="vm.isDownloadAvailable">\n    <i c8y-icon="download"></i>\n    {{\'Download GPX\' | translate}}</button>\n</div>\n',e.put("core_eConnectBike/components/downloadGPX/downloadGPX.html",t),e.put("/apps/core/eConnectBike/components/downloadGPX/downloadGPX.html",t),t='\n<div ng-if="$ctrl.icon" ng-transclude="iconSlot" class="entry-icon">\n  <i c8y-icon="{{::$ctrl.icon}}"></i>\n</div>\n\n<div ng-transclude="nameSlot" class="entry-name">\n  <label>{{::$ctrl.name | translate}}</label>\n  <a href="" ng-if="$ctrl.tooltip" uib-popover-html="$ctrl.tooltip | translate" popover-append-to-body="true" popover-placement="right" popover-title="{{ \'Information\' | translate }}" popover-trigger="\'focus\'">\n    <i c8y-icon="info-circle"></i>\n  </a>\n</div>\n\n<div class="entry-value">\n  <ng-transclude ng-transclude-slot="valueSlot"></ng-transclude>\n</div>\n',e.put("core_eConnectBike/components/entry/entry.html",t),e.put("/apps/core/eConnectBike/components/entry/entry.html",t),t='<button type="button" class="btn btn-default btn-block" ng-click="!vm.connected ? vm.connect() : vm.disconnect()">\n  <span ng-if="!vm.connected" translate>Connect to {{vm.externalServiceName | capitalizeString}}</span>\n  <span ng-if="vm.connected" translate>Disconnect from {{vm.externalServiceName | capitalizeString}}</span>\n</button>\n<div class="text-info" ng-if="vm.connected" translate>\n  You\'re connected to {{vm.externalServiceName | capitalizeString}}.\n</div>\n<div style="margin-top:.4em">\n  <input type="checkbox" ng-model="vm.routesVisibility">\n  {{\'Public routes\' | translate}}\n</div>\n',e.put("core_eConnectBike/components/export/export-connect.html",t),e.put("/apps/core/eConnectBike/components/export/export-connect.html",t),t='\n<div class="route-details" uib-collapse="$ctrl.$collapsed">\n  <h3 class="route-name" style="margin-top:0; padding-top:10px">\n    <c8y-inplace-input value="$ctrl.route.c8y_Route.name" on-save="$ctrl.save(value)" data-required="true"></c8y-inplace-input>\n  </h3>\n  <button class="close" ng-click="$ctrl.close()"><i c8y-icon="chevron-up"></i></button>\n  <div class="row">\n    <div class="col-md-3">\n\n        <div class="route-date pull-left">\n          <i c8y-icon="calendar"></i>\n          {{$ctrl.route.time | absoluteDateWithDay}}\n        </div>\n        <div class="pull-left">\n          <div class="pull-left route-start-time">\n            <i c8y-icon="sign-out" title="Start"></i>\n            {{$ctrl.route.c8y_Route.startDate | absoluteTime}}\n          </div>\n          <div class="pull-left route-end-time">\n            <i c8y-icon="sign-in" title="Finish"></i>\n            {{$ctrl.route.c8y_Route.endDate | absoluteTime}}\n          </div>\n        </div>\n        <div class="clearfix"></div><br>\n\n      <div class="bike-picture">\n        <img class="img-responsive" ng-src="{{$ctrl.$image}}">\n      </div>\n\n      <h4 class="route-bike-name pull-left">{{$ctrl.$bike.name}}</h4>\n      <h4 class="pull-right">\n        <small class="route-bike-owner">\n          {{$ctrl.$owner}}\n        </small>\n      </h4>\n\n\n      <div class="clearfix"><br><br></div>\n\n      <e-entry icon="clock-o" name="Duration">\n        <value class="route-duration">\n          {{ $ctrl.route.c8y_Route.duration.value | duration:$ctrl.$durationFormat}}\n        </value>\n      </e-entry>\n      <e-entry icon="road" name="Distance">\n        <value class="route-distance">\n          {{ $ctrl.route.c8y_Route.distance.value | distance:$ctrl.route.c8y_Route.distance.unit }}\n        </value>\n      </e-entry>\n      <e-entry icon="dashboard" name="Avg. Speed">\n        <value class="route-speed">\n          {{$ctrl.route.c8y_Route.speed.avg.value | number:1}}\n          {{$ctrl.route.c8y_Route.speed.avg.unit}}\n        </value>\n      </e-entry>\n      <e-entry icon="tasks" name="Avg. Pace">\n        <value class="route-pace">\n          {{$ctrl.route.c8y_Route.pace.avg.value | duration:$ctrl.c8y_Route.route.pace.avg.unit }}\n        </value>\n      </e-entry>\n      <e-entry icon="bolt" name="Max Speed">\n        <value class="route-max-speed">\n          {{$ctrl.route.c8y_Route.speed.max.value | number:1}}\n          {{$ctrl.route.c8y_Route.speed.max.unit}}\n        </value>\n      </e-entry>\n      <download-gpx route="$ctrl.route"></download-gpx>\n    </div>\n    <div class="col-md-9 map">\n      <div style="margin-top:0;margin-bottom:15px;height:575px">\n        <e-route-map route="$ctrl.route"></e-route-map>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n<div class="row-flex route-basic" ng-click="$ctrl.expand()">\n\n<a href="" class="thief" ng-click="$event.stopPropagation();" ng-show="$ctrl.route.c8y_Route.c8y_BikeLocked" uib-popover-html="\'The bicycle was locked during this route\' | translate" popover-append-to-body="true" popover-placement="right" popover-trigger="\'focus\'">\n  <i c8y-icon="exclamation-circle"></i>\n</a>\n\n  <div class="route-name">\n    <span class="h4">{{$ctrl.route.c8y_Route.name}}&nbsp;<small>\n      <i c8y-icon="bicycle"></i>&nbsp;&nbsp;{{$ctrl.route.source.name}}</small></span>\n  </div>\n  <div class="route-date">\n    <i c8y-icon="calendar" title="Date"></i>&nbsp;{{$ctrl.route.time | absoluteDateWithDay}}\n  </div>\n  <div class="route-start-time">\n    <i c8y-icon="sign-out" title="Start"></i>&nbsp;{{$ctrl.route.c8y_Route.startDate | absoluteTime}}\n    </div>\n  <div class="route-end-time">\n    <i c8y-icon="sign-in" title="Finish"></i>&nbsp;{{$ctrl.route.c8y_Route.endDate | absoluteTime}}\n  </div>\n  <div class="route-duration">\n    <i c8y-icon="clock-o" title="Duration"></i>&nbsp;{{ $ctrl.route.c8y_Route.duration.value | duration : $ctrl.$durationFormat }}\n  </div>\n  <div class="route-distance">\n    <i c8y-icon="road" title="Distance"></i>&nbsp;{{ $ctrl.route.c8y_Route.distance.value | distance : $ctrl.route.c8y_Route.distance.unit }}\n  </div>\n  <div class="route-speed">\n    <i c8y-icon="dashboard" title="Average Speed"></i>&nbsp;{{$ctrl.route.c8y_Route.speed.avg.value | number:1}}\n    {{$ctrl.route.c8y_Route.speed.avg.unit}}\n  </div>\n  <div class="route-expand">\n    <i c8y-icon="chevron-down"></i>\n  </div>\n</div>\n',e.put("core_eConnectBike/components/route/route.html",t),e.put("/apps/core/eConnectBike/components/route/route.html",t),t='<div class="routes" ng-show="$ctrl.$initialized">\n  <nav class="navbar navbar-default">\n      <div class="navbar-header">\n        <button type="button" class="navbar-toggle" ng-class="{\'collapsed\': !isRoutesFilterbarExpanded}" ng-click="isRoutesFilterbarExpanded = !isRoutesFilterbarExpanded" aria-expanded="false">\n          <span class="sr-only" translate>Toggle navigation</span>\n          <!-- <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span> -->\n          <i c8y-icon="chevron-up" style="font-size:20px"></i>\n        </button>\n        <span class="navbar-brand">\n          <i c8y-icon="bicycle" style="vertical-align:middle"></i>&nbsp;\n          <label translate>\n            Filter routes\n          </label>\n        </span>\n      </div>\n      <div class="collapse navbar-collapse" uib-collapse="!isRoutesFilterbarExpanded">\n        <form class="navbar-form navbar-right">\n          <div class="form-group search">\n            <label for="route-name">{{\'Search\' | translate}}</label>\n            <input id="route-name" type="text" class="form-control route-name-filter" ng-model="$ctrl.search" ng-model-options="{debounce:300}"/>\n          </div>\n          <div class="form-group" ng-show="$ctrl.$sources.length > 1">\n            <label for="route-bike">{{\'Bike\' | translate}}</label>\n            <div class="c8y-select-wrapper">\n              <select id="route-bike" class="form-control" ng-model="$ctrl.$sourceId" ng-change="$ctrl.updateSource()" ng-options="device.id as device.name for device in $ctrl.$sources | orderBy:\'name\'">\n              </select>\n              <span></span>\n            </div>\n          </div>\n          <div class="form-group datepicker">\n            <label for="route-date">{{\'Date\' | translate}}</label>\n            <input id="route-date" class="form-control" placeholder="{{\'Date\'|translate}}" ng-model="$ctrl.date" ng-change="$ctrl.setDate($ctrl.date)" uib-datepicker-popup datepicker-append-to-body="true" show-button-bar="false" show-weeks="false" is-open="openFrom" ng-click="openFrom=true">\n          </div>\n          <a class="btn btn-link" ng-click="$ctrl.clear()">\n            <i c8y-icon="undo"></i>\n            {{\'Reset\' | translate}}\n          </a>\n        </form>\n\n      </div>\n  </nav>\n\n\n\n  <div ng-show="$ctrl.$routes.length === 0" class="empty-state">\n      <h3><i c8y-icon="info-circle"></i> {{\'No routes found.\' | translate}}</h3>\n  </div>\n\n  <div ng-show="$ctrl.$routes.length > 0" class="routes-body">\n    <div ng-repeat="route in $ctrl.$routes | filter:$ctrl.filterRoutesBySearchText track by route.id">\n      <e-route route="route"></e-route>\n    </div>\n  </div>\n  <div class="load-more" ng-show="paging.more">\n    <c8y-load-more change-page-size></c8y-load-more>\n  </div>\n</div>\n',e.put("core_eConnectBike/components/routes/routes.html",t),e.put("/apps/core/eConnectBike/components/routes/routes.html",t)}angular.module("econnect").run(["$templateCache",e])}();