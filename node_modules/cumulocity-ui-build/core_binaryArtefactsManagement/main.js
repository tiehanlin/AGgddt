/* core_binaryArtefactsManagement 8.7.2 2017-08-02T09:53:48+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.binaryArtefactsManagement",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(n,t,e){"use strict";var a=e("Management"),l=e("Files repository"),i="download",r="files",s=1e3,o="core_binaryArtefactsManagement/views/list.html";n.addNavigation({parent:a,name:l,priority:s,path:r,icon:i}),t.when("/"+r,{name:l,templateUrl:o})}]),angular.module("c8y.binaryArtefactsManagement").controller("binaryArtefactsListCtrl",["$scope","$q","$upload","$window","c8yInventory","c8yModal","c8yBase","c8yTitle","c8yBinary","gettext","gettextCatalog",function(n,t,e,a,l,i,r,s,o,d,c){"use strict";function f(){u().then(p).then(g)}function u(n){return o.list(n)}function p(t){n.files&&!n.refreshLoading||(n.files=[]),n.paging=t.paging,t.forEach(function(t){t.icon=o.icon(t),n.files.push(t)})}function g(){s.changeTitle({title:d("Files repository")})}function h(){n.paging.loading=!0,n.paging.next().then(p).finally(function(){n.paging.loading=!1})}function y(){n.refreshLoading=!0,n.paging.refresh().then(p).finally(function(){n.refreshLoading=!1})}function b(n){return A.indexOf(n)}function m(n){return b(n)>-1}function w(n){m(n)?A.splice(b(n),1):(A.push(n),v(n))}function v(n){o.isImage(n)&&!n.dataUri&&o.downloadAsDataUri(n).then(function(t){n.dataUri=t})}function x(t){i({title:d("Confirm delete?"),body:c.getString('Do you really want to remove file " {{name}} "?',{name:t.name}),status:"danger"}).then(angular.bind(o,o.removeBinary,t)).then(angular.bind(r,r.removeFromList,n.files,t))}function U(n){i({templateUrl:"core_binaryArtefactsManagement/views/upload.html",controller:"binaryArtefactsUploadCtrl",title:d("Upload files"),backdrop:"static"}).then(y)}var A=[];n.loadNext=h,n.refresh=y,n.toggle=w,n.isOpen=m,n.onClickDelete=x,n.upload=U,n.size=o.size,n.isImage=o.isImage,f()}]),angular.module("c8y.binaryArtefactsManagement").controller("binaryArtefactsUploadCtrl",["$scope","$uibModalInstance","$q","c8yAlert","c8yBinary","gettext",function(n,t,e,a,l,i){"use strict";function r(){return!n.uploading&&_.every(n.files,function(n){return l.hasValidSize(n.file)})}function s(){var s=e.defer();if(r()){n.uploading=!0;var o=[];_.forEach(n.files,function(n){var t=l.upload(n.file);o.push(t),t.progress(function(n){t.uploadProgress=n.loaded/n.total,s.notify(_(o).map("uploadProgress").reduce(function(n,t){return n+t})/o.length)})}),e.all(o).then(function(n){s.resolve(n)})}else s.reject();return n.uploadProgress=0,s.promise.then(function(){a.success(i("Files successfully uploaded!")),t.close()},function(){a.danger(i("Could not upload the files!"))},function(t){n.uploadProgress=100*t}).finally(function(){n.uploading=!1,n.uploadProgress=100})}n.uploading=!1,n.uploadProgress=0,n.allowMultipleFiles=!0,n.filesRequired=!0,n.files=[],n.canUpload=r,n.upload=s,n.dismiss=t.dismiss}]),function(){"use strict";function n(n){var t;t='<div ng-controller="binaryArtefactsListCtrl">\n\n  <div class="clearfix">\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n    <c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\', \'ROLE_INVENTORY_CREATE\']">\n      <button class="btn btn-link pull-right" ng-click="upload()">\n        <i c8y-icon="plus"></i><translate>Upload file</translate>\n      </button>\n    </c8y-if-allowed>\n  </div>\n\n  <div class="alert alert-warning" ng-show="files.length == 0" style="clear:both" translate>\n    No files found.\n  </div>\n\n  <table class="table table-hover" ng-show="files.length > 0">\n    <thead>\n      <th translate>Filename</th>\n      <th translate>Size</th>\n      <th translate>Owner</th>\n      <th translate>Last updated</th>\n      <th>&nbsp;</th>\n    </thead>\n    <tbody>\n      <tr ng-repeat-start="file in files | orderBy:\'name\'" class="interact" ng-class="{active: isOpen(file)}">\n        <td ng-click="toggle(file)" class="word-break" style="max-width:250px"><i c8y-icon="{{file.icon}}"></i> {{file.name}}</td>\n        <td ng-click="toggle(file)">{{size(file)|bytes}}</td>\n        <td ng-click="toggle(file)">{{file.owner}}</td>\n        <td ng-click="toggle(file)">{{file.lastUpdated|date:\'medium\'}}</td>\n        <td class="text-right">\n          <c8y-download-button binary="file" downloading="file.downloading" class="btn btn-primary btn-xs" ng-class="{showOnHover: !file.downloading}">\n          </c8y-download-button>\n          <span style="display: inline-block" tooltip-enable="file.c8y_applications_storage" uib-tooltip="{{\'Cannot delete application archives from files repository\' | translate}}" class="showOnHover">\n            <button ng-show="!file.downloading" ng-disabled="file.c8y_applications_storage" class="btn btn-danger btn-xs" title="{{\'Delete file\' | translate}}" ng-click="onClickDelete(file)">\n              <i c8y-icon="times"></i>\n            </button>\n          </span>\n        </td>\n      </tr>\n      <tr ng-repeat-end ng-if="isOpen(file)">\n        <td colspan="5">\n            <h5><i c8y-icon="bars"></i> <translate>Details</translate></h5>\n          <table class="table table-condensed table-borderless">\n            <tr>\n              <th style="width: 175px" translate>Filename</th>\n              <td>{{file.name}}</td>\n            </tr>\n            <tr>\n              <th style="width: 175px" translate>Type</th>\n              <td> {{file.type}}</td>\n            </tr>\n            <tr>\n              <th style="width: 175px" translate>Size</th>\n              <td> {{size(file)|bytes}}</td>\n            </tr>\n            <tr>\n              <th style="width: 175px" translate>Owner</th>\n              <td> {{file.owner}}</td>\n            </tr>\n            <tr>\n              <th style="width: 175px" translate>Last updated</th>\n              <td>{{file.lastUpdated|date:\'medium\'}}</td>\n            </tr>\n            <tr ng-show="isImage(file) && file.dataUri">\n              <th style="width: 175px" translate>Preview</th>\n              <td><img ng-src="{{file.dataUri}}" style="max-width: 300px"/></td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n\n  <c8y-load-more></c8y-load-more>\n</div>\n',n.put("core_binaryArtefactsManagement/views/list.html",t),n.put("/apps/core/binaryArtefactsManagement/views/list.html",t),t='<div class="modal-header" ng-show="title">\r\n  <h3>{{title | translate}}</h3>\r\n</div>\r\n<div class="modal-body">\r\n  <form role="form" name="filesUploadForm" class="panel-body" novalidate>\r\n    <div class="form-group">\r\n      <label translate>Files to upload</label>\r\n      <file-picker files="files" multiple="true" required="filesRequired" disabled="uploading"></file-picker>\r\n    </div>\r\n  </form>\r\n</div>\r\n<div class="modal-footer">\r\n  <button class="btn btn-primary" ng-click="upload()" ng-disabled="filesUploadForm.$invalid || !canUpload()">\r\n      <span ng-show="uploading"><i c8y-icon="spinner" class="fa-spin"></i> <translate>Uploading&hellip;</translate>({{uploadProgress|number:0}}%)</span>\r\n    <span ng-show="!uploading" translate>Upload</span>\r\n  </button>\r\n  <button class="btn btn-default" ng-click="dismiss()" ng-disabled="uploading" translate>Cancel</button>\r\n</div>\r\n',n.put("core_binaryArtefactsManagement/views/upload.html",t),n.put("/apps/core/binaryArtefactsManagement/views/upload.html",t)}angular.module("c8y.binaryArtefactsManagement").run(["$templateCache",n])}();