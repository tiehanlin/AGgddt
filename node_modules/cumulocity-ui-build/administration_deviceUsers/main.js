/* administration_deviceUsers 8.7.2 2017-08-02T09:53:14+00:00 79d3e7d78638 (hotfix/8.7.2) tip */
angular.module("c8y.parts.deviceUsers",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(e,n,s){"use strict";e.addNavigation({parent:s("Management"),name:s("Device credentials"),path:"deviceusers",icon:"key",showIfPermissions:{anyRole:["ROLE_USER_MANAGEMENT_ADMIN","ROLE_USER_MANAGEMENT_READ"]}}),n.when("/deviceusers",{templateUrl:"administration_deviceUsers/views/list.html"}),n.when("/deviceusers/:userId",{templateUrl:"administration_deviceUsers/views/detail.html"})}]),function(){"use strict";function e(e,n,s,t,r,a,i,o,l){function c(n){e.users&&!e.refreshLoading||(e.users=[]),n.forEach(function(n){e.users.push(n)}),e.paging=n.paging,y(e.users.length)}function u(){t.list({onlyDevices:!0}).then(c)}function d(e){return e.enabled?"check-circle":"minus-circle"}function g(e){return e.enabled?"text-success":"text-danger"}function p(e){e.enabled=!0,t.save(e).then(function(){s.success(o("User successfully activated."))})}function m(e){e.enabled=!1,t.save(e).then(function(){s.success(o("User successfully deactivated."))})}function f(e){return e.enabled?"Enabled":"Disabled"}function v(n){r({title:o("Confirm delete?"),body:l.getString('Do you really want to remove user "{{userName}}"?',{userName:n.userName}),status:"danger"}).then(angular.bind(t,t.remove,n)).then(angular.bind(a,a.removeFromList,e.users,n)).then(function(){s.success(o("User successfully removed."))})}function h(e){n.path("/deviceusers/"+e.id)}function b(){e.refreshLoading=!0,e.paging.refresh().then(c).finally(function(){e.refreshLoading=!1})}function w(){e.paging.loading=!0,e.paging.next().then(c).finally(function(){e.paging.loading=!1})}function y(e){i.changeTitle({title:o("Device users"),subtitle:_.isUndefined(e)?"":e+" "+l.getString("users")})}e.enabledIcon=d,e.enabledClass=g,e.enabledTooltip=f,e.activate=p,e.deactivate=m,e.groups=t.groups,e.navigateToDetail=h,e.onClickDelete=v,e.refresh=b,e.loadNext=w,u(),y()}e.$inject=["$scope","$location","c8yAlert","c8yUser","c8yModal","c8yBase","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.deviceUsers").controller("deviceUserListCtrl",e)}(),angular.module("c8y.parts.deviceUsers").controller("deviceUserDetailCtrl",["$scope","$routeParams","$location","$window","c8yUser","c8yUserGroup","c8yBase","c8yAlert","c8yTitle","gettext","gettextCatalog",function(e,n,s,t,r,a,i,o,l,c,u){"use strict";function d(n){g(n),e.user=n,e._groups={},(n.groups&&n.groups.references||[]).forEach(function(n){var s=n.group.id;e._groups[s]=!0}),e.showPassword=!n.id,e.changePasswordBtn=!e.showPassword,delete e.confirmPassword}function g(n){r.checkIfCurrent(n).then(function(n){e.isCurrent=n})}function p(n){e.groups=n}function m(e){a.list(e).then(p)}function f(){y?r.detail(y).then(function(e){return e.data}).then(d):(e.isNew=!0,d({enabled:!0}))}function v(n){if(e.userForm.$valid){var s=_.keys(e._groups).filter(function(n){return e._groups[n]}).map(function(e){return parseInt(e,10)});try{r.save(n,e.password.currentPassword).then(function(e){var n=e.data;return y=n.id=n.userName,n}).then(function(e){return a.updateGroups(e,s)}).then(angular.bind({},f)).then(_.partial(o.success,c("Device successfully updated."))).then(function(){t.history.back()})}catch(e){o.danger(e.message)}}}function h(n){e.userForm.confirmPassword.$setValidity(P.PASSWORD_MISSMATCH.type,n===e.user.password)}function b(e){e&&l.changeTitle({title:c(e)})}function w(n){var s=e.userForm[n]||{},t=[];return _.forEach(s.$error||{},function(e,n){e&&!s.$pristine&&t.push(u.getString(P[n.toUpperCase()].text))}),t.join(" ")}var y=n.userId,P={PATTERN:{type:"pattern",text:c("Password must have at least 6 characters.")},PASSWORD_MISSMATCH:{type:"password_missmatch",text:c("Password confirmation does not match.")},REQUIRED:{type:"required",text:c("This field is required.")},EMAIL:{type:"email",text:c("Invalid email address.")}};e.save=v,e.confirmPassword="",e.password={},e.invalid=angular.bind(i,i.invalid,e,"userForm"),e.changePasswordConfirm=h,e.$watch("user.userName",b),e.getErrorFeedback=w,f(),m()}]),function(){"use strict";function e(e){var n;n='<div data-ng-controller="deviceUserDetailCtrl">\n  <form name="userForm" role="form" ng-submit="save(user)" novalidate>\n    <div class="row">\n      <div class="col-lg-6">\n\n      <div class="form-group" ng-class="{\'has-error\': invalid(\'username\')}">\n        <label>{{\'Username\' | translate}} *</label>\n        <input class="form-control" name="username" ng-model="user.userName" required ng-disabled="user.id" uib-tooltip="{{getErrorFeedback(\'username\')}}" c8y-autocomplete="off">\n      </div>\n\n      <div class="form-group">\n        <label translate>Active</label>\n        <div>\n          <button type="button" class="btn btn-default" on ng-model="user.enabled" uib-btn-checkbox="user.enabled">\n            <i c8y-icon="minus-circle" class="text-danger" ng-show="!user.enabled"></i>\n            <i c8y-icon="check-circle" class="text-success" ng-show="user.enabled"></i>\n            <span ng-show="user.enabled" translate>Enabled</span>\n            <span ng-show="!user.enabled" translate>Disabled</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="form-group" ng-show="changePasswordBtn">\n        <button type="button" class="btn btn-default" ng-click="showPassword=!showPassword">\n          <span ng-show="!showPassword" translate>Change password</span>\n          <span ng-show="showPassword" translate>Cancel password change</span>\n        </button>\n      </div>\n\n      <div class="form-group" ng-if="showPassword && isCurrent">\n        <label>{{\'Current password\' | translate}} *</label>\n        <input type="password" name="currentPassword" class="form-control" ng-model="password.currentPassword" required ng-pattern="passwordRegex" c8y-autocomplete="off">\n      </div>\n\n      <div class="form-group" ng-if="showPassword" ng-class="{\'has-error\': invalid(\'password\')}">\n        <label>{{\'Password\' | translate}} *</label>\n        <input type="password" name="password" class="form-control" ng-model="user.password" required ng-pattern="/.{6,}/" uib-tooltip="{{getErrorFeedback(\'password\')}}" c8y-autocomplete="off">\n      </div>\n\n      <div class="form-group" ng-if="showPassword" ng-class="{\'has-error\': invalid(\'confirmPassword\')}">\n        <label>{{\'Confirm password\' | translate}} *</label>\n        <input type="password" name="confirmPassword" class="form-control" ng-model="$parent.confirmPassword" required uib-tooltip="{{getErrorFeedback(\'confirmPassword\')}}" ng-change="changePasswordConfirm($parent.confirmPassword)" c8y-autocomplete="off">\n      </div>\n    </div>\n\n    <div class="col-lg-6">\n      <div class="panel panel-clean">\n        <div class="panel-heading">\n          <i c8y-icon="users"></i>\n          <translate>User groups</translate>\n        </div>\n        <ul class="list-group">\n          <li class="list-group-item" ng-repeat="group in groups" ng-class="{\'list-group-item-success\': _groups[group.id]}">\n            <input type="checkbox" ng-model="_groups[group.id]">\n            <i c8y-icon="check-circle" class="text-success pull-right" ng-show="_groups[group.id]"></i>\n            {{group.name}}\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    </div>\n    <button class="btn btn-primary" type="submit" ng-disabled="userForm.$invalid" translate>Save</button>\n  </form>\n\n</div>\n',e.put("administration_deviceUsers/views/detail.html",n),e.put("/apps/administration/deviceUsers/views/detail.html",n),n='<div data-ng-controller="deviceUserListCtrl">\n  <div class="clearfix">\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n  </div>\n\n  <table class="table table-hover">\n    <tr ng-repeat="user in users|orderBy:\'userName\'">\n      <td style="width:30px" class="text-center">\n        <i c8y-icon="{{enabledIcon(user)}}" data-ng-class="enabledClass(user)" uib-tooltip="{{enabledTooltip(user) | translate}}"></i>\n      </td>\n\n      <td data-ng-click="navigateToDetail(user)" class="interact word-break">\n        <span>{{user.userName}}</span>\n        <small class="text-muted" style="margin-right:10px">\n          {{user.firstName}} {{user.lastName}}\n        </small>\n        <small ng-show="user.email" class="text-muted">\n          <i c8y-icon="envelope-o"></i>\n          {{user.email}}\n        </small>\n      </td>\n\n      <td>\n        <span class="label label-info" ng-repeat="ref in user.groups.references" style="margin-right:3px">{{ref.group.name}}</span>\n      </td>\n\n      <td class="text-right word-nobreak">\n        <button class="btn btn-primary btn-xs showOnHover" ng-show="user.enabled" title="{{\'Deactivate device user\' | translate}}" data-ng-click="deactivate(user)" translate>\n          Deactivate\n        </button>\n        <button class="btn btn-primary btn-xs showOnHover" ng-hide="user.enabled" title="{{\'Activate device user\' | translate}}" data-ng-click="activate(user)" translate>\n          Activate\n        </button>\n        <button class="btn btn-danger btn-xs showOnHover" title="{{\'Delete device user\' | translate}}" data-ng-click="onClickDelete(user)">\n          <i c8y-icon="times"></i>\n        </button>\n      </td>\n    </tr>\n  </table>\n\n  <c8y-load-more change-page-size></c8y-load-more>\n\n</div>\n',e.put("administration_deviceUsers/views/list.html",n),e.put("/apps/administration/deviceUsers/views/list.html",n)}angular.module("c8y.parts.deviceUsers").run(["$templateCache",e])}();