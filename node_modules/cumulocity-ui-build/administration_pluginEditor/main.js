/* administration_pluginEditor 8.7.2 2017-08-02T09:53:14+00:00 79d3e7d78638 (hotfix/8.7.2) tip */
!function(){"use strict";function n(n,t){n.when("/applications/:applicationId",{templateUrl:"administration_pluginEditor/plugins.html",icon:"plug",name:t("Plugins"),showIf:["$routeParams","c8yApplication",function(n,t){return!(!n.applicationId||"new"===n.applicationId)&&t.detail(n.applicationId).then(function(n){return!!n.data.manifest})}]})}angular.module("c8y.pluginEditor",[]).config(["c8yViewsProvider","gettext",n])}(),function(){"use strict";function n(n){function t(){return n.applicationId}var i=this;i.getApplicationId=t}angular.module("c8y.pluginEditor").controller("c8yPluginsTabCtrl",["$routeParams",n])}(),function(){"use strict";function n(){return{restrict:"E",scope:{application:"&"},controller:"c8ySmartAppPluginEditorCtrl",controllerAs:"ctrl",templateUrl:"administration_pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html"}}angular.module("c8y.pluginEditor").directive("c8ySmartAppPluginEditor",n)}(),function(){"use strict";function n(n,t,i,a,l,e){function r(){s()}function s(){a.listPlugins().then(o)}function o(n){w=_.map(n,"manifest"),A.plugins=C=_.filter(w,function(n){return n.list!==!1}),C.sort(function(n,t){return n.name.toLowerCase()>t.name.toLowerCase()?1:-1}),c(C)}function c(n){var t=[];t.push(e("- Show all")),n.forEach(function(n){n.category&&t.indexOf(n.category)===-1&&t.push(n.category)}),A.categories=t.map(function(n){return{display:n,val:"- Show all"===n?"":n}})}function p(){u()}function u(){var t=a.detail(n.application()).then(i.getResData);t.then(function(n){return a.isPaasApp(n).then(function(n){A.isSmartApp=!n})}),t.then(function(n){return n.manifest}).then(g).then(d)}function g(n){return n.imports=_.uniq(n.imports),n}function d(n){A.manifest=n}function m(n){return _.find(w,function(t){return t.rootContextPath===n})||{}}function f(n){return n&&n.rootContextPath&&n.rootContextPath.split("/")[0]}function v(n){var t=A.manifest&&A.manifest.imports||[];return t.indexOf(n.rootContextPath)===-1}function b(n){A.manifest.imports||(A.manifest.imports=[]),_.includes(A.manifest.imports,n.rootContextPath)?l.warning(e("Plugin already subscribed!")):A.manifest.imports.push(n.rootContextPath)}function y(n){A.manifest.imports=_.without(A.manifest.imports,n)}function h(t){a.updateManifest(n.application(),g(t)).then(function(){l.success(e("Application manifest updated!"))})}function P(n){k=k!==n?n:null}function x(n){return k===n}function E(n,i,a){n.stopPropagation();var l='<img ng-src="{{src}}" style="max-width:100%">';t.open({template:l,controller:["$scope",function(n){n.src="/apps/"+i.rootContextPath+"/"+a}]})}var A=this,w=[],C=[],k=null;A.plugins=C,A.getPlugin=m,A.getPluginContextApp=f,A.subscribe=b,A.unsubscribe=y,A.notSubscribedFilter=v,A.updateManifest=h,A.openItem=P,A.isOpen=x,A.openScr=E,A.filter={},n.$watch("application()",p,!0),r()}n.$inject=["$scope","$uibModal","c8yBase","c8yApplication","c8yAlert","gettext"],angular.module("c8y.pluginEditor").controller("c8ySmartAppPluginEditorCtrl",n)}(),function(){"use strict";function n(){return{restrict:"E",scope:{application:"&"},controller:"c8yPaasPluginEditorCtrl",controllerAs:"ctrl",templateUrl:"administration_pluginEditor/paasPluginEditor/paasPluginEditor.html"}}angular.module("c8y.pluginEditor").directive("c8yPaasPluginEditor",n)}(),function(){"use strict";function n(n,t,i,a,l,e,r){function s(){return o()}function o(){return i.detail(n.application()).then(t.getResData).then(i.isPaasApp).then(function(t){if(m.isPaasApp=t,t)return i.listPluginsByPaasApp(n.application()).then(function(n){m.plugins=_.filter(n,"pluginPackage")}).then(c)})}function c(){m.categories=_(m.plugins).map(function(n){return n.pluginPackage&&n.pluginPackage.category}).filter(_.identity).uniq().map(function(n){return{value:n,label:n}}).value(),m.categories.push({value:void 0,label:e("- Show all -")})}function p(n){var t=/(?:\.([^.]+))?$/;return"zip"===t.exec(n.name)[1]}function u(n){return!f.category||n.pluginPackage&&n.pluginPackage.category===f.category}function g(){var t=m.pluginArchives[0].file;return p(t)?(v.label=e("Uploading archive"),v.progress=0,v.inProgress=!0,void i.addPaasAppPlugin(n.application(),m.pluginArchives[0].file).progress(function(n){v.progress=n.loaded/n.total*90,v.progress>=90&&(v.label=e("Updating application"))}).then(s).then(function(){l.success(e("Plugin successfully added to application!"))}).finally(function(){v.inProgress=!1,v.progress=0})):void l.danger(e("Selected file is not a ZIP archive! Please choose appropriate file."))}function d(t){return a({title:e("Are you sure?"),body:r.getString('Do you really want to remove plugin "{{pluginPackage.name || pluginName}}"?',t),status:"danger"}).then(_.partial(i.removePaasAppPlugin,n.application(),t.pluginName)).then(s).then(function(){l.success(r.getString('Plugin "{{pluginPackage.name || pluginName}}" removed from application!',t))})}var m=this,f={category:void 0},v={inProgress:!1,progress:0};m.processingStatus=v,m.filter=f,m.filterByCategory=u,m.onFileSelected=g,m.removePlugin=d,n.$watch("application()",s,!0)}n.$inject=["$scope","c8yBase","c8yApplication","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.pluginEditor").controller("c8yPaasPluginEditorCtrl",n)}(),function(){"use strict";function n(n){var t;t='<div ng-if="ctrl.isPaasApp">\n  <div class="c8y-toolbar-spacer">\n    <div class="c8y-toolbar navbar navbar-default" c8y-affix>\n\n      <div class="navbar-header">\n        <button type="button" class="navbar-toggle collapsed" ng-click="isPageToolbarExpanded = !isPageToolbarExpanded">\n          <span class="sr-only">Toggle Toolbar</span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n        </button>\n      </div>\n\n      <div id="page-toolbar" class="navbar-collapse collapse" uib-collapse="!isPageToolbarExpanded" aria-expanded="false" style="height: 0px">\n        <ul class="nav navbar-nav navbar-left">\n          <li class="navbar-form">\n            <label translate>Filter by category</label>\n            <div class="c8y-select-wrapper">\n              <select class="form-control" style="min-width: 180px" ng-model="ctrl.filter.category" ng-options="category.value as (category.label | translate) for category in ctrl.categories | orderBy:\'label | translate\'">\n              </select>\n              <span></span>\n            </div>\n          </li>\n        </ul>\n      </div>\n\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="col-sm-8">\n      <ul class="list-group">\n        <li class="list-group-item flex-row" ng-repeat="plugin in ctrl.plugins | filter:ctrl.filterByCategory | orderBy:\'pluginPackage.name | translate\'">\n          <div class="list-item-icon">\n            <i c8y-icon="plug"></i>\n          </div>\n          <div class="list-item-body">\n            <div class="row">\n              <div class="col-sm-8">\n                <strong><span ng-bind="plugin.pluginPackage.name | translate"></span></strong><br>\n                <small class="text-muted" ng-bind="plugin.pluginPackage.description | translate"></small><br>\n                <small class="label label-primary text-truncate" title="{{plugin.pluginPackage.category | translate}}" ng-bind="plugin.pluginPackage.category | translate"></small>\n              </div>\n              <div class="col-sm-4 showOnHover text-right">\n                <button class="btn btn-xs btn-danger top-m-sm" ng-click="ctrl.removePlugin(plugin)">\n                  <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                </button>\n              </div>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n\n    <div class="col-sm-4">\n      <file-picker files="ctrl.pluginArchives" multiple="false" required="true" display-drop-zone="true" drop-zone-label="\'Add plugin\' | translate" on-file-selected="ctrl.onFileSelected()" processing-status="ctrl.processingStatus">\n      </file-picker>\n    </div>\n  </div>\n\n</div>\n',n.put("administration_pluginEditor/paasPluginEditor/paasPluginEditor.html",t),n.put("/apps/administration/pluginEditor/paasPluginEditor/paasPluginEditor.html",t),t='<div ng-controller="c8yPluginsTabCtrl as ctrl">\n  <c8y-paas-plugin-editor application="ctrl.getApplicationId()"></c8y-paas-plugin-editor>\n  <c8y-smart-app-plugin-editor application="ctrl.getApplicationId()"></c8y-smart-app-plugin-editor>\n</div>\n',n.put("administration_pluginEditor/plugins.html",t),n.put("/apps/administration/pluginEditor/plugins.html",t),t='<div ng-if="ctrl.isSmartApp">\n  <div ng-if="ctrl.manifest">\n    <div class="row clearfix">\n      <button type="button" class="btn btn-primary pull-right" ng-click="ctrl.updateManifest(ctrl.manifest)" translate>Save changes</button>\n    </div>\n\n    <div class="row">\n      <div class="col-lg-6">\n        <h4 translate>Subscribed plugins</h4>\n        <ul class="list-group">\n          <li class="list-group-item interact" ng-repeat="p in ctrl.manifest.imports track by $index" ng-click="ctrl.openItem(p)">\n            <a href="" ng-click="ctrl.unsubscribe(p)" class="btn btn-danger pull-right btn-xs showOnHover" translate>Unsubscribe</a>\n            {{ctrl.getPlugin(p).name}} <span class="text-muted">{{ctrl.getPluginContextApp(ctrl.getPlugin(p))}}</span>\n            <div uib-collapse="!ctrl.isOpen(p)">\n              <p ng-show="ctrl.getPlugin(p).category">\n                <b>{{\'Category\' | translate}}:</b> {{ctrl.getPlugin(p).category}}\n              </p>\n              <p class="text-muted">{{ctrl.getPlugin(p).description}}</p>\n            </div>\n          </li>\n        </ul>\n      </div>\n\n      <div class="col-lg-6">\n        <h4 translate>Available plugins</h4>\n\n        <div class="form-inline" style="margin-bottom:10px">\n          <label class="control-label" translate>Categories</label>\n          <select ng-options="cat.val as cat.display for cat in ctrl.categories" ng-model="ctrl.filter.category" class="form-control"></select>\n          <label class="control-label"><i c8y-icon="search"></i></label>\n          <input type="search" class="form-control" ng-model="ctrl.filter.$">\n        </div>\n\n        <ul class="list-group" style="max-height:600px; overflow-y: scroll">\n          <li class="list-group-item interact" ng-repeat="p in ctrl.plugins | filter:ctrl.filter" ng-click="ctrl.openItem(p)">\n            <a href="" ng-click="ctrl.subscribe(p)" class="btn btn-primary pull-right btn-xs showOnHover" translate>Subscribe</a>\n            {{p.name}} <span class="text-muted">{{ctrl.getPluginContextApp(p)}}</span>\n            <div uib-collapse="!ctrl.isOpen(p)">\n              <p ng-show="p.category">\n                <b>{{\'Category\' | translate}}:</b> {{p.category}}\n              </p>\n              <p class="text-muted">{{p.description}}</p>\n            </div>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n',n.put("administration_pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html",t),n.put("/apps/administration/pluginEditor/smartAppPluginEditor/smartAppPluginEditor.html",t)}angular.module("c8y.pluginEditor").run(["$templateCache",n])}();