/* core_helloWorld 8.7.2 2017-08-02T09:54:30+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.parts.helloWorld",[]).config(["c8yNavigatorProvider","c8yViewsProvider","c8yTitleProvider","gettext",function(e,t,n,i){var a="/device/:deviceId";e.addNavigation({icon:"hdd-o",name:i("Devices"),priority:1,path:""}),t.when("/",{templateUrl:"core_helloWorld/views/deviceList.html"}),t.when(a,{templateUrl:"core_helloWorld/views/deviceEvents.html"}),n.addTitle(a,{data:["$routeParams","c8yDevices",function(e,t){var n=e.deviceId;return n?t.detailCached(n).then(function(e){return{title:e.data.name,subtitle:i("Events")}}):{}}]})}]),angular.module("c8y.parts.helloWorld").controller("deviceListCtrl",["$scope","$routeParams","$location","$filter","c8yDevices","c8yTitle","gettext",function(e,t,n,i,a,s,l){"use strict";function r(){var n=l("Devices"),i=null,a=[l("Showing"),e.$eval("devices.length"),l("of"),e.$eval("totalDevices")].join(" ");s.changeTitle(i||{title:t.deviceId?void 0:n,subtitle:a})}function d(t){e.devices=null,a.list(t).then(c)}function c(t){e.devices||(e.devices=[]),t.forEach(function(t){e.devices.push(t)}),e.paging=t.paging}function o(){a.getCount().then(function(t){e.totalDevices=t})}function v(t){e.paging.loading=!0;var n=t?d({pageSize:t}):e.paging.next().then(c);n.finally(function(){e.paging.loading=!1})}function u(){e.devices=null,e.refreshLoading=!0,e.paging.refresh().then(c).finally(function(){e.refreshLoading=!1}),e.paging=null}function g(e){var t=a.isVendme(e)?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware",n=e&&e[t];return n&&n.model}function h(e){var t=a.isVendme(e),n=t?"com_nsn_startups_vendme_fragments_VendingMachineTypeInfo":"c8y_Hardware",i=t?"serial":"serialNumber",s=e&&e[n];return s&&s[i]}function m(e){n.url("device/"+e.id)}function f(e){return e.name||l("-- device name not defined --")}e.model=g,e.serial=h,e.navigateToDetail=m,e.loadNext=v,e.refresh=u,e.getDeviceName=f,e.$watch("devices.length",r),e.$watch("totalDevices",r),r(),d(),o()}]),angular.module("c8y.parts.helloWorld").controller("deviceEventsCtrl",["$scope","$routeParams","c8yNotifications","c8yAlert","c8yCepModule","gettext",function(e,t,n,i,a,s){function l(){o||a.createOrDeploy(g).then(n.configure).then(angular.bind({},n.subscribe,u)).then(function(e){i.success(s("Connected! Waiting for incoming events...")),o=e,o.$on("message",r)})}function r(t,n){for(e.events.push(n);e.events.length>100;)e.events.shift()}function d(){o&&o.unsubscribe&&o.unsubscribe()}function c(e){return e.data.text||"-- no text message --"}var o,v=t.deviceId,u="/events/"+v,g={name:"c8yui_realtime_device_events",body:'insert into\n  SendNotification\nselect\n  e.event as payload,\n  "events/" || e.event.source.value as channelName\nfrom\n  EventCreated e;',status:"DEPLOYED"};e.events=[],e.$on("$destroy",d),e.getEventText=c,l()}]),function(){"use strict";function e(e){var t;t='<div ng-controller="deviceEventsCtrl">\n  <div class="alert alert-warning" ng-show="events.length === 0" translate>\n    No incoming events at the moment...}\n  </div>\n  <table class="table table-hover">\n    <tr ng-repeat="e in events|orderBy:\'id\':true">\n      <td style="width:30px" class="text-center">\n        <span class="badge">{{e.data.type}}</span>\n      </td>\n      <td>\n        {{getEventText(e)| translate }}\n        <small class="text-muted hidden-sm hidden-xs" style="margin-right:10px"><strong translate>Created:</strong> {{e.data.creationTime|date:\'medium\'}}</small>\n        <small class="text-muted hidden-sm hidden-xs"><strong translate>Data:</strong> {{e.data|json}}</small>\n      </td>\n    </tr>\n  </table>\n</div>\n',e.put("core_helloWorld/views/deviceEvents.html",t),e.put("/apps/core/helloWorld/views/deviceEvents.html",t),t='<div ng-controller="deviceListCtrl">\n  <div class="clearfix">\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n  </div>\n  <div class="alert alert-warning" ng-show="devices.length === 0" translate>\n    No devices found.\n  </div>\n  <table class="table table-hover">\n    <tr ng-repeat="dev in devices">\n      <td style="width:30px" class="text-center">\n        <c8y-device-status-display device="dev"></c8y-device-status-display>\n      </td>\n      <td class="interact" ng-click="navigateToDetail(dev)">\n        {{getDeviceName(dev)}}\n        <small ng-if="model(dev)" class="text-muted hidden-sm hidden-xs" style="margin-right:10px"><strong translate>Model:</strong> {{model(dev)}}</small>\n        <small ng-if="serial(dev)" class="text-muted hidden-sm hidden-xs"><strong translate>S/N:</strong> {{serial(dev)}}</small>\n      </td>\n    </tr>\n  </table>\n  <c8y-load-more change-page-size></c8y-load-more>\n</div>\n',e.put("core_helloWorld/views/deviceList.html",t),e.put("/apps/core/helloWorld/views/deviceList.html",t)}angular.module("c8y.parts.helloWorld").run(["$templateCache",e])}();