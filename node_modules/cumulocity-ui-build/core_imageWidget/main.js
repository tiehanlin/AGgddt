/* core_imageWidget 8.7.2 2017-08-02T09:54:33+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function e(e,n){e.add({name:"Image",description:n("Display a single image selected from the user's computer."),templateUrl:"core_imageWidget/views/component.html",configTemplateUrl:"core_imageWidget/views/componentConfig.html",options:{noDeviceTarget:!0}})}angular.module("c8y.parts.imageWidget",[]).config(["c8yComponentsProvider","gettext",e])}(),function(){"use strict";function e(e,n,i){function t(t,r){var m=t.config.imageBinaryId;return i.detail(o,m,t.id).then(function(g){var c=e.when();return null===g&&r>0&&(g={id:t.id,imageCount:1}),g?(g.imageCount+=r,c=g.imageCount<=0?a(m,g):i.save(o,m,g)):c=n.removeBinary(m),c})}function a(e,t){return i.remove("image",e,t).then(function(){n.removeBinary(e)})}var o="binaryImageConfig";return{incrementReferenceCount:_.partialRight(t,1),decrementReferenceCount:_.partialRight(t,-1)}}e.$inject=["$q","c8yBinary","uiConfig"],angular.module("c8y.parts.imageWidget").factory("imageWidgetSvc",e)}(),function(){"use strict";function e(e,n,i){function t(e){_.isUndefined(e)||n.detail(e).then(a)}function a(i){o=i.data,n.downloadAsDataUri(o).then(function(n){e.imageSrc=n})}var o={};e.$watch("child.config.imageBinaryId",t),e.$on("childRemove",function(e,n){i.decrementReferenceCount(n)})}e.$inject=["$scope","c8yBinary","imageWidgetSvc"],angular.module("c8y.parts.imageWidget").controller("imageWidgetCtrl",e)}(),function(){"use strict";function e(e,n,i,t,a,o){function r(){_.isUndefined(n.config.imageBinaryId)||(f=n.config.imageBinaryId,t.detail(n.config.imageBinaryId).then(m))}function m(e){p=e.data,n.imageName=p.name;var i=!(!p.type&&p.dataType);i&&I.push(p.id),t.downloadAsDataUri(p).then(function(e){n.imageSrc=e})}function g(e){var i,a=e.target.files[0];return a&&a.size>0&&(a.type.indexOf("image/")===-1?n.forms.componentForm.newImageValidationInput.$setValidity(v.FILE_INVALID_EXTENSION,!1):a.size/1024>y?n.forms.componentForm.newImageValidationInput.$setValidity(v.FILE_TOO_LARGE,!1):(n.forms.componentForm.newImageValidationInput.$setValidity(v.FILE_TOO_LARGE,!0),n.forms.componentForm.newImageValidationInput.$setValidity(v.FILE_INVALID_EXTENSION,!0),n.loading=!0,i=t.upload(a,w).then(c))),t.readDataUri(a).then(function(e){n.imageSrc=e}),i}function c(e){n.loading=!1,p=e.data,I.push(p.id),n.imageName=p.name,n.config.imageBinaryId=p.id}function l(e){return n.forms.componentForm[e].$invalid}function d(e){var i=[];return n.forms.componentForm[e]&&n.forms.componentForm[e].$error&&_.forEach(n.forms.componentForm[e].$error,function(e,n){e&&i.push(o.getString(h[n]))}),i.join(" ")}function s(){n.config.imageBinaryId=f}function u(){_.forEach(I,function(e){e!==n.config.imageBinaryId&&t.removeBinary(e)})}n.loading=!1;var f,p={},I=[],y=300,v={FILE_TOO_LARGE:"file-to-large",FILE_INVALID_EXTENSION:"invalid-extension"},h={};h[v.FILE_TOO_LARGE]=a("Selected file is too large!"),h[v.FILE_INVALID_EXTENSION]=a("Selected file has invalid extension!");var w={c8y_Global:{}};n.maxFileSizeKB=y,n.invalid=l,n.getValidationHints=d,n.onNewImageSelected=g,n.$on("cancelWidget",s),n.$on("$destroy",u),r()}e.$inject=["$q","$scope","c8yBase","c8yBinary","gettext","gettextCatalog"],angular.module("c8y.parts.imageWidget").controller("imageWidgetConfigCtrl",e)}(),function(){"use strict";function e(e){var n;n='<div ng-controller="imageWidgetCtrl">\n  <img ng-src="{{imageSrc}}" style="max-width: 100%"/>\n</div>\n',e.put("core_imageWidget/views/component.html",n),e.put("/apps/core/imageWidget/views/component.html",n),n='<div ng-controller="imageWidgetConfigCtrl">\n  <div class="form-group">\n    <label>{{\'Image\' | translate}} <small translate>(file size up to {{maxFileSizeKB}} KB)</small></label>\n    <input class="form-control" type="text" name="imageName" ng-model="imageName" ng-required="true" ng-readonly="true"/>\n    <div ng-class="{\'has-error\': invalid(\'newImageValidationInput\')}" uib-tooltip="{{getValidationHints(\'newImageValidationInput\')}}">\n      <input type="hidden" name="newImageValidationInput" ng-model="newImageValidationInput"/>\n      <input class="form-control" type="file" name="new-image" c8y-on-change="onNewImageSelected(event)" style="height: 3em"/>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <label>{{\'Preview\' | translate}}</label>\n    <button ng-show="loading" class="btn btn-primary btn-xs" disabled="disabled">\n      <span><i c8y-icon="spinner" class="fa-spin"></i> Loading&hellip;</span>\n    </button>\n    <div ng-show="!loading">\n      <img ng-src="{{imageSrc}}" style="max-width: 300px"/>\n    </div>\n  </div>\n</div>\n',e.put("core_imageWidget/views/componentConfig.html",n),e.put("/apps/core/imageWidget/views/componentConfig.html",n)}angular.module("c8y.parts.imageWidget").run(["$templateCache",e])}();