/* core_deviceDetailSoftware 8.7.2 2017-08-02T09:54:12+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.deviceDetailSoftware",[]).config(["c8yViewsProvider","gettext",function(e,t){"use strict";var n="core_deviceDetailSoftware/views/",a="/device/:deviceId";e.when(a,{template:'<div class="card-group"><div class="col-md-6 col-xs-12" ng-include="\''+n+'software.html\'"></div><div class="col-md-6 col-xs-12" ng-include="\''+n+"firmware.html'\"></div></div>",name:t("Software"),priority:500,icon:"floppy-o",showIf:["$routeParams","c8yDevices",function(e,t){var n=e.deviceId;return t.detailCached(n).then(function(e){var n=e.data,a=n.c8y_Software||n.c8y_SoftwareList,r=t.supportsOperation(n,"c8y_Software")||t.supportsOperation(n,"c8y_SoftwareList"),i=n.c8y_Firmware,s=t.supportsOperation(n,"c8y_Firmware");return a||r||i||s})}],controller:["$scope","$routeParams","c8yDevices",function(e,t,n){e.device={},n.detailCached(t.deviceId).then(function(t){var n=t.data;e.device=n})}]})}]),angular.module("c8y.deviceDetailSoftware").controller("deviceDetailFirmwareVPCtrl",["$scope","c8yDeviceControl","c8yInventory","c8yDevices","c8yAlert","gettext","gettextCatalog",function(e,t,n,a,r,i,s){"use strict";function o(t){e.firmwares=t.map(_.partialRight(_.pick,"name","version","url"))}function c(){return n.list({type:w}).then(o)}function l(e,n){var a=s.getString("Update firmware: {{firmwareName}} - {{firmwareVersion}}",{firmwareName:n.name,firmwareVersion:n.version}),o={deviceId:e.id,description:a,c8y_Firmware:_.cloneDeep(n)},c=_.partial(r.success,i("Operation to update firmware created"));return d(),t.create(o).then(c)}function d(){e.activeFirmwareUpload=!e.activeFirmwareUpload}function f(){return a.supportsOperation(e.device,w)}function v(){var t=e.$eval("device."+w);return t||f()}function u(){var t="";if(e.device){var n=e.device.c8y_Firmware;t=n&&n.name?n.name+" - "+n.version:i("No firmware information available")}return t}var w="c8y_Firmware";e.newFirmware={selected:null},e.toggleUpload=d,e.visible=v,e.actionable=f,e.uploadFirmware=l,e.getCurrentFirmware=u,c()}]),angular.module("c8y.deviceDetailSoftware").controller("deviceDetailSoftwareVPCtrl",["$scope","c8yDeviceControl","c8yInventory","c8yDevices","c8yAlert","c8yModal","gettext",function(e,t,n,a,r,i,s){"use strict";function o(t){e.softwares=t}function c(e){e&&e.id&&(x=e,l(w(e)))}function l(t){k=_.cloneDeep(t),e.installedSoftware=t,e.hasChanges=!1,f()}function d(){l(k)}function f(){I&&I();var t=0;I=e.$watch("installedSoftware",function(){t>=1&&(e.hasChanges=!0),t++},!0)}function v(e){return _.map(e[P]||{},function(e,t){return{name:t,version:e}})}function u(e){return e[V]}function w(e){var t;return e[P]?t=v:e[V]&&(t=u),t?t(e):[]}function m(){r.success(s("Software change operation created")),e.hasChanges=!1}function h(){n.list({type:P}).then(o)}function p(){var n={deviceId:x.id,description:s("Update device software.")};S(n),e.activeInstallSoftware=!1,t.create(n).then(m)}function g(){i({title:s("Confirm software changes?"),body:s("Do you want to create a device operation to process the software changes? Please note that this operation is asynchronous.")}).then(p)}function b(){var t={};return _.forEach(e.installedSoftware,function(e){t[e.name]=e.version}),t}function y(){return _.map(e.installedSoftware,_.partialRight(_.pick,["name","url","version"]))}function S(e){var t,n;return a.supportsOperation(x,P)&&(t=P,n=b()),a.supportsOperation(x,V)&&(t=V,n=y()),t&&(e[t]=n),e}function D(t){var n=_.find(e.installedSoftware,function(e){return e.name===t.name&&e.version===t.version});n||e.installedSoftware.push(_.cloneDeep(t)),F()}function C(t){var n=e.installedSoftware.indexOf(t);n>-1&&e.installedSoftware.splice(n,1)}function F(){e.activeInstallSoftware=!e.activeInstallSoftware}function $(){var t=e.$eval("device."+P)||e.$eval("device."+V);return t||O()}function O(){return a.supportsOperation(e.device,P)||a.supportsOperation(e.device,V)}var x,k,I,P="c8y_Software",V="c8y_SoftwareList";e.newSoftware={selected:null},e.installSoftware=D,e.removeSoftware=C,e.toggleSoftware=F,e.visible=$,e.actionable=O,e.sendOperation=g,e.resetChanges=d,e.$watch("device",c),h()}]),function(){"use strict";function e(e){var t;t='\n<div class="card flex-col" ng-controller="deviceDetailFirmwareVPCtrl" ng-show="visible()">\n  <div class="card-header col-xs-12">\n    <h4 class="card-title" translate>Firmware</h4>\n  </div>\n  <hr style="width: 100%">\n\n  <div class="card-block col-xs-12">\n    <label class="small" translate>Current firmware</label>\n    <p class="static-control">{{getCurrentFirmware()}}</p>\n  </div>\n\n  <form class="bg-gray-white flex-item-bottom col-xs-12" role="form" name="newOptionForm">\n    <div class="card-block">\n      <div class="legend form-block" translate>Firmware to install</div>\n      <div class="form-group">\n        <ui-select ng-model="newFirmware.selected" class="form-control">\n          <ui-select-match title="{{$select.selected.name}} &ndash; {{$select.selected.version}}">\n            {{$select.selected.name}} &ndash; {{$select.selected.version}}\n          </ui-select-match>\n          <ui-select-choices repeat="f in firmwares | orderBy:[\'name\',\'version\'] | filter: $select.search">\n            <span title="{{f.name}} &ndash; {{f.version}}">\n              {{f.name}} &ndash; {{f.version}}\n            </span>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n      <button type="button" class="btn btn-primary" ng-disabled="!newFirmware.selected" ng-click="uploadFirmware(device, newFirmware.selected)" translate>\n        Install\n      </button>\n    </div>\n  </form>\n</div>\n',e.put("core_deviceDetailSoftware/views/firmware.html",t),e.put("/apps/core/deviceDetailSoftware/views/firmware.html",t),t='\n<div class="card" ng-controller="deviceDetailSoftwareVPCtrl" ng-show="visible()">\n  <div class="card-header">\n    <h4 class="card-title" translate>Software</h4>\n  </div>\n  <hr>\n  <div class="card-block">\n    <div class="alert alert-warning" ng-show="installedSoftware.length == 0" translate>\n      No software available on the device\n    </div>\n\n    <table class="table table-condensed" ng-show="installedSoftware.length">\n      <thead>\n        <th translate>Name</th>\n        <th translate>Version</th>\n        <th></th>\n      </thead>\n      <tbody>\n        <tr ng-repeat="soft in installedSoftware | orderBy:[\'name\',\'version\']">\n          <td ng-bind="soft.name"></td>\n          <td ng-bind="soft.version"></td>\n          <td style="text-align:right">\n            <div ng-show="actionable()">\n              <a href="" class="btn btn-xs btn-danger showOnHover" title="{{\'Remove\' | translate}}" ng-click="removeSoftware(soft)">\n                <i c8y-icon="times"></i>\n              </a>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <button type="button" class="btn btn-success" ng-show="hasChanges" ng-click="sendOperation()" translate>\n      Submit operation\n    </button>\n    <button type="button" class="btn btn-danger" ng-show="hasChanges" ng-click="resetChanges()" translate>\n      Reset changes\n    </button>\n  </div>\n\n\n  <form role="form" class="bg-gray-white" name="newOptionForm">\n    <div class="card-block">\n      <div class="legend form-block" translate>Software to install</div>\n      <div class="form-group">\n        <ui-select ng-model="newSoftware.selected" class="form-control">\n          <ui-select-match title="{{$select.selected.name}} &ndash; {{$select.selected.version}}">\n            {{$select.selected.name}} &ndash; {{$select.selected.version}}\n          </ui-select-match>\n          <ui-select-choices repeat="s in softwares | orderBy:[\'name\',\'version\'] | filter: $select.search">\n            <span title="{{s.name}} &ndash; {{s.version}}">\n              {{s.name}} &ndash; {{s.version}}\n            </span>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n      <button type="button" class="btn btn-primary" ng-disabled="!newSoftware.selected" ng-click="installSoftware(newSoftware.selected)" translate>\n        Install\n      </button>\n    </div>\n  </form>\n</div>\n',e.put("core_deviceDetailSoftware/views/software.html",t),e.put("/apps/core/deviceDetailSoftware/views/software.html",t)}angular.module("c8y.deviceDetailSoftware").run(["$templateCache",e])}();