/* core_kpiAdmin 8.7.2 2017-08-02T09:54:34+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.parts.kpiAdmin",[]).config(["c8yViewsProvider","c8yComponentsProvider","c8yNavigatorProvider","gettext",function(n,a,e,i){"use strict";function l(n){return"/"+n}var t=window.location.pathname.match("/apps/cockpit"),s=t?"datapointlibrary":"kpi",r=i(t?"Data Point Library":"KPI");n.when(l(s),{templateUrl:"core_kpiAdmin/views/list.html"}),n.when(l(s)+"/new",{title:i("New data point settings"),templateUrl:"core_kpiAdmin/views/detail.html"}),n.when(l(s)+"/:kpiId",{title:i("Edit data point settings"),templateUrl:"core_kpiAdmin/views/detail.html"}),e.addNavigation({parent:i("Business rules"),name:r,path:s,icon:"c8y-data-points",showIfPermissions:{allRoles:["ROLE_INVENTORY_READ"]}})}]),function(){"use strict";function n(n,a,e,i,l,t,s,r,o,c,d){function p(a){n.refreshLoading=!1,n.kpis=a}function m(n){return _.map(n,function(n){return n._measurement=l.humanizeFragment(n.c8y_Kpi.fragment||""),n})}function u(){n.refreshLoading=!0,i.list().then(m).then(p)}function g(a){return s({title:c("Confirm delete?"),body:d.getString('Do you really want to delete data point "{{kpiLabel}}"?',{kpiLabel:a.c8y_Kpi.label}),status:"danger"}).then(_.partial(i.remove,a)).then(_.partial(_.remove,n.kpis,a)).then(_.partial(r.success,c("Data point successfully deleted")))}function v(){t.changeTitle({title:n.kpiOrDpName})}function y(){u(),v(),k()}function b(n,a){var e=a.c8y_Kpi;return!_.isUndefined(e[n+"RangeMin"])||!_.isUndefined(e[n+"RangeMax"])}function f(n,a){var e=a.c8y_Kpi,i=parseInt(e.min,0),l=parseInt(e.max,0),t=parseInt(e[n+"RangeMin"],0),s=parseInt(e[n+"RangeMax"],0),r=function(n){return 100*n};return{left:r((t-i)/(l-i))+"%",right:r(1-(s-i)/(l-i))+"%"}}function h(e){a.path("/"+n.kpiOrDpPath+"/"+e.id)}function k(){o.hasAllRoles(["ROLE_INVENTORY_ADMIN"]).then(function(a){n.canCreate=a})}var w=window.location.pathname.match("/apps/cockpit");n.info=e,n.refresh=u,n.remove=g,n.showYellowBar=_.partial(b,"yellow"),n.showRedBar=_.partial(b,"red"),n.yellowBarStyle=_.partial(f,"yellow"),n.redBarStyle=_.partial(f,"red"),n.detail=h,n.paging={refresh:!0},n.kpiOrDpPath=w?"datapointlibrary":"kpi",n.kpiOrDpName=c(w?"Data Point Library":"KPI"),y()}n.$inject=["$scope","$location","info","c8yKpi","c8yBase","c8yTitle","c8yModal","c8yAlert","c8yPermissions","gettext","gettextCatalog"],angular.module("c8y.parts.kpiAdmin").controller("KpiListCtrl",n)}(),angular.module("c8y.parts.kpiAdmin").controller("KpiDetailCtrl",["$scope","$window","$routeParams","$location","c8yBase","c8yKpi","c8yTitle","gettext","gettextCatalog",function(n,a,e,i,l,t,s,r,o){"use strict";function c(n){n?t.detail(n).then(function(n){return n.data}).then(p):d()}function d(){var n=e.fragment&&e.series?l.humanizeFragment(e.fragment+" => "+e.series):x?o.getString("New data point"):o.getString("New KPI");p({c8y_Kpi:{label:n,fragment:e.fragment,series:e.series,color:"#"+Math.floor(16777215*Math.random()).toString(16)}})}function p(a){n.kpi=w=a,m()}function m(){var n=w.c8y_Kpi;s.changeTitle({title:w.id?n.label:x?o.getString("Add new data point"):o.getString("Add new KPI"),subtitle:function(){return n.fragment&&n.series?n.fragment+" / "+n.series:""}()})}function u(){t.save(w).then(g)}function g(){var n=a.history;n.length>1?n.back():i.path("/kpi")}function v(a){var e=n.editKpi,i=e[a];return _.filter(_.map(i&&i.$error,function(n,a){return n&&E[a]}),_.identity).join(" ")}function y(a){var e=n.editKpi[a];return e&&e.$invalid}function b(){var a=n.editKpi;return _.forEach([[a.min,a.max],[a.yellowRangeMin,a.yellowRangeMax],[a.redRangeMin,a.redRangeMax]],function(n,e){f.apply(this,n),h.apply(this,n),e&&_.partial(k,a.min,a.max).apply(this,n)}),a.$valid}function f(n,a){var e=n.$modelValue,i=a.$modelValue,l=!_.isUndefined(e)&&null!==e,t=!_.isUndefined(i)&&null!==i;n.$setValidity(R.SHOULD_BE_DEFINED,!(t&&!l)),a.$setValidity(R.SHOULD_BE_DEFINED,!(l&&!t))}function h(n,a){var e=n.$modelValue,i=a.$modelValue,l=!_.isUndefined(e)&&null!==e,t=!_.isUndefined(i)&&null!==i,s=l&&t;n.$setValidity(R.GREATER_THAN_RANGE_MAX,!s||e<i),a.$setValidity(R.LESS_THAN_RANGE_MIN,!s||i>e)}function k(n,a,e,i){var l=n.$modelValue,t=a.$modelValue,s=!_.isUndefined(l)&&null!==l&&!_.isUndefined(t)&&null!==t,r=[e,i];s&&_.forEach(r,function(n){var a=n.$modelValue;!_.isUndefined(a)&&null!==a;a&&(n.$setValidity(R.GREATER_THAN_SCALE_MAX,a<=t),n.$setValidity(R.LESS_THAN_SCALE_MIN,a>=l))})}var w,x=window.location.pathname.match("/apps/cockpit"),R={IS_REQUIRED:"required",SHOULD_CONTAIN_NUMBER:"number",SHOULD_BE_DEFINED:"should-be-defined",GREATER_THAN_SCALE_MAX:"greater-than-scale-max",LESS_THAN_SCALE_MIN:"less-than-scale-min",GREATER_THAN_RANGE_MAX:"greater-than-range-max",LESS_THAN_RANGE_MIN:"less-than-range-min"},E={};E[R.IS_REQUIRED]=r("This field is required!"),E[R.SHOULD_CONTAIN_NUMBER]=r("This field should contain a number!"),E[R.SHOULD_BE_DEFINED]=r("Value should be defined!"),E[R.GREATER_THAN_SCALE_MAX]=r("Value should be less than scale maximum!"),E[R.LESS_THAN_SCALE_MIN]=r("Value should be greater than scale minimum!"),E[R.GREATER_THAN_RANGE_MAX]=r("Value should be less than respective maximum!"),E[R.LESS_THAN_RANGE_MIN]=r("Value should be greater than respective minimum!"),n.save=u,n.cancel=g,n.invalidTxt=v,n.invalid=y,n.formValid=b,c(e.kpiId)}]),function(){"use strict";function n(n){var a;a='<div ng-controller="KpiDetailCtrl">\n\n  <div class="row">\n    <div class="col-sm-8 col-md-6">\n      <form name="editKpi" class="card" role="form" ng-submit="save()" novalidate>\n\n        <div class="card-block">\n\n          <div class="flex-row">\n            <div class="form-group" ng-class="{\'has-error\': invalid(\'color\')}">\n              <label>{{\'Color\' | translate}} *</label>\n              <div class="data-point-color">\n                <input c8y-color-picker="{theme: \'hidden-input\'}" type="hidden" class="colorpicker" name="color" ng-model="kpi.c8y_Kpi.color" required uib-tooltip="{{invalidTxt(\'color\') | translate}}">\n                <!-- <input type="color" class="colorpicker" name="color" ng-model="kpi.c8y_Kpi.color" required uib-tooltip="{{invalidTxt(\'color\') | translate}}"> -->\n                <!-- <i c8y-icon="circle" ng-style="{color: kpi.c8y_Kpi.color}" style="text-align:left;"></i> -->\n              </div>\n            </div>\n            <div class="form-group" ng-class="{\'has-error\': invalid(\'label\')}" style="flex: 1 1 auto; align-self: flex-start; padding-left:10px">\n              <label>{{\'Label\' | translate}} *</label>\n              <input class="form-control" name="label" ng-model="kpi.c8y_Kpi.label" required uib-tooltip="{{invalidTxt(\'label\') | translate}}">\n            </div>\n\n        </div>\n\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'fragment\')}">\n            <label>{{\'Fragment\' | translate}} *</label>\n            <input class="form-control" name="fragment" ng-model="kpi.c8y_Kpi.fragment" required uib-tooltip="{{invalidTxt(\'fragment\') | translate}}">\n          </div>\n\n          <div class="form-group" ng-class="{\'has-error\': invalid(\'series\')}">\n            <label>{{\'Series\' | translate}} *</label>\n            <input class="form-control" name="series" ng-model="kpi.c8y_Kpi.series" required uib-tooltip="{{invalidTxt(\'series\') | translate}}">\n          </div>\n\n        <div class="row">\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'unit\')}">\n            <label translate>Unit</label>\n            <input class="form-control" name="unit" ng-model="kpi.c8y_Kpi.unit" uib-tooltip="{{invalidTxt(\'unit\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'target\')}">\n            <label translate>Target</label>\n            <input type="number" step="any" class="form-control" name="target" ng-model="kpi.c8y_Kpi.target" uib-tooltip="{{invalidTxt(\'target\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'min\')}">\n            <label translate>Minimum</label>\n            <input type="number" step="any" class="form-control" name="min" ng-model="kpi.c8y_Kpi.min" uib-tooltip="{{invalidTxt(\'min\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'max\')}">\n            <label translate>Maximum</label>\n            <input type="number" step="any" class="form-control" name="max" ng-model="kpi.c8y_Kpi.max" uib-tooltip="{{invalidTxt(\'max\') | translate}}">\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'yellowRangeMin\')}">\n            <label translate>Yellow range</label>\n            <input type="number" step="any" class="form-control" name="yellowRangeMin" ng-model="kpi.c8y_Kpi.yellowRangeMin" placeholder="{{\'Min\' | translate}}" uib-tooltip="{{invalidTxt(\'yellowRangeMin\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'yellowRangeMax\')}">\n            <label>&nbsp;</label>\n            <input type="number" step="any" class="form-control" name="yellowRangeMax" ng-model="kpi.c8y_Kpi.yellowRangeMax" placeholder="{{\'Max\' | translate}}" uib-tooltip="{{invalidTxt(\'yellowRangeMax\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'redRangeMin\')}">\n            <label translate>Red range</label>\n            <input type="number" step="any" class="form-control" name="redRangeMin" ng-model="kpi.c8y_Kpi.redRangeMin" placeholder="{{\'Min\' | translate}}" uib-tooltip="{{invalidTxt(\'redRangeMin\') | translate}}">\n          </div>\n          <div class="form-group col-md-3" ng-class="{\'has-error\': invalid(\'redRangeMax\')}">\n            <label>&nbsp;</label>\n            <input type="number" step="any" class="form-control" name="redRangeMax" ng-model="kpi.c8y_Kpi.redRangeMax" placeholder="{{\'Max\' | translate}}" uib-tooltip="{{invalidTxt(\'redRangeMax\') | translate}}">\n          </div>\n        </div>\n        </div>\n        <div class="card-footer text-center separator">\n          <button type="button" class="btn btn-default" ng-click="cancel()" translate>Cancel</button>\n          <button type="submit" class="btn btn-primary" ng-disabled="!formValid()" translate>Save</button>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n',n.put("core_kpiAdmin/views/detail.html",a),n.put("/apps/core/kpiAdmin/views/detail.html",a),a='<div ng-controller="KpiListCtrl">\n  <div class="c8y-toolbar-spacer page-toolbar">\n    <div class="c8y-toolbar navbar navbar-default" c8y-affix>\n\n      <div class="navbar-header">\n        <button type="button" class="navbar-toggle collapsed" ng-click="isPageToolbarExpanded = !isPageToolbarExpanded" aria-expanded="false">\n          <span class="sr-only">Toggle Toolbar</span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n        </button>\n      </div>\n\n      <div id="page-toolbar" class="navbar-collapse collapse" uib-collapse="!isPageToolbarExpanded" aria-expanded="false" aria-hidden="true" style="height: 0px">\n\n        <ul class="nav navbar-nav navbar-right">\n          <li class="navbar-form hidden-xs">\n            <div class="form-group">\n              <label>Display as&nbsp;</label>\n              <div class="input-group">\n                <div class="c8y-select-wrapper">\n                  <select id="layout-switcher" class="form-control" ng-model="listClass" ng-init="listClass=\'interact-list\'">\n                    <option value="interact-list">List</option>\n                    <option value="interact-grid">Grid</option>\n                  </select>\n                  <span></span>\n                </div>\n              </div>\n            </div>\n          </li>\n          <li>\n            <c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\']">\n              <a href="#/{{kpiOrDpPath}}/new" class="btn btn-link">\n                <i c8y-icon="plus-circle"></i>\n                <span ng-switch="kpiOrDpPath">\n                  <span ng-switch-when="kpi">{{\'Add KPI\' | translate}}</span>\n                  <span ng-switch-when="datapointlibrary">{{\'Add data point\' | translate}}</span>\n                </span>\n              </a>\n            </c8y-if-allowed>\n          </li>\n          <li>\n            <c8y-refresh-btn></c8y-refresh-btn>\n          </li>\n\n        </ul>\n      </div>\n    </div>\n  </div>\n\n\n  <!-- empty state -->\n  <div class="c8y-empty-state text-center" ng-show="kpis.length == 0">\n    <h1 class="c8y-icon c8y-icon-data-points c8y-icon-duocolor"></h1>\n    <h3 translate>No data points to display.</h3>\n    <p translate>Add a data point using the button on the toolbar.</p>\n  </div>\n  <!-- /.empty state -->\n\n  <div class="card-group" ng-class="listClass">\n\n    <div ng-repeat="k in kpis | orderBy: [\'_measurement\', \'c8y_Kpi.series\']" class="col-sm-6 col-md-4 col-lg-3 col-xs-12">\n      <div class="card" ng-click="detail(k)">\n\n        <div class="card-actions" ng-click="$event.stopPropagation()">\n          <div class="settings pull-right dropdown" uib-dropdown="" is-open="menuOpen">\n            <button type="button" title="Options" class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle>\n              <i c8y-icon="ellipsis-v" class="fa fw fa-ellipsis-v"></i>\n            </button>\n            <ul class="dropdown-menu" uib-dropdown-menu>\n              <li>\n                <a href="" title="Edit" ng-click="detail(k)">\n                  <i c8y-icon="pencil"></i> <translate>Edit</translate>\n                </a>\n              </li>\n              <li>\n                <a href="" title="{{\'Remove\' | translate}}" ng-click="remove(k)">\n                  <i c8y-icon="trash"></i> Remove\n                </a>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        <div class="card-header">\n          <!-- TODO: Bulk actions component\n          <div class="card-bulk-check">\n            <label title="Select" class="c8y-checkbox item-checkbox">\n              <input type="checkbox"> <span></span>\n            </label>\n          </div> -->\n          <div class="card-icon">\n            <i c8y-icon="circle" ng-style="{color: k.c8y_Kpi.color}"></i>\n          </div>\n          <div class="card-title text-truncate" title="{{k._measurement}}">{{k._measurement}}</div>\n        </div>\n        <div class="card-block">\n          <div class="col-sm-2 col-md-2">\n            <label class="small" translate>Series</label> {{k.c8y_Kpi.series}}\n          </div>\n          <div class="col-sm-3 col-md-4">\n            <span ng-if="k.c8y_Kpi.label.length">\n              <label class="small" translate>Name</label> {{k.c8y_Kpi.label | translate}}\n            </span>\n          </div>\n          <div class="col-sm-1 col-md-2">\n            <span ng-if="k.c8y_Kpi.unit.length">\n              <label class="small" translate>Unit</label> {{k.c8y_Kpi.unit}}\n            </span>\n          </div>\n          <div class="col-sm-2">\n            <span ng-if="k.c8y_Kpi.target.length">\n              <label class="small" translate>Target</label> {{k.c8y_Kpi.target}}\n            </span>\n          </div>\n          <div class="col-sm-3 col-md-2">\n            <!-- <label translate>Range</label> -->\n            <div class="kpiRange" ng-if="k.c8y_Kpi.min || k.c8y_Kpi.max" title="{{\'Range\' | translate}}">\n              <small class="number min">{{k.c8y_Kpi.min}}</small>\n              <small class="number max">{{k.c8y_Kpi.max}}</small>\n              <div class="range-holder">\n                <div class="yellow bar" ng-style="yellowBarStyle(k)" ng-show="showYellowBar(k)"></div>\n                <div class="red bar" ng-style="redBarStyle(k)" ng-show="showRedBar(k)"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n',n.put("core_kpiAdmin/views/list.html",a),n.put("/apps/core/kpiAdmin/views/list.html",a)}angular.module("c8y.parts.kpiAdmin").run(["$templateCache",n])}();