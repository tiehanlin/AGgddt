/* demoboard_windmillControl 8.7.2 2017-08-02T09:53:13+00:00 c1f802513a81 (hotfix/8.7.2) tip */
!function(){"use strict";function n(n,e){n.add({name:"windmillControl",nameDisplay:e("Tixi windmill control"),description:e("Widget controlling a windmill with Tixi commands"),templateUrl:"demoboard_windmillControl/views/windmill.html",configTemplateUrl:"demoboard_windmillControl/views/config.html"})}angular.module("c8y.demoboard.windmillControl",[]).config(["c8yComponentsProvider","gettext",n])}(),function(){"use strict";function n(n){function e(e,t,i,l){function o(){var n=(e.states()||[]).length;return s.width()/(n||1)+2}function r(){var n=l.$modelValue,t=_.findIndex(e.states()||[],{value:n&&n.value||n});return t}function d(){var n=o(),e=r();m.width(n),m.css({left:n*e,visibility:e<0?"hidden":"visible"}),c.width(n*e+n/2)}function a(n){var e=l.$modelValue;return(e&&e.value)===n.value}function u(n){return a(n)&&e.requireInput()}var s=t.find(":first-child"),c=s.find(".c8y-multistate-track"),m=s.find(".c8y-multisate-switch");$(n);s.on("change",'input[type="radio"]',function(n){var t=$(n.target).parent(),i=s.find(".c8y-multistate"),o=e.states()[i.index(t)];e.$apply(function(){e.onChange({value:o}),l.$setViewValue(o),d()})}),e.checked=a,e.showInput=u,l.$render=d,d()}return{restrict:"E",require:"ngModel",templateUrl:"demoboard_windmillControl/multistate.html",scope:{states:"&",onSet:"&?",onChange:"&?",requireInput:"&?",btnLabel:"@?"},link:e}}angular.module("c8y.ui").directive("c8yMultistate",["$window",n])}(),function(){"use strict";function n(n,e,t,i,l){function o(){var t=e.deviceId;return n.child.config&&n.child.config.device&&n.child.config.device.id&&(t=n.child.config.device.id),t}function r(){return{name:n.child.config&&n.child.config.windmill&&n.child.config.windmill.name,number:n.child.config&&n.child.config.windmill&&n.child.config.windmill.number,mode:null,speed:null}}function d(){}function a(){}function u(n){return n===f.mode}function s(n){return l.setMode(v,f,n).then(function(){f.mode=n})}function c(n){return l.setSpeed(v,f,n).then(function(){f.speed=n})}function m(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}function p(){var n=f.mode;return(n&&n.value)===l.Modes.MANUAL.value}var v=o(),f=r();n.deviceId=v,n.windmill=f,n.Modes=l.Modes,n.isModeSet=u,n.setMode=s,n.setSpeed=c,n.humanize=m,n.invalid=angular.bind(t,t.invalid,n,"windmillForm"),n.showInput=p,n.$on("$destroy",a),d()}angular.module("c8y.demoboard.windmillControl").controller("windmillControlCtrl",["$scope","$routeParams","c8yBase","c8yAlert","windmillControlSvc",n])}(),function(){"use strict";function n(n,e,t,i){function l(n,e,t){var i={deviceId:n.id||n,description:"Setting mode "+t.name+" for Windmill "+e.name,c8y_Command:{text:'[<Set _="/Process/PV/Windmill'+e.number+'Mode" value="'+t.value+'" ver="v"/>]'}};return p(i)}function o(n,e,t){var i={deviceId:n.id||n,description:"Setting speed "+t+" for Windmill "+e.name,c8y_Command:{text:'[<Set _="/Process/PV/WindMill'+e.number+'_Setpoint" value="'+t+'" ver="v"/>]'}};return p(i)}function r(n){var t=n.deviceId;f[t]?f[t].count++:f[t]={promise:e(_.partial(a,t),w),count:1}}function d(n){var t=n.deviceId;f[t]&&(f[t].count--,f[t].count<1&&(e.cancel(f[t].promise),delete f[t]))}function a(n){u(n).then(function(e){if(c(e))return m(n)})}function u(e){var t=10,i=[];return s(e,t,1,!0).then(function(l){var o=l.statistics.totalPages;return i.push(s(e,t,o)),o>1&&i.push(s(e,t,o-1)),n.all(i)})}function s(n,e,t,l){return i.list({deviceId:n,pageSize:e,currentPage:t,withTotalPages:l})}function c(n){return 0===_(_.flattenDeep(n)).filter(function(n){return!_.isUndefined(n[g])&&moment().subtract(h.value,h.units).isBefore(n.creationTime)}).value().length}function m(n){var e={deviceId:n,description:"Get measurements",c8y_MeasurementRequestOperation:{requestName:"LOG"}};return p(e)}function p(n){return i.create(n)}var v=t.createEnum([{name:"OFF",value:"0"},{name:"MANUAL",value:"1"},{name:"AUTO",value:"2"}]),f={},w=11e3,g="c8y_MeasurementRequestOperation",h={value:10,units:"seconds"};return{Modes:v,setMode:l,setSpeed:o,initComponent:r,destroyComponent:d}}angular.module("c8y.demoboard.windmillControl").factory("windmillControlSvc",["$q","$interval","c8yBase","c8yDeviceControl",n])}(),function(){"use strict";function n(n){var e;e='<div class="c8y-multistate-group">\n\n  <div class="c8y-multistate-track"></div>\n  <div class="c8y-multisate-switch"></div>\n\n  <label class="c8y-multistate" ng-repeat="state in states()" ng-class="{dropdown: hasDropDown(state), open: showInput(state)}">\n    <input type="radio" name="radioOptions" id="state{{$index}}" value="{{state.value}}" ng-checked="checked(state)">\n    <span>{{state.name}}</span>\n\n    <div data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ng-if="showInput(state)"></div>\n    <ul class="dropdown-menu open" aria-labelledby="dropdownMenu1{{$index}}" ng-if="showInput(state)" uib-dropdown-menu>\n      <li>\n        <div style="padding: 8px 10px">\n          <div class="input-group">\n            <input type="number" min="0" max="100" class="form-control" ng-model="formVal">\n            <span class="input-group-btn" id="basic-addon2">\n              <button class="btn btn-primary" type="button" ng-click="onSet({value: formVal})" ng-disable="invalid(formVal)">{{btnLabel || \'Set\' | translate}}</button>\n            </span>\n          </div>\n        </div>\n      </li>\n    </ul>\n\n  </label>\n</div>\n',n.put("demoboard_windmillControl/multistate.html",e),n.put("/apps/demoboard/windmillControl/multistate.html",e),e='<div>\r\n  <div class="form-group">\r\n    <label>Windmill\'s name</label>\r\n    <input class="form-control" type="text" ng-model="config.windmill.name" required/>\r\n  </div>\r\n  <div class="form-group">\r\n    <label>Windmill\'s number</label>\r\n    <input class="form-control" type="number" ng-model="config.windmill.number" required/>\r\n  </div>\r\n</div>\r\n',n.put("demoboard_windmillControl/views/config.html",e),n.put("/apps/demoboard/windmillControl/views/config.html",e),e='<div ng-controller="windmillControlCtrl" class="windmill">\n\n    <p class="windmill-icon">\n      <img src="demoboard_windmillControl/images/windmill-fan.svg" style="width: 33px"/> Windmill Controller\n    </p>\n    <h3 class="windmill-name">\n      {{windmill.name}}\n    </h3>\n    <form name="windmillForm" style="padding: 20px" role="form" novalidate>\n\n        <c8y-multistate ng-model="windmill.mode" states="Modes.values()" on-set="setSpeed(value)" on-change="setMode(value)" require-input="showInput()">\n        </c8y-multistate>\n\n\n      </form></div>\n    \n  \n\n',n.put("demoboard_windmillControl/views/windmill.html",e),n.put("/apps/demoboard/windmillControl/views/windmill.html",e)}angular.module("c8y.demoboard.windmillControl").run(["$templateCache",n])}();