/* core_export 8.7.2 2017-08-02T09:54:24+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function e(e,t,n){t.addNavigation({priority:1,name:n("Reporting"),parent:n("Reports"),icon:"c8y-report",path:"export",ignoreAlphabeticalOrder:!0}),e.when("/export",{icon:"bar-chart",name:n("Reporting"),templateUrl:"core_export/views/list.html",controller:["c8yTitle","gettext",function(e,t){e.changeTitle({title:t("Reporting")})}]}),e.when("/export/:exportId/:clone?",{templateUrl:"core_export/views/detail.html",name:n("Properties"),icon:"bar-chart"})}angular.module("c8y.cockpit.export",[]).config(["c8yViewsProvider","c8yNavigatorProvider","gettext",e])}(),function(){"use strict";function e(e,t,n,a,i,o,l,r,s){function c(t){e.rows=_(t).sortBy("name").map(function(e){return{config:e,selected:!1}}).value(),e.paging=t.paging}function p(){i.current(!0).then(function(t){e.hasEmail=!!t.email,t.email||o.info(r("Please provide e-mail in user settings in order to use export functionality."))})}function d(){p(),t.list().then(c)}e.rows=[],e.add=function(){a.path("/export/new")},e.detail=function(e){a.path("/export/"+e.id)},e.clone=function(e){a.path("/export/"+e.id+"/clone")},e.remove=function(e){l({title:r("Confirm delete?"),body:s.getString('Do you really want to remove configuration "{{name}}"?',{name:e.name}),status:"danger",size:"sm"}).then(function(){return t.remove(e)}).then(d)},e.export=function(){var t=e.getSelectedConfigs();return n.requestExport(_.map(t,"id")).then(function(){o.success(r("Export request accepted, you will receive an e-mail."))})},e.getSelectedConfigs=function(){return _(e.rows).filter({selected:!0}).map("config").flatten().value()},e.refresh=function(){e.paging.refresh().then(c)},d()}angular.module("c8y.cockpit.export").controller("exportListCtrl",["$scope","exportConfig","exportService","$location","c8yUser","c8yAlert","c8yModal","gettext","gettextCatalog",e])}(),function(){"use strict";function e(e,t,n,a,i,o,l,r,s){function c(){h=a.exportId,y=!!a.clone,h="new"===h?void 0:h,e.exportTypes=i.getFileTypes(),e.config=i.create(),p()}function p(){h?i.detail(h).then(d):d()}function d(t){e.config=i.create(t),e.filters=i.getFilters(e.config,h&&!y),e.apis=i.getApis(e.config),v()}function u(){return e.config.apiList=[],e.config.queryParameters={},_.forEach(e.filters,function(t){t.onSave(e.config)}),_.forEach(e.apis,function(t){t.onSave(e.config)}),i.save(e.config).then(function(){n.path("/export")})}function f(e){l.changeTitle({title:e})}function m(t){var n=[],a=e[b][t]&&e[b][t].$error;if(a)return _.forEach(e[b][t].$error,function(e,a){e&&!_.isUndefined(x[a])&&("object"==typeof x[a]&&x[a][t]?n.push(x[a][t]):n.push(x[a]))}),n.join(" ")}function v(){h?y?(delete e.config.id,e.isNew=!0,f(s.getString("Clone of {{config}}",{config:e.config.name}))):f(r("Report details")):(e.isNew=!0,f(r("Create configuration")))}function g(e){e.enabled=!0}var h,y,b="exportForm",x={required:r("This field is required!"),maxlength:r("Up to 120 characters allowed!")};c(),e.invalid=angular.bind(o,o.invalid,e,b),e.validationHints=m,e.save=u,e.onSelectionChanged=g}angular.module("c8y.cockpit.export").controller("exportConfigDetailCtrl",["$scope","$q","$location","$routeParams","exportConfig","c8yBase","c8yTitle","gettext","gettextCatalog",e])}(),function(){"use strict";function e(e){function t(t){t.types={LAST_WEEK:e("Last week"),LAST_MONTH:e("Last month"),LAST_YEAR:e("Last year"),CUSTOM:e("Custom")}}return{restrict:"AE",link:t,scope:{timespan:"=c8yExportTimespan"},templateUrl:"core_export/views/timespan.html"}}angular.module("c8y.cockpit.export").directive("c8yExportTimespan",["gettext",e])}(),function(){"use strict";function e(e,n,a,i,o){this.requestExport=function(a){var i=_.isArray(a)?a:[a],o=i.map(function(e){return n({method:"GET",url:t,params:{configurationId:e}})});return e.all(o)}}angular.module("c8y.cockpit.export").service("exportService",["$q","$http","c8yAlert","c8yBase","gettext",e]);var t="/export/exports"}(),function(){"use strict";function e(e,a,i,o,l){function r(e){var t=_.tail(Array.prototype.slice.call(arguments));return _.map(e,function(e){var n=e.def,a=_.tail(n),i=_.bind.apply(_,[n[0],n[0]].concat(a).concat(t)),o=new i;return _.assign(o,_.omit(e,"def","name")),o})}var s=[{name:"source",label:i("Object to export"),template:"core_export/views/filters/source.html",def:[l.SourceFilter,"source"]},{name:"dateType",label:i("Time range"),template:"core_export/views/filters/dateRange.html",def:[l.DateRangeFilter,"dateType"]}],c=[{name:"Alarms",icon:"bell",label:i("Alarms"),def:[o.Api,"Alarms"]},{name:"Events",icon:"rss",label:i("Events"),def:[o.Api,"Events"]},{name:"ManagedObjects",icon:"cubes",label:i("Managed objects"),def:[o.Api,"ManagedObjects"]},{name:"Measurements",icon:"bar-chart-o",label:i("Measurements"),def:[o.MeasurementsApi],template:"core_export/views/apis/measurements.html"}];this.getFilters=function(e,t){return r(s,e,t)},this.getApis=function(e){return r(c,e)},this.getFileTypes=function(){return[{name:"CSV",type:"csv"},{name:"Excel (.xlsx)",type:"vnd.ms-excel"}]},this.list=function(){return a.list({fragmentType:t})},this.create=function(e){return _.merge(_.cloneDeep(n),e)},this.detail=function(t){return a.detail(t).then(e.getResData)},this.save=function(n){return n.id?a.save(n).then(function(){return n}):(n[t]={},a.createConfirm(n).then(e.getResData))},this.remove=function(e){return a.remove(e.id)}}angular.module("c8y.cockpit.export").service("exportConfig",["c8yBase","c8yInventory","gettext","c8yExportApis","c8yExportFilters",e]);var t="c8y_ExportConfiguration",n={name:"",exportType:"csv",queryParameters:{},apiList:[]}}(),function(){"use strict";function e(e,t,n,a){function i(e,t,n){this.name=e,this.isDetailPage=n,this.onLoad(t)}function o(e,t){i.call(this,e,t)}function l(e,t,n){i.call(this,e,t,n)}return i.prototype.onLoad=function(e){this.value=e.queryParameters[name],this.enabled=Boolean(e.queryParameters[name])},i.prototype.onSave=function(e){this.enabled&&(e.queryParameters[this.name]=this.value)},o.prototype=Object.create(i.prototype),o.prototype.onLoad=function(e){var t=e.queryParameters;this.value=t.source||t.groupId,this.enabled=Boolean(this.value),this.loadSource()},o.prototype.loadSource=function(){var a=this;return this.value?n.detail(this.value).then(t.getResData).then(function(e){a.value=e}):e.when()},o.prototype.onSave=function(e){var t=e.queryParameters;delete t.source,delete t.groupId,this.enabled&&this.value&&(a.isGroup(this.value)?t.groupId=this.value.id:t.source=this.value.id)},l.prototype=Object.create(i.prototype),l.prototype.onLoad=function(e){var t=e.queryParameters;this.enabled=!0,this.value={dateType:"LAST_WEEK"},this.isDetailPage&&(this.enabled=Boolean(t.dateType),this.value={dateType:t.dateType,from:t.from,to:t.to})},l.prototype.onSave=function(e){var t=e.queryParameters;delete t.dateType,delete t.from,delete t.to,this.enabled&&_.merge(t,this.value)},{Filter:i,SourceFilter:o,DateRangeFilter:l}}angular.module("c8y.cockpit.export").factory("c8yExportFilters",["$q","c8yBase","c8yInventory","c8yGroups",e])}(),function(){"use strict";function e(e,t,n,a){function i(e,t){this.name=e,this.onLoad(t)}function o(e){return _.map(e,function(e){return{column:e.label,path:e.keyPath.join(".")}})}function l(e){_.forEach(e,function(e){s.indexOf(e.path)>=0&&(e.type=e.path)})}function r(e){i.call(this,a("Measurements"),e)}var s=["DEVICE_NAME"],c=["Alarms","Events","Measurements"];return i.prototype.onLoad=function(e){var t=_.find(e.apiList,{api:this.name});this.enabled=Boolean(t),this.fields=this.enabled&&t.fields||[]},i.prototype.toggle=function(e,n){if(n&&0===this.fields.length&&c.indexOf(this.name)>=0){var a=this;t.another(t.paths[this.name]).list().then(function(e){var t=["time","DEVICE_NAME"],n=_.filter(e,function(e){var n=e.keyPath[0];return t.indexOf(n)>=0});a.addAll(o(n))})}return n},i.prototype.onSave=function(e){this.enabled&&(l(this.fields),e.apiList=e.apiList||[],e.apiList.push({api:this.name,fields:this.fields}))},i.prototype.add=function(e){this.fields.push(e||{})},i.prototype.addAll=function(e){var t=this;_.forEach(e,function(e){t.add(e)})},i.prototype.addPredefined=function(){var t=this;e.openSelector({type:this.name,showComputed:!1,includeTreeChildren:!0}).then(function(e){t.addAll(o(e))})},i.prototype.remove=function(e){this.fields.splice(e,1)},i.prototype.removeAll=function(){this.fields.length=0},r.prototype=Object.create(i.prototype),r.prototype.addFromDatapoint=function(){var e=this;n.addUI().then(function(t){var n=_.map(t,function(e){return{column:e.label,path:[e.fragment,e.series,"value"].join(".")}});e.addAll(n)})},{Api:i,MeasurementsApi:r}}angular.module("c8y.cockpit.export").factory("c8yExportApis",["SchemaPropertiesSvc","c8yPropertiesLibrary","c8yDataPointSvc","gettext",e])}(),function(){"use strict";function e(e){var t;t='<button class="btn-add-block" ng-click="api.addFromDatapoint()">\n  <i c8y-icon="plus-square"></i> {{\'Add from datapoint\' | translate}}\n</button>\n',e.put("core_export/views/apis/measurements.html",t),e.put("/apps/core/export/views/apis/measurements.html",t),t='<div class="row exportReport" ng-controller="exportConfigDetailCtrl">\n  <form name="exportForm" novalidate class="col-md-10 col-lg-9 col-sm-12">\n    <div class="card">\n      <div class="card-block">\n        <div class="form-group" ng-class="{\'has-error\': invalid(\'name\')}">\n          <label>{{\'Name\' | translate}} *</label>\n          <input type="text" name="name" class="form-control" required ng-model="config.name" ng-maxlength="120" uib-tooltip="{{validationHints(\'name\') | translate}}" tooltip-trigger="focus">\n        </div>\n\n        <div class="form-group" ng-class="{\'has-error\': invalid(\'exportType\')}">\n          <label>{{\'File type\' | translate}} *</label>\n          <div>\n            <label ng-repeat="option in exportTypes" class="fileType c8y-radio radio-inline">\n              <input type="radio" ng-value="option.type" ng-model="config.exportType"><span></span>\n              <span class="fa" ng-class="{\'fa-file-text-o\': option.type === \'csv\', \'fa-file-excel-o\': option.type === \'vnd.ms-excel\'}"></span> {{ option.name | translate }}\n            </label>\n          </div>\n        </div>\n\n        <div class="query-parameters">\n          <div class="legend form-block">{{\'Filters\' | translate}}</div>\n          <table class="table filterList table-striped">\n            <thead>\n              <tr>\n                <th style="width: 40px"></th>\n                <th translate style="width: 30%">Name</th>\n                <th translate>Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr ng-repeat="filter in filters" ng-include="\'core_export/views/filter.html\'" style="vertical-align: middle">\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        <div class="legend form-block">{{\'Fields\' | translate}}</div>\n        <p><i c8y-icon="info-circle text-info"></i> <span translate>You will receive separate e-mail for each selected type of data.</span></p>\n\n        <div class="apiList">\n          <div class="row" ng-repeat="api in apis">\n            <div class="col-sm-12"><hr></div>\n            <div class="col-sm-3">\n              <div class="flex-row">\n                <label class="c8y-switch">\n                  <input type="checkbox" ng-model="api.enabled" ng-change="api.toggle(api, api.enabled);">\n                  <span></span>\n                </label>\n                <h4 style="margin: 0 5px" ng-class="{\'text-muted\': !api.enabled}"><i c8y-icon="{{api.icon}}" class="status"></i></h4>\n                <p style="line-height: 1" ng-class="{\'text-muted\': !api.enabled}">{{api.label | translate}}</p>\n              </div>\n            </div>\n\n            <div class="apiListDetails col-sm-9" ng-show="api.enabled">\n              <div ng-include="\'core_export/views/properties.html\'">\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n      <div class="card-footer separator text-center">\n        <button class="btn btn-primary" ng-click="save()" ng-disabled="exportForm.$invalid" translate>\n          Save\n        </button>\n      </div>\n    </div>\n  </form>\n</div>\n',e.put("core_export/views/detail.html",t),e.put("/apps/core/export/views/detail.html",t),t='<td>\n  <label class="c8y-checkbox">\n    <input type="checkbox" ng-model="filter.enabled"><span></span>\n  </label>\n</td>\n<td>\n  <label ng-bind="filter.label | translate"></label>\n</td>\n<td ng-include="filter.template">\n</td>\n',e.put("core_export/views/filter.html",t),e.put("/apps/core/export/views/filter.html",t),t='<div c8y-export-timespan="filter.value"></div>\n',e.put("core_export/views/filters/dateRange.html",t),e.put("/apps/core/export/views/filters/dateRange.html",t),t='<input class="form-control input-sm" type="text" ng-model="filter.value">\n',e.put("core_export/views/filters/default.html",t),e.put("/apps/core/export/views/filters/default.html",t),t='<div c8y-device-selector-combo parent="null" selected-child-device="filter.value" groups-selectable="true" on-select="onSelectionChanged(filter)">\n</div>\n',e.put("core_export/views/filters/source.html",t),e.put("/apps/core/export/views/filters/source.html",t),t='<div data-ng-controller="exportListCtrl">\n  <div class="c8y-toolbar-spacer page-toolbar">\n    <div class="c8y-toolbar navbar navbar-default">\n\n      <div class="navbar-header">\n        <button type="button" class="navbar-toggle collapsed" ng-click="isPageToolbarExpanded = !isPageToolbarExpanded" aria-expanded="false">\n          <span class="sr-only">Toggle Toolbar</span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n          <span class="icon-bar"></span>\n        </button>\n      </div>\n\n      <div id="page-toolbar" class="navbar-collapse collapse" uib-collapse="!isPageToolbarExpanded" aria-expanded="false" aria-hidden="true" style="height: 0px">\n\n        <!-- TODO: change export button into select option and also allow  removing reports as bulk action-->\n        <ul class="nav navbar-nav navbar-left">\n          <!-- <li class="navbar-form c8y-bulk-actions">\n            <div class="form-group" title="Bulk actions">\n              <div class="input-group">\n                <div class="c8y-select-wrapper">\n                  <select class="form-control" ng-disabled="!hasEmail || getSelectedConfigs().length === 0">\n                    <option value="">Select bulk action</option>\n                    <option value="">Export</option>\n                    <option value="">Remove</option>\n                  </select>\n                  <span></span>\n                </div>\n                <span class="input-group-btn">\n                  <button type="button" class="btn btn-default" title="{{\'Apply the selected action to the group of checked rows\' | translate}}" translate="">Apply</button>\n                </span>\n              </div>\n            </div>\n          </li>\n           -->\n          <!-- TODO: Remove  after implementing export in select -->\n          <li>\n            <button class="btn btn-link" ng-click="export()" ng-disabled="!hasEmail || getSelectedConfigs().length === 0">\n              <i c8y-icon="external-link"></i> {{\'Export\' | translate}}\n            </button>\n          </li><!-- /.btn export -->\n\n          <li class="hidden-xs">\n            <a tabindex="0" uib-popover-html="\'You will receive download links by email.\' | translate" popover-append-to-body="true" popover-placement="right" popover-trigger="\'focus\'" style="display:inline-block">\n              <i class="fa fa-question-circle-o text-primary"></i>\n            </a>\n          </li>\n        </ul>\n\n        <ul class="nav navbar-nav navbar-right">\n          <li>\n            <button class="btn btn-link" data-ng-click="add()">\n              <i c8y-icon="plus-circle"></i> {{\'Add report\' | translate}}\n            </button>\n          </li>\n          <li><c8y-refresh-btn></c8y-refresh-btn></li>\n        </ul>\n      </div>\n    </div>\n  </div>\n\n\n  <div class="c8y-empty-state text-center" ng-show="rows.length == 0">\n    <h1 class="c8y-icon c8y-icon-report c8y-icon-duocolor"></h1>\n    <h3 translate>No reports to display.</h3>\n    <p translate>Add your first report using the button on the toolbar.</p>\n    <p><small translate>Find out more on the <a c8y-guide-href="/guides/users-guide/cockpit/#reporting">User Guide</a>.</small></p>\n  </div>\n\n\n  <div class="list-group">\n    <div class="list-group-item flex-row" ng-repeat="row in rows | orderBy:\'config.name\'">\n      <div class="list-item-actions">\n        <div class="settings pull-right dropdown" uib-dropdown is-open="menuOpen">\n          <button type="button" title="{{\'Options\' | translate}}" class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle>\n            <i c8y-icon="ellipsis-v" class="fa fw fa-ellipsis-v"></i>\n          </button>\n          <ul class="dropdown-menu" uib-dropdown-menu>\n            <li>\n              <a href="" title="{{\'Edit\' | translate}}" ng-click="detail(row.config)">\n                <i c8y-icon="pencil"></i> <translate>Edit</translate>\n              </a>\n            </li>\n            <li>\n              <a href="" title="{{\'Clone\' | translate}}" ng-click="clone(row.config)">\n                <i c8y-icon="clone"></i> <translate>Clone</translate>\n              </a>\n            </li>\n\n            <li>\n              <a href="" title="{{\'Remove\' | translate}}" ng-click="remove(row.config)">\n                <i c8y-icon="trash"></i> <translate>Remove</translate>\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div><!-- /.list-item-actions -->\n\n      <div class="list-item-checkbox">\n        <label title="Select" class="c8y-checkbox input-sm">\n          <input type="checkbox" ng-model="row.selected" ng-change="updateOutput()"> <span></span>\n        </label>\n      </div>\n\n      <div class="list-item-icon" ng-click="detail(row.config)">\n        <i uib-tooltip="{{row.config.exportType === \'csv\' ? \'CSV file\' : row.config.exportType === \'vnd.ms-excel\' ? \'XLS file\' : \'\'}}" class="fa" ng-class="{\'fa-file-text-o\': row.config.exportType === \'csv\', \'fa-file-excel-o\': row.config.exportType === \'vnd.ms-excel\'}"></i>\n      </div>\n\n      <div class="list-item-body" ng-click="detail(row.config)">\n          <div class="row">\n            <span class="col-sm-4 col-xs-12">{{row.config.name}}</span>\n            <div class="col-sm-6 col-xs-12 text-muted">\n              <span ng-show="::row.config.queryParameters.dateType == \'LAST_WEEK\'"><i c8y-icon="calendar"></i> <translate>Last week</translate></span>\n              <span ng-show="::row.config.queryParameters.dateType == \'LAST_MONTH\'"><i c8y-icon="calendar"></i> <translate>Last month</translate></span>\n              <span ng-show="::row.config.queryParameters.dateType == \'LAST_YEAR\'"><i c8y-icon="calendar"></i> <translate>Last year</translate></span>\n              <span ng-show="::row.config.queryParameters.dateType == \'CUSTOM\'">\n                <i c8y-icon="calendar"></i>\n                <span ng-show="::row.config.queryParameters.from">\n                  <label class="small" translate>From:</label> {{row.config.queryParameters.from | absoluteDate}} &nbsp;\n                </span>\n                <span ng-show="::row.config.queryParameters.to">\n                  <label class="small" translate>To:</label> {{row.config.queryParameters.to | absoluteDate}}\n                </span>\n              </span>\n            </div>\n          </div>\n        </div>\n\n    </div>\n  </div>\n</div>\n',e.put("core_export/views/list.html",t),e.put("/apps/core/export/views/list.html",t),t='\n<div class="export-properties">\n  <table class="table vertical-middle form-group">\n    <thead>\n      <th class="narrowCell"></th>\n      <th class="wideCell">\n        <label>{{\'Column\' | translate}}</label>\n      </th>\n      <th class="wideCell">\n        <label>{{\'Path\' | translate}}</label>\n      </th>\n      <th class="narrowCell">\n      </th>\n    </thead>\n    <tbody>\n      <tr class="property" ng-repeat="property in api.fields" ng-form="forms.property{{$index}}" ng-class="{\'danger\': forms.property{{$index}}.$invalid}">\n        <td class="narrowCell"></td>\n        <td class="wideCell">\n          <input class="form-control property-label" data-ng-model="property.column" placeholder="{{\'Column\' | translate}}" required>\n        </td>\n        <td class="wideCell">\n          <input class="form-control property-label" data-ng-model="property.path" placeholder="{{\'Path\' | translate}}" required ng-disabled="property.default">\n        </td>\n        <td class="narrowCell">\n          <button type="button" ng-if="!property.default" class="btn btn-link showOnHover pull-right" title="{{\'Delete property\' | translate}}" ng-click="api.remove($index)">\n            <i c8y-icon="minus-circle" class="text-danger"></i>\n          </button>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n<div class="btn-add-block-row">\n  <button class="btn-add-block" style="flex:1 1 33%" ng-click="api.add()">\n    <i c8y-icon="plus-square"></i>\n    {{\'Add\' | translate}}\n  </button>\n  <button class="btn-add-block" style="flex:1 1 33%; margin-left:10px" ng-click="api.addPredefined()">\n    <i c8y-icon="plus-square"></i> {{\'Add predefined\' | translate}}\n  </button>\n  <span ng-if="api.template" style="flex:1 1 33%; margin-left:10px" ng-include="api.template"></span>\n</div>\n',e.put("core_export/views/properties.html",t),e.put("/apps/core/export/views/properties.html",t),t='<div class="row export-timespan">\n  <div class="col-sm-4 col-xs-12">\n    <div class="c8y-select-wrapper">\n      <select class="form-control input-sm" ng-model="timespan.dateType" ng-options="key as (label | translate) for (key, label) in types">\n      </select>\n      <span></span>\n  </div>\n  </div>\n  <div class="col-sm-8 col-xs-12" ng-show="timespan.dateType === \'CUSTOM\'">\n    <div style="width:100%">\n      <div class="timespan-label">\n        <label class="small" translate>From</label>\n      </div>\n      <div style="display:inline-block">\n        <c8y-date-time-picker max-date="timespan.to" ng-model="timespan.from"></c8y-date-time-picker>\n      </div>\n    </div>\n    <div style="width:100%">\n      <div class="timespan-label">\n        <label class="small" translate>To</label>\n      </div>\n      <div style="display:inline-block">\n        <c8y-date-time-picker min-date="timespan.from" ng-model="timespan.to"></c8y-date-time-picker>\n      </div>\n    </div>\n  </div>\n</div>\n',e.put("core_export/views/timespan.html",t),e.put("/apps/core/export/views/timespan.html",t)}angular.module("c8y.cockpit.export").run(["$templateCache",e])}();