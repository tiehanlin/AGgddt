/* core_qrCode 8.7.2 2017-08-02T09:55:11+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
angular.module("c8y.qrCode",["monospaced.qrcode"]).config(["c8yViewsProvider","c8yActionsProvider","gettext",function(e,t,n){"use strict";var o="/device/:deviceId",r="/route/:routeId",i="core_qrCode/views/";e.when(o,{templateUrl:i+"index.html",priority:600,name:n("QR code"),icon:"qrcode",showIf:["qrCodeTemplate",function(e){return e.getTemplate(e.qrCodeTypes.DEVICE).then(function(e){return!!e})}],controller:["$scope","$routeParams","c8yDevices",function(e,t,n){e.device={},n.detailCached(t.deviceId).then(function(t){e.device=t.data})}]}),e.when(r,{templateUrl:i+"index.html",priority:1e3,name:n("QR code"),icon:"qrcode",showIf:["qrCodeTemplate","$routeParams",function(e,t){return e.getTemplate(e.qrCodeTypes.ROUTE).then(function(e){return!!e&&"new"!==t.routeId})}],controller:["$scope","$routeParams","c8yBase","c8yInventory",function(e,t,n,o){e.route={},o.detailCached(t.routeId).then(n.getResData).then(function(t){e.route=t})}]}),t.addUrlAction({path:"/device",text:n("Print QR codes"),showIf:["$routeParams","qrCodeTemplate",function(e,t){return t.getTemplate(t.qrCodeTypes.DEVICE).then(function(t){return!!t&&!!_.isUndefined(e.deviceId)})}],action:["$rootScope","qrCodeTemplate","qrCodePrinter",function(e,t,n){var o=e.$on("deviceList.loadedDevicesList",function(e,r){r&&r.length>0&&t.getTemplate(t.qrCodeTypes.DEVICE).then(function(e){n.print(r,e)}),o()});e.$emit("deviceList.getLoadedDevicesList")}]}),t.addUrlAction({path:"/route",text:n("Print QR codes"),showIf:["$routeParams","qrCodeTemplate",function(e,t){return t.getTemplate(t.qrCodeTypes.ROUTE).then(function(t){return!!t&&!!_.isUndefined(e.routeId)})}],action:["$rootScope","qrCodeTemplate","qrCodePrinter",function(e,t,n){var o=e.$on("routesList.loadedRoutesList",function(e,r){r&&r.length>0&&t.getTemplate(t.qrCodeTypes.ROUTE).then(function(e){n.print(r,e)}),o()});e.$emit("routesList.getLoadedRoutesList")}]})}]),angular.module("c8y.qrCode").controller("qrCodeCtrl",["$scope","$routeParams","c8yBase","c8yInventory","qrCodeTemplate","qrCodePrinter",function(e,t,n,o,r,i){"use strict";function d(){a().then(u).then(l).then(p)}function a(){var e=c();if(e)return r.getTemplate(e)}function c(){return f?r.qrCodeTypes.ROUTE:m?r.qrCodeTypes.DEVICE:void 0}function u(t){e.qrCodeTemplate=r=t}function l(){return o.detailCached(C).then(n.getResData)}function p(t){e.data=y=t}function s(){i.print([y],r)}var r,m=t.deviceId,f=t.routeId,C=m||f,y=null;e.print=s,d()}]),angular.module("c8y.qrCode").directive("c8yDisplayQrCode",["qrCodePrinter",function(e){function t(t,n){_.isUndefined(t.data)||_.isUndefined(t.template)||n.empty().append(e.getQrCodeCompiledHtml([t.data],t.template))}return{restrict:"A",scope:{data:"=",template:"="},link:function(e,n,o){e.$watch(o.data,function(){t(e,n)}),e.$watch(o.template,function(){t(e,n)})}}}]),angular.module("c8y.qrCode").factory("qrCodePrinter",["$rootScope","$compile","$window","$timeout","c8yAlert","gettext",function(e,t,n,o,r,i){"use strict";function d(n,o){var r=e.$new();return r.data=n,t(angular.element(o))(r)}function a(e,t){var a=d(e,t),u=n.open("","_blank","width=800,height=600"),l=u&&u.document;return l?(l.open(),l.write(c),l.close(),angular.element(l.getElementById("body")).append(a),void o(function(){u.print()})):void r.danger(i("Popup window failed to open. Please confirm your browser settings."))}var c='<html><head></head><body id="body"></body></html>';return{getQrCodeCompiledHtml:d,print:a}}]),angular.module("c8y.qrCode").factory("qrCodeTemplate",["$cacheFactory","$http","c8yBase","c8yInventory",function(e,t,n,o){"use strict";function r(e){if(!d.get(e)){var t=o.list({type:e,pageSize:1}).then(function(e){return e.length>0?e[0].template:null});d.put(e,t)}return d.get(e)}var i={ROUTE:"c8y_RouteQrCodeTemplate",DEVICE:"c8y_DeviceQrCodeTemplate"},d=e("QrCodeTemplatesCache");return{qrCodeTypes:i,getTemplate:r}}]),function(){"use strict";function e(e){var t;t='<div class="row" ng-controller="qrCodeCtrl">\n  <div c8y-display-qr-code data="data" template="qrCodeTemplate"></div>\n  <button class="btn btn-primary" ng-click="print()" translate>Print QR code</button>\n</div>\n',e.put("core_qrCode/views/index.html",t),e.put("/apps/core/qrCode/views/index.html",t)}angular.module("c8y.qrCode").run(["$templateCache",e])}();