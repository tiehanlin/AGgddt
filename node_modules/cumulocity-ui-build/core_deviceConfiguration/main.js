/* core_deviceConfiguration 8.7.2 2017-08-02T09:54:10+00:00 e22b35b1d531 (hotfix/8.7.2) tip */
!function(){"use strict";function n(n,e){var t="core_deviceConfiguration/views/",o="/device/:deviceId";n.when(o,{templateUrl:t+"configuration.html",priority:600,name:e("Configuration"),icon:"gears",showIf:["$routeParams","c8yBase","c8yDevices",function(n,i,e){return e.detail(n.deviceId).then(function(n){var i=n.data;return!_.isUndefined(i.c8y_Configuration)||e.supportsOperation(i,"c8y_Configuration")||e.supportsOperation(i,"c8y_SendConfiguration")||e.supportsOperation(i,"c8y_DownloadConfigFile")||e.supportsOperation(i,"c8y_UploadConfigFile")||e.supportsOperation(i,"c8y_UploadRDB")})}],controller:["$scope","$q","$injector","$routeParams","c8yDevices","c8yConfig",function(n,e,t,o,a,r){n.noReplaceConfig=!0;var c=(r[i]||{}).replaceConfigTemplateFn;c&&(c=t.invoke(c),n.noReplaceConfig=!1),a.detail(o.deviceId).then(function(i){var e=n.device=i.data;c&&c(e)?n.replaceConfigTemplate=c(e):n.noReplaceConfig=!0})}]})}var i="c8y.deviceConfiguration";angular.module(i,[]).config(["c8yViewsProvider","gettext",n])}(),function(){"use strict";function n(n,i,e,t,o,a,r){function c(){var i=!1;if(n.device){var e=d("c8y_Configuration")||s("c8y_Configuration")||s("c8y_SendConfiguration");i=e}return i}function s(i){return e.supportsOperation(n.device,i)}function d(i){return n.device&&!_.isUndefined(n.device[i])}function l(i){g({description:a("Configuration update"),c8y_Configuration:{config:i}}).then(function(i){i.created.then(function(){n.savingConfiguration=!0}),i.completed.then(function(i){if(i.status===t.status.SUCCESSFUL)o.success(a("Configuration has been saved!"));else if(i.status===t.status.FAILED){var e=r.getString("Failed to save configuration!");i.failureReason&&(e=r.getString('Failed to save configuration because of: "{{failureReason}}"!',i)),o.danger(e)}n.savingConfiguration=!1})})}function u(){g({description:a("Requested current configuration"),c8y_SendConfiguration:{}}).then(function(c){c.created.then(function(){n.reloadingConfiguration=!0}),c.completed.then(function(c){if(c.status===t.status.SUCCESSFUL)e.detail(n.device.id).then(i.getResData).then(function(i){n.device.c8y_Configuration=i.c8y_Configuration,o.success(a("Configuration has been reloaded!")),n.reloadingConfiguration=!1});else if(c.status===t.status.FAILED){var s=r.getString("Failed to reload configuration!");c.failureReason&&(s=r.getString('Failed to reload configuration because of: "{{failureReason}}"!',c)),o.danger(s),n.reloadingConfiguration=!1}})})}function g(i){return i.deviceId=n.device.id,t.createWithNotifications(i).then(function(n){return n.created.then(function(){f(i)}),n})}function f(n){o.success(r.getString('Created operation: "{{description}}"!',n))}n.visible=c,n.supportsOperation=s,n.configuration=l,n.reloadConfiguration=u}angular.module("c8y.deviceConfiguration").controller("deviceConfigurationWidgetCtrl",["$scope","c8yBase","c8yDevices","c8yDeviceControl","c8yAlert","gettext","gettextCatalog",n])}(),function(){"use strict";function n(n,i,e,t,o,a,r,c,s,d){function l(){C().then(u)}function u(){return c.list().then(p).then(v)}function g(i){var e=n.device.type;return!i.deviceType||i.deviceType===e}function f(n){var i=n.deviceType?"\0":"ï¿¿";return i+=(n.name||"")+(n.description||"")}function p(i){return n.configurations=_(i).filter(g).sortBy(f).value()}function v(){var i,e,t,o=n.device&&n.device.c8y_ConfigurationDump;o&&(i=o.id,e=o.datetime,t=_.find(n.configurations,function(n){return n.id==i})),n.deviceConfigId=i,n.deviceConfigDateUpdate=e,n.configFromRepository=t,n.configInfoAvailable=!0}function C(){return o.detail(S).then(e.getResData).then(function(i){n.device=i})}function h(){m({description:s("Retrieve configuration snapshot"),c8y_UploadConfigFile:{}}).then(function(i){i.created.then(function(){n.retrievingConfiguration=!0}),i.completed.then(function(i){i.status===a.status.SUCCESSFUL?r.success(s("Configuration snapshot has been stored in configuration repository!")):i.status===a.status.FAILED&&(i.failureReason?r.danger(d.getString('Failed to retrieve configuration snapshot because of "{{failureReason}}"!',i)):r.danger(s("Failed to retrieve configuration snapshot!"))),n.retrievingConfiguration=!1}).then(u)})}function y(i){m({description:s("Apply configuration snapshot"),c8y_DownloadConfigFile:{url:i.url,c8y_ConfigurationDump:{id:i.id}}}).then(function(i){i.created.then(function(){n.applyingConfiguration=!0}),i.completed.then(function(i){i.status===a.status.SUCCESSFUL?r.success(s("Configuration snapshot has been applied!")):i.status===a.status.FAILED&&(i.failureReason?r.danger(d.getString('Failed to apply configuration snapshot because of "{{failureReason}}"!',i)):r.danger(s("Failed to apply configuration snapshot!"))),n.applyingConfiguration=!1}).then(u)})}function m(i){return i.deviceId=n.device.id,a.createWithNotifications(i).then(function(n){return n.created.then(function(){b(i)}),n})}function b(n){var i=n.description;r.success(d.getString('Created operation: "{{description}}"!',{description:i}))}function w(i){return o.supportsOperation(n.device,i)}function F(i){return i.deviceType===n.device.type?d.getString("For device type: {{deviceType}}",{deviceType:n.device.type}):void 0===i.deviceType?d.getString("Type independent"):void 0}var S=i.deviceId;n.newConfiguration={selected:null},n.retrieveConfiguration=h,n.applyConfiguration=y,n.supportsOperation=w,n.configurationType=F,l()}angular.module("c8y.deviceConfiguration").controller("deviceConfigurationDumpCtrl",["$scope","$routeParams","c8yBase","c8yInventory","c8yDevices","c8yDeviceControl","c8yAlert","configurationRepositorySvc","gettext","gettextCatalog",n])}(),function(){"use strict";function n(n){var i;i='<div ng-show="noReplaceConfig">\n  <div ng-include="\'core_deviceConfiguration/views/widget.html\'"></div>\r\n  <div class="row">\r\n    <div class="col-md-6" ng-include="\'core_deviceConfiguration/views/dump.html\'"></div>\r\n    <c8y-rdb-dump class="col-md-6" device-id="device.id"></c8y-rdb-dump>\r\n  </div>\n</div>\n<div ng-include="replaceConfigTemplate"></div>\n',n.put("core_deviceConfiguration/views/configuration.html",i),n.put("/apps/core/deviceConfiguration/views/configuration.html",i),i='<div ng-controller="deviceConfigurationDumpCtrl">\n  <div class="card" ng-show="supportsOperation(\'c8y_UploadConfigFile\') || supportsOperation(\'c8y_DownloadConfigFile\')">\n    <div class="card-header-actions">\n      <div class="card-icon">\n        <i c8y-icon="gears"></i>\n      </div>\n      <div class="card-title">\n        <span>{{\'Configuration snapshot\' | translate}}</span>\n      </div>\n      <div class="header-actions">\n        <button type="button" class="btn btn-link" ng-show="supportsOperation(\'c8y_UploadConfigFile\')" ng-disabled="retrievingConfiguration" ng-click="retrieveConfiguration()">\n        <i class="fa" ng-class="{\'fa-spin fa-circle-o-notch\': retrievingConfiguration, \'fa-download\': !retrievingConfiguration }"></i> {{\'Get new snapshot from device\' | translate}}\n      </button>\n      </div>\n    </div>\n\n    <div class="card-block">\n\n      <div class="legend form-block">{{\'Current snapshot\' | translate}}</div>\n      <div class="alert alert-warning" ng-show="configInfoAvailable && !deviceConfigId" translate>\n        No snapshot assigned to this device. Get current snapshot from device or put new one from repository.\n      </div>\n\n      <div class="alert alert-warning" ng-show="configInfoAvailable && deviceConfigId && !configFromRepository" translate>\n        The snapshot with the id {{deviceConfigId}} is assigned to the device but the configuration can\'t be found in the repository.\n      </div>\n      <div class="form-group" ng-show="deviceConfigDateUpdate">\n        <label class="small" translate>Snapshot assigned on</label>\n        <p class="static-control">{{deviceConfigDateUpdate | absoluteDate}}</p>\n      </div>\n\n      <div class="form-group" ng-show="configFromRepository">\n        <label class="small" translate>Name</label>\n        <p class="static-control">{{configFromRepository.name}}</p>\n      </div>\n\n      <div class="form-group" ng-show="configFromRepository">\n        <label class="small" translate>Description</label>\n        <p class="static-control">{{configFromRepository.description}}</p>\n      </div>\n\n      <div class="form-group" ng-show="configFromRepository">\n        <label class="small" translate>Configuration snapshot file</label>\n        <div>\n          <c8y-binary-input initial-url="configFromRepository.url" editable="false"></c8y-binary-input>\n          <small>\n            <a ng-href="#/configuration?id={{configFromRepository.id}}" translate>Open in repository</a>\n          </small>\n        </div>\n      </div>\n    </div>\n    <div class="bg-gray-white">\n      <div class="card-block">\n        <div class="legend form-block">{{\'Apply new snapshot\' | translate}}</div>\n        <form role="form" name="newCfgForm">\n          <div class="form-group">\n            <label>{{\'Select configuration repository entry to be used\' | translate}}</label>\n            <div class="form-control-static">\n              <ui-select class="snapshotsSelect form-control" style="width:98%" ng-model="newConfiguration.selected">\n                <ui-select-match placeholder="{{\'Choose a configuration...\' | translate}}" title="{{$select.selected.name}} &ndash; {{$select.selected.description}}">\n                  {{$select.selected.name}} &ndash; {{$select.selected.description}}\n                </ui-select-match>\n                <ui-select-choices group-by="configurationType" repeat="cfg in configurations | filter: $select.search">\n                  <span title="{{cfg.name}} &ndash; {{cfg.description}}">\n                    {{cfg.name}} &ndash; {{cfg.description}}\n                  </span>\n                </ui-select-choices>\n              </ui-select>\n            </div>\n            <a ng-href="#/configuration?add=1&type={{device.type}}" class="btn btn-link"><i c8y-icon="plus"></i> <span translate>Add configuration snapshot</span></a>\n          </div>\n          <button type="button" class="btn btn-primary" ng-click="applyConfiguration(newConfiguration.selected)" ng-disabled="!newConfiguration.selected || applyingConfiguration">\n            <i c8y-icon="upload"></i>\n            <span ng-hide="applyingConfiguration">{{\'Put new snapshot to device\' | translate}}</span>\n            <span ng-show="applyingConfiguration">{{\'Putting new snapshot to device\' | translate}}&hellip;</span>\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n</div>\n',n.put("core_deviceConfiguration/views/dump.html",i),n.put("/apps/core/deviceConfiguration/views/dump.html",i),i='<div class="card" ng-controller="deviceConfigurationWidgetCtrl">\n\n  <div class="card-actions">\n    <button type="button" class="btn btn-link" ng-disabled="reloadingConfiguration || savingConfiguration" ng-click="reloadConfiguration()" ng-show="supportsOperation(\'c8y_SendConfiguration\')">\n      <i c8y-icon="refresh" ng-class="{\'fa-spin\': reloadingConfiguration}"></i> {{\'Reload\' | translate}}\n    </button>\n  </div>\n  <div class="card-header">\n    <h4 class="card-title">{{\'Configuration\' | translate}}</h4>\n  </div>\n  <hr>\n  <textarea c8y-code-editor ng-model="device.c8y_Configuration.config" class="form-control" style="height: 500px" ng-disabled="reloadingConfiguration || savingConfiguration" c8y-spellcheck="false"></textarea>\n  <div class="card-footer" ng-show="supportsOperation(\'c8y_Configuration\')">\n    <button type="button" ng-click="configuration(device.c8y_Configuration.config)" ng-disabled="reloadingConfiguration || savingConfiguration" class="btn btn-primary">\n      <span ng-hide="savingConfiguration">{{\'Save\' | translate}}</span>\n      <span ng-show="savingConfiguration"><i c8y-icon="spinner" ng-class="{\'fa-spin\': savingConfiguration}"></i> {{\'Saving\' | translate}}</span>\n    </button>\n  </div>\n</div>\n',n.put("core_deviceConfiguration/views/widget.html",i),n.put("/apps/core/deviceConfiguration/views/widget.html",i)}angular.module("c8y.deviceConfiguration").run(["$templateCache",n])}();