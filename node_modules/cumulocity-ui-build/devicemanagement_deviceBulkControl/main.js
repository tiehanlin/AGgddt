/* devicemanagement_deviceBulkControl 8.7.2 2017-08-02T09:53:39+00:00 2e289fd803cb (hotfix/8.7.2) tip */
!function(){"use strict";function t(t,e){t.when("/group/:groupId",{templateUrl:"devicemanagement_deviceBulkControl/views/list.html",name:e("Bulk operations"),icon:"gamepad"})}angular.module("c8y.deviceBulkControl",["ui.bootstrap.progressbar"]).config(["c8yViewsProvider","gettext",t])}(),function(){"use strict";function t(t,e,n,o,i,a,r,s,l){function c(){p().then(d,g).then(m).then(angular.bind(w,w.start))}function p(t){var e=u(t);return i.list(e,!0)}function u(t){var n=t||b;return _.assign(n,e),n}function d(e,n){t.operations&&!n||(t.operations=[]),e.forEach(function(e){t.operations.push(e),h[e.id]=h[e.id]||_.cloneDeep(k)}),t.paging=e.paging}function g(t){return 403===t.status?r.info(l("You need these roles to access bulk operations: Bulk Operation Read / Admin")):r.danger(s.getTranslatedServerMessage(t.data.message),t.data),o.reject()}function m(){var t=e.open;t&&(h[t]=_.assign(h[t]||_.cloneDeep(k),{showDetails:!0}))}function v(){t.paging.refresh().then(_.partialRight(d,!0))}function f(e){t.paging.loading=!0,e?p({pageSize:e}).then(d):t.paging.next().then(d).finally(function(){t.paging.loading=!1})}function y(){w.stop()}var h={},b={withDeleted:!0},k={showGroupLink:!e.groupId,showProgressBar:!0,showEditable:!0,showDetails:!1},w={promise:null,toggle:function(){this.promise?this.stop():this.start()},start:function(){this.promise||(v(),this.promise=n(v,1e4))},stop:function(){this.promise&&(n.cancel(this.promise),this.promise=null)},icon:function(){return a.icon(!!this.promise)},color:function(){return this.promise?"realtime-on":"realtime-off"}};t.operationDisplayOptions=h,t.realtime=w,t.refresh=v,t.loadNext=f,t.$on("$destroy",y),c()}angular.module("c8y.deviceBulkControl").controller("bulkOperationsListCtrl",["$scope","$routeParams","$interval","$q","c8yDeviceBulkControl","c8yRealtime","c8yAlert","c8yLocales","gettext",t])}(),function(){"use strict";function t(t,e,n,o,i,a,r,s){function l(){c(),p()}function c(){t.operation=s=s||{}}function p(){return e.all([i.list(),a.getGroupList()]).then(_.flattenDeep).then(u)}function u(e){t.groups=e,s.groupId=s.groupId||e[0]&&e[0].id}function d(t){return n.close(t)}t.save=d,t.dismiss=n.dismiss,l()}angular.module("c8y.deviceBulkControl").controller("bulkOperationDetailsCtrl",["$scope","$q","$uibModalInstance","$routeParams","c8yDeviceGroup","c8yDynamicGroups","c8yInventory","operation",t])}(),function(){"use strict";function t(t,e,n,o,i,a,r,s){function l(){t.displayOptions.showDetails=!t.displayOptions.showDetails}function c(t){return o.getStatusStyle(t).cls}function p(t){return o.getStatusStyle(t).icon}function u(t){return o.getStatusStyle(t).label}function d(t){return n.getStyle(t).icon}function g(t){return n.getStyle(t).cls}function m(t){return k(t,o.status.SCHEDULED)}function v(t){return e.editBulkOperationWithUI(t).then(b)}function f(t){return o.canCancel(t)}function y(t){return i({title:r("Confirm cancelling operation?"),body:t.operationPrototype.description?s.getString('Do you really want to cancel operation "{{description}}"?',t.operationPrototype):r("Do you really want to cancel this operation?"),status:"danger"}).then(angular.bind(o,o.cancel,t)).then(_.partial(_.unary(a.success),r("Operation cancellation triggered. If it is in progress, it may take up to one minute to cancel it."))).then(b)}function h(t){return k(t,o.status.COMPLETED_WITH_FAILURES)}function b(){t.onEdited&&t.onEdited()}function k(t,e){return o.getStatus(t)===e}function w(t){return t.operationPrototype.description||r("no description available")}function O(n){_.isUndefined(t.groupStillExists)&&e.doesTargetGroupExist(n).then(function(e){t.groupStillExists=e})}function C(n){t.progressBar=_.assign(t.progressBar||{},e.getProgressBar(n))}t.toggle=l,t.isInStatus=k,t.statusClass=c,t.statusIcon=p,t.statusLabel=u,t.singleOpStatusClass=g,t.singleOpStatusIcon=d,t.canEdit=m,t.edit=v,t.canCancel=f,t.cancel=y,t.canRetryFailed=h,t.retryFailed=e.retryFailedWithUI,t.getOperationDesc=w,t.checkGroupLink=O,t.$watch("operation",C)}t.$inject=["$scope","deviceBulkControlSvc","c8yDeviceControl","c8yDeviceBulkControl","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceBulkControl").controller("deviceControlBulkOperationRowSummaryCtrl",t)}(),function(){"use strict";function t(){return{restrict:"A",replace:!0,scope:{operation:"=",displayOptions:"=?",onEdited:"&?"},templateUrl:"devicemanagement_deviceBulkControl/views/bulkOperationRowSummary.html",controller:"deviceControlBulkOperationRowSummaryCtrl"}}angular.module("c8y.deviceBulkControl").directive("deviceControlBulkOperationRowSummary",t)}(),function(){"use strict";function t(t,e,n){function o(){return{showDetails:!1,showDeviceLink:!0}}function i(t){return n.getStatusStyle(t).cls}function a(t){return n.getStatusStyle(t).icon}function r(t){return n.getStatusStyle(t).label}function s(t){return e.getStyle(t).icon}function l(t){return e.getStyle(t).cls}t.getSingleOperationDisplayOptions=o,t.getStandardKeys=e.getStandardKeys,t.status=n.getStatusStyle,t.statusClass=i,t.statusIcon=a,t.statusLabel=r,t.singleOpStatusClass=l,t.singleOpStatusIcon=s}angular.module("c8y.deviceBulkControl").controller("deviceControlBulkOperationRowDetailsCtrl",["$scope","c8yDeviceControl","c8yDeviceBulkControl",t])}(),function(){"use strict";function t(){return{restrict:"A",replace:!0,scope:{operation:"=",onChange:"&?"},templateUrl:"devicemanagement_deviceBulkControl/views/bulkOperationRowDetails.html",controller:"deviceControlBulkOperationRowDetailsCtrl"}}angular.module("c8y.deviceBulkControl").directive("deviceControlBulkOperationRowDetails",t)}(),function(){"use strict";function t(t,e,n,o,i,a){function r(t){if(t&&t.progress&&0!==t.progress.all){var e=t.progress;return[{type:"info",value:e.pending/e.all*100,tooltip:a("Pending"),status:"pending"},{type:"warning",value:e.executing/e.all*100,tooltip:a("Executing"),status:"executing"},{type:"success",value:e.successful/e.all*100,tooltip:a("Successful"),status:"successful"},{type:"danger",value:e.failed/e.all*100,tooltip:a("Failed"),status:"failed"}]}return null}function s(e){return c({startDate:moment().add(10,"minutes").seconds(0).format(t.dateFullFormat),operationPrototype:_.cloneDeep(e),creationRamp:15}).then(_.partial(p,a("New bulk operation scheduled!")))}function l(t){return c(t).then(_.partial(p,a("Bulk operation updated!")))}function c(t){return o({templateUrl:"devicemanagement_deviceBulkControl/views/details.html",controller:"bulkOperationDetailsCtrl",resolve:{operation:function(){return _.cloneDeep(t)}}})}function p(t,e){return n.save(e).then(_.partial(m,t))}function u(e){return n.detail(e).then(t.getResData).then(function(t){return"#/group/"+t.groupId+"/bulk_operations?open="+t.id})}function d(t){var n=t.groupId;return e.detail(n,{},{silentError:!0}).then(_.constant(!0)).catch(_.constant(!1))}function g(e){var o=_.cloneDeep(e);return o.startDate=moment().add(10,"minutes").seconds(0).format(t.dateFullFormat),c(o).then(n.retryFailed).then(_.partial(m,a("Scheduled bulk operation to complete failed devices!")))}function m(t){return i.success(t)}return{getProgressBar:r,createBulkOperationFromExistingOp:s,editBulkOperationWithUI:l,getBulkOperationHref:u,doesTargetGroupExist:d,retryFailedWithUI:g}}t.$inject=["c8yBase","c8yInventory","c8yDeviceBulkControl","c8yModal","c8yAlert","gettext"],angular.module("c8y.deviceBulkControl").factory("deviceBulkControlSvc",t)}(),function(){"use strict";function t(t){var e;e='<div class="row">\n  <div class="col-sm-3">\n    <div class="legend form-block" translate>Details</div>\n    <dl class="dl-inline small text-muted" style="margin-bottom: 0">\n      <dt translate>Start date</dt>\n      <dd>{{operation.startDate | date:\'medium\'}}</dd>\n      <dt>\n        <span translate>Delay</span>\n        <a href popover-placement="right" popover-trigger="\'focus\'" uib-popover="{{\'Delay before sending the operation to the next device.\' | translate}}"><i c8y-icon="question-circle-o"></i></a>\n      </dt>\n      <dd>{{operation.creationRamp | duration}}</dd>\n      <dt translate>Status</dt>\n      <dd>\n      <i c8y-icon="{{statusIcon(operation)}}" ng-class="statusClass(operation)"></i> {{statusLabel(operation)}}\n      <span ng-if="operation.progress.pending || operation.progress.executing" class="text-muted" translate>\n        (updated every minute)\n      </span>\n        <div ng-if="operation.progress.pending || operation.progress.executing || operation.progress.successful || operation.progress.failed">\n          <i c8y-icon="{{singleOpStatusIcon(\'pending\')}}" ng-class="singleOpStatusClass(\'pending\')"></i> {{\'Pending\' | translate}}: {{operation.progress.pending}},\n          <i c8y-icon="{{singleOpStatusIcon(\'executing\')}}" ng-class="singleOpStatusClass(\'executing\')"></i> {{\'Executing\' | translate}}: {{operation.progress.executing}},\n          <i c8y-icon="{{singleOpStatusIcon(\'successful\')}}" ng-class="singleOpStatusClass(\'successful\')"></i> {{\'Successful\' | translate}}: {{operation.progress.successful}},\n          <i c8y-icon="{{singleOpStatusIcon(\'failed\')}}" ng-class="singleOpStatusClass(\'failed\')"></i> {{\'Failed\' | translate}}: {{operation.progress.failed}}\n        </div>\n      </dd>\n    </dl>\n  </div>\n  <div class="col-sm-9">\n    <div class="legend form-block" translate>Operation</div>\n    <pre style="white-space: pre-wrap">{{operation.operationPrototype|json:2}}</pre>\n\n    <div ng-if="operation.operations.length">\n      <div class="legend form-block" translate>Operations</div>\n      <table class="table">\n        <tbody ng-repeat="op in operation.operations" ng-init="displayOptions = getSingleOperationDisplayOptions()">\n          <tr device-control-single-operation-row-summary operation="op" display-options="displayOptions"></tr>\n          <tr ng-if="displayOptions.showDetails" device-control-single-operation-row-details operation="op"></tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n',t.put("devicemanagement_deviceBulkControl/views/bulkOperationRowDetails.html",e),t.put("/apps/devicemanagement/deviceBulkControl/views/bulkOperationRowDetails.html",e),e='<div class="flex-row" ng-class="{\'realtime-animation-list\': realtimeAnimation}">\n  <div class="list-item-actions">\n    <button type="button" title="Expand" class="collapse-btn" ng-class="{\'active\':isOpen}" ng-click="toggle(operation); isOpen = !isOpen">\n      <i c8y-icon="chevron-down" class="fa fw fa-chevron-down"></i>\n    </button>\n    <span class="dropdown settings" is-open="isopen" uib-dropdown>\n      <button class="dropdown-toggle c8y-dropdown btn-link" uib-dropdown-toggle>\n          <i c8y-icon="ellipsis-v"></i>\n      </button>\n      <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n        <li ng-show="displayOptions.showEditable && canCancel(operation)">\n          <button ng-click="cancel(operation)">\n            <i c8y-icon="times"></i> {{\'Cancel operation\' | translate}}\n          </button>\n        </li>\n        <li ng-show="displayOptions.showEditable && canRetryFailed(operation)">\n          <button ng-click="retryFailed(operation)">\n            <i c8y-icon="refresh"></i> {{\'Retry failed\' | translate}}\n          </button>\n        </li>\n        <li ng-show="displayOptions.showEditable && canEdit(operation)">\n          <button ng-click="edit(operation)">\n            <i c8y-icon="pencil"></i> {{\'Edit operation schedule\' | translate}}\n          </button>\n        </li>\n      </ul>\n    </span>\n  </div>\n  <div class="list-item-icon">\n    <a name="bulk-operation-{{operation.id}}">\n      <i c8y-icon="{{statusIcon(operation)}}" ng-class="statusClass(operation)" uib-tooltip="{{statusLabel(operation)}}"></i>\n    </a>\n  </div>\n  <div class="list-item-body">\n    <div class="row">\n      <div class="col-md-5">\n        <span class="interact" ng-click="toggle(operation);isOpen = !isOpen">{{getOperationDesc(operation) | translate}}</span><br>\n        <span ng-if="displayOptions.showGroupLink" ng-mouseover="checkGroupLink(operation)">\n          <span class="text-muted" ng-if="groupStillExists === undefined">\n            <small>\n              <i c8y-icon="folder-open"></i>\n              {{\'Group\' | translate}} {{operation.groupId}}\n            </small>\n          </span>\n          <span class="text-muted" ng-if="groupStillExists === true" uib-tooltip="{{\'This group has already been removed.\' | translate}}">\n            <small>\n              <i c8y-icon="folder-open"></i>\n              <del>{{\'Group\' | translate}} {{operation.groupId}}</del>\n            </small>\n          </span>\n          <a class="text-muted" ng-href="#/group/{{operation.groupId}}" ng-if="groupStillExists === false">\n            <small>\n              <i c8y-icon="folder-open"></i>\n              {{\'Group\' | translate}} {{operation.groupId}}\n            </small>\n          </a>\n        </span>\n      </div>\n      <div class="col-md-3" ng-click="toggle(operation);isOpen = !isOpen">\n        <div ng-if="displayOptions.showProgressBar && progressBar" style="margin-top: 10px">\n          <uib-progress ng-class="{\'progress-bar-striped\': isInStatus(operation, \'EXECUTING\'), \'active\': isInStatus(operation, \'EXECUTING\')}" style="margin-bottom: 0">\n            <uib-bar ng-repeat="bar in progressBar track by $index" value="bar.value" type="{{bar.type}}">\n              <span ng-hide="bar.value < 5" uib-tooltip="{{bar.tooltip}}: {{bar.value | number:0}}%">\n                <i c8y-icon="{{singleOpStatusIcon(bar.status)}}"></i> {{bar.value | number:0}}%\n              </span>\n            </uib-bar>\n          </uib-progress>\n        </div>\n      </div>\n      <div class="col-md-4" ng-click="toggle(operation);isOpen = !isOpen">\n        <small class="text-muted">\n          <i c8y-icon="calendar"></i> {{operation.startDate | absoluteDate}}\n        </small>\n      </div>\n    </div>\n  </div>\n</div>\n',t.put("devicemanagement_deviceBulkControl/views/bulkOperationRowSummary.html",e),t.put("/apps/devicemanagement/deviceBulkControl/views/bulkOperationRowSummary.html",e),e='<form name="bulkOperationDetailsForm" novalidate>\n  <div class="modal-header">\n    <h3 translate>Execute operation for whole group</h3>\n  </div>\n  <div class="modal-body">\n    <div class="form-group" ng-if="!operation.id" style="position:relative;z-index:1000">\n      <label class="form-label" translate>Target group</label>\n      <div class="form-group">\n        <ui-select ng-model="operation.groupId" class="form-control" style="width: 300px" required>\n          <ui-select-match placeholder="{{\'Select or search group\' | translate}}">{{$select.selected.name}}</ui-select-match>\n          <ui-select-choices repeat="group.id as group in groups | filter: $select.search | orderBy:\'name\'">\n            <div ng-bind-html="group.name | highlight: $select.search"></div>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="form-label" translate>Start date</label>\n      <div class="form-group clearfix">\n        <div class="form-group rightAlignCalendar pull-left" style="margin-right: 10px">\n          <input class="form-control" placeholder="{{\'Start date\' | translate}}" style="margin-top: 32px; width: 125px; text-align:center" required is-open="openStartDate" uib-datepicker-popup show-button-bar="false" show-weeks="0" ng-model="operation.startDate" ng-click="openStartDate=true">\n        </div>\n        <div class="form-group rightAlignCalendar timeField pull-left">\n          <div uib-timepicker ng-model="operation.startDate" show-meridian="false" required></div>\n        </div>\n      </div>\n    </div>\n    <div class="form-group">\n      <label class="form-label"><span translate>Delay</span>&nbsp;<i c8y-icon="question-circle" uib-tooltip="{{\'Delay before sending the operation to the next device.\' | translate}}"></i></label>\n      <div class="form-group">\n        <c8y-duration-input ng-model="operation.creationRamp"></c8y-duration-input>\n      </div>\n    </div>\n    <div class="form-group">\n      <button class="btn btn-link" ng-click="showOperationDetails = !showOperationDetails">\n        <span ng-hide="showOperationDetails" translate>Show</span>\n        <span ng-show="showOperationDetails" translate>Hide</span>\n        {{\'operation details\' | translate}}\n      </button>\n      <div class="form-group" ng-show="showOperationDetails">\n        <textarea c8y-code-editor="json" class="form-control" name="operation" ng-model="operation.operationPrototype" style="height: 250px" required></textarea>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-primary" ng-disabled="bulkOperationDetailsForm.$invalid" ng-click="save(operation)">\n      <span ng-hide="operation.id" translate>Create</span>\n      <span ng-show="operation.id" translate>Reschedule</span>\n    </button>\n    <button class="btn btn-default" ng-click="dismiss()" translate>Cancel</button>\n  </div>\n</form>\n',t.put("devicemanagement_deviceBulkControl/views/details.html",e),t.put("/apps/devicemanagement/deviceBulkControl/views/details.html",e),e='<div ng-controller="bulkOperationsListCtrl" class="bulk-operations-list">\n  <div class="clearfix">\n    <c8y-refresh-btn class="pull-right" style="margin-bottom:20px"></c8y-refresh-btn>\n    <button type="button" ng-click="realtime.toggle()" class="btn btn-link pull-right" style="margin-bottom:20px">\n      <i c8y-icon="{{realtime.icon()}}" ng-class="realtime.color()"></i> {{\'Realtime\' | translate}}\n    </button>\n  </div>\n\n  <div class="alert alert-warning" ng-show="operations.length == 0" translate>\n    No bulk operations found.\n  </div>\n\n  <table class="table">\n    <tbody ng-repeat="op in operations">\n      <tr device-control-bulk-operation-row-summary operation="op" display-options="operationDisplayOptions[op.id]" on-edited="refresh()"></tr>\n      <tr ng-if="operationDisplayOptions[op.id].showDetails" device-control-bulk-operation-row-details operation="op"></tr>\n    </tbody>\n  </table>\n\n  <c8y-load-more change-page-size></c8y-load-more>\n</div>\n',t.put("devicemanagement_deviceBulkControl/views/list.html",e),t.put("/apps/devicemanagement/deviceBulkControl/views/list.html",e)}angular.module("c8y.deviceBulkControl").run(["$templateCache",t])}();